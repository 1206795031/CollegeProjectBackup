<!DOCTYPE html><html><head>
      <title>readme</title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      
      <link rel="stylesheet" href="file:///c:\Users\31415926535x\.vscode\extensions\gicentre.markdown-preview-enhanced-with-litvis-0.22.0\node_modules\mume-with-litvis\dependencies\katex\katex.min.css">
      
      

      
      
      
      
      
      
      

      <style>
      /**
 * prism.js Github theme based on GitHub's theme.
 * @author Sam Clarke
 */
code[class*="language-"],
pre[class*="language-"] {
  color: #333;
  background: none;
  font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.4;

  -moz-tab-size: 8;
  -o-tab-size: 8;
  tab-size: 8;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

/* Code blocks */
pre[class*="language-"] {
  padding: .8em;
  overflow: auto;
  /* border: 1px solid #ddd; */
  border-radius: 3px;
  /* background: #fff; */
  background: #f5f5f5;
}

/* Inline code */
:not(pre) > code[class*="language-"] {
  padding: .1em;
  border-radius: .3em;
  white-space: normal;
  background: #f5f5f5;
}

.token.comment,
.token.blockquote {
  color: #969896;
}

.token.cdata {
  color: #183691;
}

.token.doctype,
.token.punctuation,
.token.variable,
.token.macro.property {
  color: #333;
}

.token.operator,
.token.important,
.token.keyword,
.token.rule,
.token.builtin {
  color: #a71d5d;
}

.token.string,
.token.url,
.token.regex,
.token.attr-value {
  color: #183691;
}

.token.property,
.token.number,
.token.boolean,
.token.entity,
.token.atrule,
.token.constant,
.token.symbol,
.token.command,
.token.code {
  color: #0086b3;
}

.token.tag,
.token.selector,
.token.prolog {
  color: #63a35c;
}

.token.function,
.token.namespace,
.token.pseudo-element,
.token.class,
.token.class-name,
.token.pseudo-class,
.token.id,
.token.url-reference .token.variable,
.token.attr-name {
  color: #795da3;
}

.token.entity {
  cursor: help;
}

.token.title,
.token.title .token.punctuation {
  font-weight: bold;
  color: #1d3e81;
}

.token.list {
  color: #ed6a43;
}

.token.inserted {
  background-color: #eaffea;
  color: #55a532;
}

.token.deleted {
  background-color: #ffecec;
  color: #bd2c00;
}

.token.bold {
  font-weight: bold;
}

.token.italic {
  font-style: italic;
}


/* JSON */
.language-json .token.property {
  color: #183691;
}

.language-markup .token.tag .token.punctuation {
  color: #333;
}

/* CSS */
code.language-css,
.language-css .token.function {
  color: #0086b3;
}

/* YAML */
.language-yaml .token.atrule {
  color: #63a35c;
}

code.language-yaml {
  color: #183691;
}

/* Ruby */
.language-ruby .token.function {
  color: #333;
}

/* Markdown */
.language-markdown .token.url {
  color: #795da3;
}

/* Makefile */
.language-makefile .token.symbol {
  color: #795da3;
}

.language-makefile .token.variable {
  color: #183691;
}

.language-makefile .token.builtin {
  color: #0086b3;
}

/* Bash */
.language-bash .token.keyword {
  color: #0086b3;
}

/* highlight */
pre[data-line] {
  position: relative;
  padding: 1em 0 1em 3em;
}
pre[data-line] .line-highlight-wrapper {
  position: absolute;
  top: 0;
  left: 0;
  background-color: transparent;
  display: block;
  width: 100%;
}

pre[data-line] .line-highlight {
  position: absolute;
  left: 0;
  right: 0;
  padding: inherit 0;
  margin-top: 1em;
  background: hsla(24, 20%, 50%,.08);
  background: linear-gradient(to right, hsla(24, 20%, 50%,.1) 70%, hsla(24, 20%, 50%,0));
  pointer-events: none;
  line-height: inherit;
  white-space: pre;
}

pre[data-line] .line-highlight:before, 
pre[data-line] .line-highlight[data-end]:after {
  content: attr(data-start);
  position: absolute;
  top: .4em;
  left: .6em;
  min-width: 1em;
  padding: 0 .5em;
  background-color: hsla(24, 20%, 50%,.4);
  color: hsl(24, 20%, 95%);
  font: bold 65%/1.5 sans-serif;
  text-align: center;
  vertical-align: .3em;
  border-radius: 999px;
  text-shadow: none;
  box-shadow: 0 1px white;
}

pre[data-line] .line-highlight[data-end]:after {
  content: attr(data-end);
  top: auto;
  bottom: .4em;
}html body{font-family:"Helvetica Neue",Helvetica,"Segoe UI",Arial,freesans,sans-serif;font-size:16px;line-height:1.6;color:#333;background-color:#fff;overflow:initial;box-sizing:border-box;word-wrap:break-word}html body>:first-child{margin-top:0}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{line-height:1.2;margin-top:1em;margin-bottom:16px;color:#000}html body h1{font-size:2.25em;font-weight:300;padding-bottom:.3em}html body h2{font-size:1.75em;font-weight:400;padding-bottom:.3em}html body h3{font-size:1.5em;font-weight:500}html body h4{font-size:1.25em;font-weight:600}html body h5{font-size:1.1em;font-weight:600}html body h6{font-size:1em;font-weight:600}html body h1,html body h2,html body h3,html body h4,html body h5{font-weight:600}html body h5{font-size:1em}html body h6{color:#5c5c5c}html body strong{color:#000}html body del{color:#5c5c5c}html body a:not([href]){color:inherit;text-decoration:none}html body a{color:#08c;text-decoration:none}html body a:hover{color:#00a3f5;text-decoration:none}html body img{max-width:100%}html body>p{margin-top:0;margin-bottom:16px;word-wrap:break-word}html body>ul,html body>ol{margin-bottom:16px}html body ul,html body ol{padding-left:2em}html body ul.no-list,html body ol.no-list{padding:0;list-style-type:none}html body ul ul,html body ul ol,html body ol ol,html body ol ul{margin-top:0;margin-bottom:0}html body li{margin-bottom:0}html body li.task-list-item{list-style:none}html body li>p{margin-top:0;margin-bottom:0}html body .task-list-item-checkbox{margin:0 .2em .25em -1.8em;vertical-align:middle}html body .task-list-item-checkbox:hover{cursor:pointer}html body blockquote{margin:16px 0;font-size:inherit;padding:0 15px;color:#5c5c5c;border-left:4px solid #d6d6d6}html body blockquote>:first-child{margin-top:0}html body blockquote>:last-child{margin-bottom:0}html body hr{height:4px;margin:32px 0;background-color:#d6d6d6;border:0 none}html body table{margin:10px 0 15px 0;border-collapse:collapse;border-spacing:0;display:block;width:100%;overflow:auto;word-break:normal;word-break:keep-all}html body table th{font-weight:bold;color:#000}html body table td,html body table th{border:1px solid #d6d6d6;padding:6px 13px}html body dl{padding:0}html body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:bold}html body dl dd{padding:0 16px;margin-bottom:16px}html body code{font-family:Menlo,Monaco,Consolas,'Courier New',monospace;font-size:.85em !important;color:#000;background-color:#f0f0f0;border-radius:3px;padding:.2em 0}html body code::before,html body code::after{letter-spacing:-0.2em;content:"\00a0"}html body pre>code{padding:0;margin:0;font-size:.85em !important;word-break:normal;white-space:pre;background:transparent;border:0}html body .highlight{margin-bottom:16px}html body .highlight pre,html body pre{padding:1em;overflow:auto;font-size:.85em !important;line-height:1.45;border:#d6d6d6;border-radius:3px}html body .highlight pre{margin-bottom:0;word-break:normal}html body pre code,html body pre tt{display:inline;max-width:initial;padding:0;margin:0;overflow:initial;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}html body pre code:before,html body pre tt:before,html body pre code:after,html body pre tt:after{content:normal}html body p,html body blockquote,html body ul,html body ol,html body dl,html body pre{margin-top:0;margin-bottom:16px}html body kbd{color:#000;border:1px solid #d6d6d6;border-bottom:2px solid #c7c7c7;padding:2px 4px;background-color:#f0f0f0;border-radius:3px}@media print{html body{background-color:#fff}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{color:#000;page-break-after:avoid}html body blockquote{color:#5c5c5c}html body pre{page-break-inside:avoid}html body table{display:table}html body img{display:block;max-width:100%;max-height:100%}html body pre,html body code{word-wrap:break-word;white-space:pre}}.markdown-preview{width:100%;height:100%;box-sizing:border-box}.markdown-preview .pagebreak,.markdown-preview .newpage{page-break-before:always}.markdown-preview pre.line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}.markdown-preview pre.line-numbers>code{position:relative}.markdown-preview pre.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:1em;font-size:100%;left:0;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-preview pre.line-numbers .line-numbers-rows>span{pointer-events:none;display:block;counter-increment:linenumber}.markdown-preview pre.line-numbers .line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}.markdown-preview .mathjax-exps .MathJax_Display{text-align:center !important}.markdown-preview:not([for="preview"]) .code-chunk .btn-group{display:none}.markdown-preview:not([for="preview"]) .code-chunk .status{display:none}.markdown-preview:not([for="preview"]) .code-chunk .output-div{margin-bottom:16px}.scrollbar-style::-webkit-scrollbar{width:8px}.scrollbar-style::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}.scrollbar-style::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,0.66);border:4px solid rgba(150,150,150,0.66);background-clip:content-box}html body[for="html-export"]:not([data-presentation-mode]){position:relative;width:100%;height:100%;top:0;left:0;margin:0;padding:0;overflow:auto}html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{position:relative;top:0}@media screen and (min-width:914px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{padding:2em calc(50% - 457px + 2em)}}@media screen and (max-width:914px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{font-size:14px !important;padding:1em}}@media print{html body[for="html-export"]:not([data-presentation-mode]) #sidebar-toc-btn{display:none}}html body[for="html-export"]:not([data-presentation-mode]) #sidebar-toc-btn{position:fixed;bottom:8px;left:8px;font-size:28px;cursor:pointer;color:inherit;z-index:99;width:32px;text-align:center;opacity:.4}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] #sidebar-toc-btn{opacity:1}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc{position:fixed;top:0;left:0;width:300px;height:100%;padding:32px 0 48px 0;font-size:14px;box-shadow:0 0 4px rgba(150,150,150,0.33);box-sizing:border-box;overflow:auto;background-color:inherit}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar{width:8px}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,0.66);border:4px solid rgba(150,150,150,0.66);background-clip:content-box}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc a{text-decoration:none}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc ul{padding:0 1.6em;margin-top:.8em}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc li{margin-bottom:.8em}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc ul{list-style-type:none}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{left:300px;width:calc(100% -  300px);padding:2em calc(50% - 457px -  150px);margin:0;box-sizing:border-box}@media screen and (max-width:1274px){html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{width:100%}}html body[for="html-export"]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .markdown-preview{left:50%;transform:translateX(-50%)}html body[for="html-export"]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .md-sidebar-toc{display:none}
/* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */

      </style>
    </head>
    <body for="html-export">
      <div class="mume markdown-preview  ">
      <p>&#x7EFC;&#x5408;&#x5B9E;&#x8BAD;&#x9879;&#x76EE;&#x62A5;&#x544A;<br>
&#x7F51;&#x7EDC;&#x6D41;&#x91CF;&#x5728;&#x7EBF;&#x5206;&#x6790;&#x7CFB;&#x7EDF;&#x7684;&#x8BBE;&#x8BA1;&#x4E0E;&#x5B9E;&#x73B0;</p>
<h1 class="mume-header" id="%E6%91%98%E8%A6%81">&#x6458;&#x8981;</h1>

<p>&#x672C;&#x9879;&#x76EE;&#x4F7F;&#x7528; <code>Winpcap</code> &#x6216;&#x8005; <code>libpcap</code> &#x7B49;&#x7B2C;&#x4E09;&#x65B9;&#x5E93;&#x51FD;&#x6570;&#xFF0C;&#x8BBE;&#x8BA1;&#x5B9E;&#x73B0;&#x4E00;&#x4E2A;&#x7F51;&#x7EDC;&#x6D41;&#x91CF;&#x7684;&#x6355;&#x83B7;&#x5206;&#x6790;&#x7CFB;&#x7EDF;&#xFF0C;&#x5B8C;&#x6210;&#x5BF9;&#x6307;&#x5B9A;&#x7F51;&#x5361;&#x8BBE;&#x5907;&#x7684;&#x7F51;&#x7EDC;&#x6D41;&#x91CF;&#x7684;&#x6355;&#x83B7;&#x3001;&#x5404;&#x5C42;&#x7F51;&#x7EDC;&#x4E0D;&#x540C;&#x534F;&#x8BAE;&#x5206;&#x6790;&#x3001;&#x6570;&#x636E;&#x63D0;&#x53D6;&#x7EDF;&#x8BA1;&#x5E76;&#x8FDB;&#x884C;&#x6D41;&#x91CF;&#x7279;&#x5F81;&#x7684;&#x5206;&#x6790;&#x7B49;&#x529F;&#x80FD;&#x3002;&#x5BF9;&#x6D41;&#x91CF;&#x7684;&#x6355;&#x83B7;&#x548C;&#x5206;&#x6790;&#x5904;&#x7406;&#x4F7F;&#x7528;&#x591A;&#x7EBF;&#x7A0B;&#x6765;&#x5E76;&#x884C;&#x6267;&#x884C;&#xFF0C;&#x5BF9;&#x6355;&#x83B7;&#x5230;&#x7684;&#x6570;&#x636E;&#x5305;&#x6839;&#x636E;&#x5404;&#x5C42;&#x534F;&#x8BAE;&#x8FDB;&#x884C;&#x63D0;&#x53D6;&#x5206;&#x6790;&#x5904;&#x7406;&#xFF0C;&#x5C06;&#x4E3B;&#x8981;&#x4FE1;&#x606F;&#xFF0C;&#x5982;&#x6E90;&#x5730;&#x5740;&#x3001;&#x76EE;&#x7684;&#x5730;&#x5740;&#x53CA;&#x5176;&#x7AEF;&#x53E3;&#x548C;&#x534F;&#x8BAE;&#x7B49;&#x8FDB;&#x884C;&#x5B58;&#x50A8;&#xFF0C;&#x5E76;&#x636E;&#x6B64;&#x4F7F;&#x7528;&#x53CC;&#x5411;Hash&#x94FE;&#x8868;&#x7684;&#x65B9;&#x5F0F;&#x5B58;&#x50A8;&#x4E0D;&#x540C;&#x94FE;&#x63A5;&#x7684;&#x5EFA;&#x7ACB;&#x60C5;&#x51B5;&#xFF0C;&#x5206;&#x6790;&#x5904;&#x7406;&#x4E0D;&#x540C;&#x94FE;&#x63A5;&#x5728;&#x4E0D;&#x540C;&#x65F6;&#x95F4;&#x6BB5;&#x5185;&#x7684;&#x6D41;&#x91CF;&#x3001;&#x6570;&#x636E;&#x5305;&#x7B49;&#x4FE1;&#x606F;&#x3002;</p>
<h1 class="mume-header" id="%E5%85%B3%E9%94%AE%E5%AD%97">&#x5173;&#x952E;&#x5B57;</h1>

<p>Winpcap &#x6D41;&#x91CF;&#x6355;&#x83B7; &#x7F51;&#x7EDC;&#x534F;&#x8BAE;&#x5206;&#x6790; &#x6D41;&#x91CF;&#x7279;&#x5F81;&#x5904;&#x7406; &#x7F51;&#x7EDC;&#x534F;&#x8BAE;</p>
<h1 class="mume-header" id="1%E7%BB%AA%E8%AE%BA">1.&#x7EEA;&#x8BBA;</h1>

<h2 class="mume-header" id="11-%E8%AF%BE%E9%A2%98%E7%A0%94%E7%A9%B6%E8%83%8C%E6%99%AF">1.1 &#x8BFE;&#x9898;&#x7814;&#x7A76;&#x80CC;&#x666F;</h2>

<p>&#x672C;&#x9879;&#x76EE;&#x662F;&#x5728;&#x5B66;&#x4E60;&#x5B8C;&#x300A;&#x8BA1;&#x7B97;&#x673A;&#x7F51;&#x7EDC;&#x300B;&#x4E3A;&#x4E3B;&#x7684;&#x8BFE;&#x7A0B;&#x540E;&#x8FDB;&#x884C;&#x7684;&#x4E00;&#x6B21;&#x504F;&#x5411;&#x5E94;&#x7528;&#x7684;&#x7F51;&#x7EDC;&#x6D41;&#x91CF;&#x5206;&#x6790;&#x4EFB;&#x52A1;&#xFF0C;&#x901A;&#x8FC7;&#x672C;&#x9879;&#x76EE;&#x4E3B;&#x8981;&#x52A0;&#x6DF1;&#x638C;&#x63E1;&#x8BA1;&#x7B97;&#x673A;&#x7F51;&#x7EDC;&#x5728;&#x4E0D;&#x540C;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x4E2D;&#x7684;&#x4E00;&#x79CD;&#x6293;&#x53D6;&#x65B9;&#x5F0F;&#xFF0C;&#x4EE5;&#x53CA;&#x6D41;&#x91CF;&#x5206;&#x6790;&#x5904;&#x7406;&#x7684;&#x65B9;&#x5F0F;&#x3002;</p>
<h2 class="mume-header" id="12-%E8%AF%BE%E9%A2%98%E7%A0%94%E7%A9%B6%E7%9A%84%E7%9B%AE%E7%9A%84%E5%92%8C%E6%84%8F%E4%B9%89">1.2 &#x8BFE;&#x9898;&#x7814;&#x7A76;&#x7684;&#x76EE;&#x7684;&#x548C;&#x610F;&#x4E49;</h2>

<p>&#x8BFE;&#x9898;&#x7814;&#x7A76;&#x7684;&#x76EE;&#x7684;&#x662F;&#x5B8C;&#x6210;&#x5982;&#x4E0B;&#x529F;&#x80FD;&#xFF1A;</p>
<ul>
<li>&#x80FD;&#x591F;&#x5B9E;&#x65F6;&#x6293;&#x53D6;&#x6307;&#x5B9A;&#x7F51;&#x7EDC;&#x8BBE;&#x5907;&#x5728;&#x4E00;&#x5B9A;&#x65F6;&#x95F4;&#x5185;&#x7684;&#x6570;&#x636E;&#x5305;&#xFF0C;&#x7528;&#x6237;&#x53EF;&#x4EE5;&#x81EA;&#x884C;&#x5B9A;&#x4E49;&#x6570;&#x636E;&#x5305;&#x7684;&#x8FC7;&#x6EE4;&#x65B9;&#x5F0F;&#x3002;</li>
<li>&#x5BF9;&#x6355;&#x83B7;&#x5230;&#x7684;&#x6570;&#x636E;&#x5305;&#x8FDB;&#x884C;&#x5206;&#x6790;&#x5904;&#x7406;&#xFF0C;&#x9010;&#x5C42;&#x5206;&#x6790;&#x6570;&#x636E;&#x5305;&#x4E0D;&#x540C;&#x7F51;&#x7EDC;&#x5C42;&#x4E2D;&#x7684;&#x534F;&#x8BAE;&#xFF0C;&#x5E76;&#x80FD;&#x4E00;&#x5B9A;&#x7A0B;&#x5EA6;&#x4E0A;&#x663E;&#x793A;&#x534F;&#x8BAE;&#x7684;&#x4E3B;&#x8981;&#x5B57;&#x6BB5;&#x5185;&#x5BB9;&#x3002;&#x5982;&#x8BC6;&#x522B;&#x663E;&#x793A;TCP&#x534F;&#x8BAE;&#x4EE5;&#x53CA;&#x5EFA;&#x7ACB;&#x8FC7;&#x7A0B;&#x7B49;&#x7B49;&#x3002;</li>
<li>&#x5BF9;&#x5206;&#x6790;&#x5904;&#x7406;&#x5230;&#x7684;&#x6570;&#x636E;&#x8981;&#x4F7F;&#x7528;hash&#x94FE;&#x8868;&#x4FDD;&#x5B58;&#x6BCF;&#x4E00;&#x4E2A;&#x7F51;&#x7EDC;&#x94FE;&#x63A5;&#x7684;&#x5EFA;&#x7ACB;&#x8FC7;&#x7A0B;&#x53CA;&#x6570;&#x636E;&#xFF0C;&#x5E76;&#x4EE5;&#x53CC;&#x5411;&#x6D41;&#x7684;&#x5F62;&#x5F0F;&#x5B58;&#x50A8;&#x3002;</li>
<li>&#x5BF9;&#x56FA;&#x5B9A;&#x65F6;&#x95F4;&#x6BB5;&#x5185;&#x7684;&#x7F51;&#x7EDC;&#x6D41;&#x91CF;&#x8FDB;&#x884C;&#x7EDF;&#x8BA1;&#xFF0C;&#x5982;&#x5EFA;&#x7ACB;&#x7684;TCP&#x6570;&#x91CF;&#x3001;UDP&#x6D41;&#x91CF;&#x7B49;&#x7B49;&#x5185;&#x5BB9;&#xFF0C;&#x540C;&#x65F6;&#x5C3D;&#x53EF;&#x80FD;&#x7684;&#x5904;&#x7406;&#x51FA;&#x66F4;&#x4E0A;&#x5C42;&#x7684;&#x534F;&#x8BAE;&#x7C7B;&#x578B;&#xFF0C;&#x5982;&#x8BC6;&#x522B;&#x51FA;&#x662F;&#x5426;&#x4E3A;DNS&#x3001;SMTP&#x7B49;&#x534F;&#x8BAE;&#x7684;&#x6D41;&#x91CF;&#xFF0C;&#x53CA;&#x5BF9;&#x6D41;&#x91CF;&#x7279;&#x5F81;&#x7684;&#x63D0;&#x53D6;&#x3002;</li>
</ul>
<h1 class="mume-header" id="2-%E4%B8%BB%E8%A6%81%E4%BB%AA%E5%99%A8%E5%8F%8A%E8%AF%95%E6%9D%90">2. &#x4E3B;&#x8981;&#x4EEA;&#x5668;&#x53CA;&#x8BD5;&#x6750;</h1>

<ul>
<li>&#x9700;&#x8981;&#x7684;&#x786C;&#x4EF6;&#x8BBE;&#x5907;&#x6709;&#xFF1A; &#x53F0;&#x5F0F;&#x8BA1;&#x7B97;&#x673A;&#x6216;&#x7B14;&#x8BB0;&#x672C;&#x8BA1;&#x7B97;&#x673A;(&#x542B;&#x7F51;&#x7EDC;&#x9002;&#x914D;&#x5668;)</li>
<li>&#x9700;&#x8981;&#x7684;&#x8F6F;&#x4EF6;&#x8BBE;&#x5907;&#x6709;&#xFF1A;</li>
<li>Windows&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x6216;Linux&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;</li>
<li>&#x7F51;&#x7EDC;&#x6570;&#x636E;&#x5305;&#x6355;&#x83B7;&#x51FD;&#x6570;&#x5305;&#xFF0C;Windows&#x5E73;&#x53F0;&#x4E3A;winpcap&#xFF0C;Linux&#x5E73;&#x53F0;&#x4E0B;&#x4E3A;libpcap&#x3002;&#x8FD9;&#x4E24;&#x4E2A;&#x51FD;&#x6570;&#x5305;&#x53EF;&#x5728;&#x7F51;&#x4E0A;&#x4E0B;&#x8F7D;&#x5B89;&#x88C5;&#x3002;</li>
<li>&#x7F16;&#x7A0B;&#x8BED;&#x8A00;&#x9009;&#x7528;C/C++&#x3002;</li>
</ul>
<h1 class="mume-header" id="3-%E8%AF%BE%E9%A2%98%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE">3. &#x8BFE;&#x9898;&#x73AF;&#x5883;&#x914D;&#x7F6E;</h1>

<p>&#x8BBE;&#x5907;&#x73AF;&#x5883;&#x4E3A;Win10&#xFF0C;&#x4F7F;&#x7528;Vscode&#x7F16;&#x5199;&#x7BA1;&#x7406;&#x9879;&#x76EE;&#xFF0C;&#x5E76;&#x4F7F;&#x7528; Mingw64 &#x7F16;&#x8BD1;&#x5668;&#x6765;&#x7F16;&#x8BD1;&#x8C03;&#x8BD5;C/C++&#x9879;&#x76EE;&#x4EE3;&#x7801;&#xFF0C;&#x4F7F;&#x7528;Winpcap&#x51FD;&#x6570;&#xFF0C;&#x57FA;&#x672C;&#x914D;&#x7F6E;&#x60C5;&#x51B5;&#x5982;&#x4E0B;&#xFF1A;</p>
<ul>
<li>&#x9996;&#x5148;&#x4FDD;&#x8BC1;Vscode&#x53EF;&#x4EE5;&#x8FD0;&#x884C;&#x8C03;&#x8BD5;C/C++&#x4EE3;&#x7801;&#xFF0C;&#x5E76;&#x80FD;&#x901A;&#x8FC7;&#x4EFB;&#x52A1;&#x7684;&#x65B9;&#x5F0F;&#x6765;&#x591A;&#x6587;&#x4EF6;&#x7F16;&#x8BD1;&#x9879;&#x76EE;&#x6587;&#x4EF6;</li>
<li>&#x4E0B;&#x8F7D;Winpcap&#x7684;&#x5F00;&#x53D1;&#x5305;&#xFF0C;&#x5E76;&#x914D;&#x7F6E;&#x9879;&#x76EE;&#x6240;&#x5728;&#x7684;&#x5DE5;&#x4F5C;&#x533A;&#x7684; <code>task.json</code> &#x548C; <code>c_cpp_properties.json</code> &#x6587;&#x4EF6;&#xFF0C;&#x524D;&#x8005;&#x6307;&#x5B9A;&#x9879;&#x76EE;&#x7F16;&#x8BD1;&#x7684;&#x7F16;&#x8BD1;&#x547D;&#x4EE4;&#xFF0C;&#x5305;&#x62EC;&#x591A;&#x6587;&#x4EF6;&#x3001;&#x7B2C;&#x4E09;&#x65B9;include&#x6587;&#x4EF6;&#x4EE5;&#x53CA;&#x5404;&#x79CD;&#x94FE;&#x63A5;&#x6587;&#x4EF6;&#xFF1B;&#x540E;&#x8005;&#x6307;&#x5B9A;&#x4EE3;&#x7801;&#x7F16;&#x8F91;&#x65F6;&#x9700;&#x8981;&#x7684;include&#x5934;&#x6587;&#x4EF6;&#xFF0C;&#x4EE5;&#x63D0;&#x4F9B;&#x826F;&#x597D;&#x7684;&#x4EE3;&#x7801;&#x81EA;&#x52A8;&#x8865;&#x5168;&#x529F;&#x80FD;</li>
</ul>
<pre data-role="codeBlock" data-info="json" class="language-json"><span class="token comment">// task.json</span>
<span class="token punctuation">{</span>
  <span class="token property">&quot;tasks&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;shell&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;label&quot;</span><span class="token operator">:</span> <span class="token string">&quot;build&quot;</span><span class="token punctuation">,</span>
      <span class="token comment">// &quot;command&quot;: &quot;D:\\mingw64\\bin\\gcc.exe&quot;,</span>
      <span class="token property">&quot;command&quot;</span><span class="token operator">:</span> <span class="token string">&quot;D:\\mingw64\\bin\\g++.exe&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;args&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">&quot;-g&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;-std=c++17&quot;</span><span class="token punctuation">,</span>

        <span class="token string">&quot;-LG:\\&#x5B9E;&#x9A8C;&#x62A5;&#x544A;\\&#x5B9E;&#x8BAD;\\WpdPack_4_1_2\\WpdPack\\Lib\\x64&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;-IG:\\&#x5B9E;&#x9A8C;&#x62A5;&#x544A;\\&#x5B9E;&#x8BAD;\\WpdPack_4_1_2\\WpdPack\\Include&quot;</span><span class="token punctuation">,</span>

        <span class="token string">&quot;-finput-charset=UTF-8&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;-fexec-charset=GBK&quot;</span><span class="token punctuation">,</span>
        
        <span class="token string">&quot;${fileDirname}\\global.cpp&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;${fileDirname}\\get_devs.cpp&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;${fileDirname}\\catch_packets.cpp&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;${fileDirname}\\analysis_struct.cpp&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;${file}&quot;</span><span class="token punctuation">,</span>

        <span class="token string">&quot;-o&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;${fileDirname}\\${fileBasenameNoExtension}.exe&quot;</span><span class="token punctuation">,</span>
        
        <span class="token string">&quot;-lwsock32&quot;</span><span class="token punctuation">,</span>  <span class="token comment">// #include&lt;winsock2.h&gt; &#x4F7F;&#x7528;</span>
        <span class="token string">&quot;-lwpcap&quot;</span><span class="token punctuation">,</span>    <span class="token comment">// #include&lt;pcap.h&gt; &#x4F7F;&#x7528;</span>
        <span class="token string">&quot;-lws2_32&quot;</span><span class="token punctuation">,</span>    <span class="token comment">// #include&lt;ws2tcpip.h&gt; &#x4F7F;&#x7528;</span>
        <span class="token string">&quot;-lpthread&quot;</span>   <span class="token comment">// #include&lt;pthread.h&gt; &#x4F7F;&#x7528;</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token property">&quot;options&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;cwd&quot;</span><span class="token operator">:</span> <span class="token string">&quot;D:\\mingw64\\bin&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">&quot;problemMatcher&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">&quot;$gcc&quot;</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2.0.0&quot;</span>
<span class="token punctuation">}</span>
</pre><pre data-role="codeBlock" data-info="json" class="language-json"><span class="token comment">// c_cpp_properties.json</span>
<span class="token punctuation">{</span>
    <span class="token property">&quot;configurations&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Win64&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;includePath&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token string">&quot;${workspaceRoot}&quot;</span><span class="token punctuation">,</span>
                <span class="token string">&quot;D:\\mingw64\\lib\\gcc\\x86_64-w64-mingw32\\8.1.0\\include\\&quot;</span><span class="token punctuation">,</span>
                <span class="token string">&quot;G:\\&#x5B9E;&#x9A8C;&#x62A5;&#x544A;\\&#x5B9E;&#x8BAD;\\WpdPack_4_1_2\\WpdPack\\Include\\&quot;</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token property">&quot;defines&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token string">&quot;_DEBUG&quot;</span><span class="token punctuation">,</span>
                <span class="token string">&quot;UNICODE&quot;</span><span class="token punctuation">,</span>
                <span class="token string">&quot;_UNICODE&quot;</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token property">&quot;browse&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token property">&quot;path&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                    <span class="token string">&quot;${workspaceRoot}&quot;</span><span class="token punctuation">,</span>
                    <span class="token string">&quot;D:\\mingw64\\lib\\gcc\\x86_64-w64-mingw32\\8.1.0\\include\\&quot;</span><span class="token punctuation">,</span>
                    <span class="token string">&quot;G:\\&#x5B9E;&#x9A8C;&#x62A5;&#x544A;\\&#x5B9E;&#x8BAD;\\WpdPack_4_1_2\\WpdPack\\Include\\&quot;</span>
                <span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token property">&quot;limitSymbolsToIncludedHeaders&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token property">&quot;compilerPath&quot;</span><span class="token operator">:</span> <span class="token string">&quot;D:\\mingw64\\bin\\g++.exe&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;cStandard&quot;</span><span class="token operator">:</span> <span class="token string">&quot;c11&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;cppStandard&quot;</span><span class="token operator">:</span> <span class="token string">&quot;c++17&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;intelliSenseMode&quot;</span><span class="token operator">:</span> <span class="token string">&quot;gcc-x64&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token number">4</span>
<span class="token punctuation">}</span>
</pre><h1 class="mume-header" id="4%E7%B3%BB%E7%BB%9F%E4%B8%BB%E8%A6%81%E6%B5%81%E7%A8%8B%E8%AE%BE%E8%AE%A1%E5%88%86%E6%9E%90">4.&#x7CFB;&#x7EDF;&#x4E3B;&#x8981;&#x6D41;&#x7A0B;&#x8BBE;&#x8BA1;&#x5206;&#x6790;</h1>

<h2 class="mume-header" id="41-%E8%8E%B7%E5%8F%96%E6%9C%AC%E6%9C%BA%E8%AE%BE%E5%A4%87%E6%89%80%E6%9C%89%E7%9A%84%E7%BD%91%E7%BB%9C%E6%8E%A5%E5%8F%A3%E8%AE%BE%E5%A4%87">4.1 &#x83B7;&#x53D6;&#x672C;&#x673A;&#x8BBE;&#x5907;&#x6240;&#x6709;&#x7684;&#x7F51;&#x7EDC;&#x63A5;&#x53E3;&#x8BBE;&#x5907;</h2>

<p>&#x540C;Linux&#x5BF9;&#x8BBE;&#x5907;&#x7684;&#x89E3;&#x91CA;&#x7C7B;&#x4F3C;&#xFF0C;&#x53EF;&#x4EE5;&#x7406;&#x89E3;Winpcap&#x5C06;&#x7F51;&#x5361;&#x8BBE;&#x5907;&#x89E3;&#x91CA;&#x6210;&#x5404;&#x79CD;&#x6587;&#x4EF6;&#x8BBE;&#x5907;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;winpcap&#x51FD;&#x6570;&#x5305;&#x4E2D; <code>pcap_findalldevs_ex()</code> &#x51FD;&#x6570;&#x6765;&#x83B7;&#x53D6;&#x6240;&#x6709;&#x7684;&#x7F51;&#x5361;&#x8BBE;&#x5907;&#xFF0C;&#x7136;&#x540E;&#x901A;&#x8FC7; <code>pcap_open()</code> &#x51FD;&#x6570;&#x6765;&#x6253;&#x5F00;&#x6307;&#x5B9A;&#x7684;&#x7F51;&#x5361;&#x8BBE;&#x5907;&#xFF0C;&#x5BF9;&#x4E8E;&#x7A0B;&#x5E8F;&#x7ED3;&#x675F;&#x540E;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; <code>pcap_freealldevs()</code> &#x6765;&#x91CA;&#x653E;&#x6240;&#x6709;&#x7684;&#x8BBE;&#x5907;&#x3002;</p>
<p>&#x672C;&#x9879;&#x76EE;&#x5C06;&#x83B7;&#x53D6;&#x7F51;&#x5361;&#x8BBE;&#x5907;&#x8FC7;&#x7A0B;&#x5206;&#x79BB;&#x4E3A;&#x4E00;&#x4E2A;&#x5355;&#x72EC;&#x6A21;&#x5757;&#xFF0C;&#x5927;&#x81F4;&#x6D41;&#x7A0B;&#x5982;&#x4E0B;&#xFF1A;</p>
<p code_chunk_offset="0" cmd="true" hide="true"><!--?xml version="1.0" encoding="UTF-8" standalone="no"?--><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" contentscripttype="application/ecmascript" contentstyletype="text/css" height="552.3342px" preserveAspectRatio="none" style="width:394px;height:552px;" version="1.1" viewBox="0 0 394 552" width="394.1032px" zoomAndPan="magnify"><defs><filter height="300%" id="finj6kfro0602" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="1.9656019656019657"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="3.9312039312039313" dy="3.9312039312039313" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><ellipse cx="194.1032" cy="17.6904" fill="#000000" filter="url(#finj6kfro0602)" rx="9.828" ry="9.828" style="stroke: none; stroke-width: 0.9828009828009828;"/><ellipse cx="194.1032" cy="531.6953" fill="none" filter="url(#finj6kfro0602)" rx="9.828" ry="9.828" style="stroke: #000000; stroke-width: 0.9828009828009828;"/><ellipse cx="194.5946" cy="532.1867" fill="#000000" rx="5.8968" ry="5.8968" style="stroke: none; stroke-width: 0.9828009828009828;"/><rect fill="#FEFECE" filter="url(#finj6kfro0602)" height="375.93" rx="12.285" ry="12.285" style="stroke: #A80036; stroke-width: 1.4742014742014742;" width="376.4128" x="5.8968" y="86.4865"/><rect fill="#FFFFFF" height="320.3931" rx="12.285" ry="12.285" style="stroke: #FFFFFF; stroke-width: 0.9828009828009828;" width="370.516" x="8.8452" y="139.075"/><line style="stroke: #A80036; stroke-width: 1.4742014742014742;" x1="5.8968" x2="382.3096" y1="136.1266" y2="136.1266"/><line style="stroke: #A80036; stroke-width: 1.4742014742014742;" x1="5.8968" x2="382.3096" y1="115.1058" y2="115.1058"/><text fill="#000000" font-family="sans-serif" font-size="13.7592" lengthAdjust="spacingAndGlyphs" textLength="57.0025" x="165.602" y="107.1685">get_devs</text><text fill="#000000" font-family="sans-serif" font-size="11.7936" lengthAdjust="spacingAndGlyphs" textLength="35.3808" x="10.8108" y="128.6212">&#x4E3B;&#x7A0B;&#x5E8F;</text><ellipse cx="180.8354" cy="158.731" fill="#000000" filter="url(#finj6kfro0602)" rx="9.828" ry="9.828" style="stroke: none; stroke-width: 0.9828009828009828;"/><rect fill="#FEFECE" filter="url(#finj6kfro0602)" height="39.312" rx="12.285" ry="12.285" style="stroke: #A80036; stroke-width: 1.4742014742014742;" width="328.2555" x="16.7076" y="203.9398"/><text fill="#000000" font-family="sans-serif" font-size="13.7592" lengthAdjust="spacingAndGlyphs" textLength="318.4275" x="21.6216" y="229.9682">&#x4F7F;&#x7528;pcap_findalldevs_ex&#x83B7;&#x53D6;&#x6240;&#x6709;&#x7684;&#x7F51;&#x5361;&#x8BBE;&#x5907;&#x5E76;&#x663E;&#x793A;</text><rect fill="#FEFECE" filter="url(#finj6kfro0602)" height="39.312" rx="12.285" ry="12.285" style="stroke: #A80036; stroke-width: 1.4742014742014742;" width="174.9386" x="93.3661" y="278.6327"/><text fill="#000000" font-family="sans-serif" font-size="13.7592" lengthAdjust="spacingAndGlyphs" textLength="165.1106" x="98.2801" y="304.6611">&#x7528;&#x6237;&#x9009;&#x62E9;&#x4E00;&#x4E2A;&#x6307;&#x5B9A;&#x7F51;&#x5361;&#x8BBE;&#x5907;</text><rect fill="#FEFECE" filter="url(#finj6kfro0602)" height="39.312" rx="12.285" ry="12.285" style="stroke: #A80036; stroke-width: 1.4742014742014742;" width="217.199" x="72.2359" y="353.3256"/><text fill="#000000" font-family="sans-serif" font-size="13.7592" lengthAdjust="spacingAndGlyphs" textLength="207.371" x="77.1499" y="379.354">pcap_open&#x6253;&#x5F00;&#x5E76;&#x4FDD;&#x5B58;&#x8BE5;&#x8BBE;&#x5907;&#x4FE1;&#x606F;</text><ellipse cx="180.8354" cy="437.8465" fill="none" filter="url(#finj6kfro0602)" rx="9.828" ry="9.828" style="stroke: #000000; stroke-width: 0.9828009828009828;"/><ellipse cx="181.3268" cy="438.3379" fill="#000000" rx="5.8968" ry="5.8968" style="stroke: none; stroke-width: 0.9828009828009828;"/><!--MD5=[c74a63e37dd38ca3998a629ce7f2f0a6]
link *start*get_devs to 使用pcap_findalldevs_ex获取所有的网卡设备并显示--><path d="M180.8354,168.7261 C180.8354,176.5492 180.8354,188.2386 180.8354,198.732 " fill="none" id="*start*get_devs-&gt;&#x4F7F;&#x7528;pcap_findalldevs_ex&#x83B7;&#x53D6;&#x6240;&#x6709;&#x7684;&#x7F51;&#x5361;&#x8BBE;&#x5907;&#x5E76;&#x663E;&#x793A;" style="stroke: #A80036; stroke-width: 0.9828009828009828;"/><polygon fill="#A80036" points="180.8354,203.7649,184.7666,194.9197,180.8354,198.8509,176.9042,194.9197,180.8354,203.7649" style="stroke: #A80036; stroke-width: 0.9828009828009828;"/><!--MD5=[0d4fde20c664b004ef18ee73d05bead5]
link 使用pcap_findalldevs_ex获取所有的网卡设备并显示 to 用户选择一个指定网卡设备--><path d="M180.8354,243.3079 C180.8354,252.4823 180.8354,263.6342 180.8354,273.415 " fill="none" id="&#x4F7F;&#x7528;pcap_findalldevs_ex&#x83B7;&#x53D6;&#x6240;&#x6709;&#x7684;&#x7F51;&#x5361;&#x8BBE;&#x5907;&#x5E76;&#x663E;&#x793A;-&gt;&#x7528;&#x6237;&#x9009;&#x62E9;&#x4E00;&#x4E2A;&#x6307;&#x5B9A;&#x7F51;&#x5361;&#x8BBE;&#x5907;" style="stroke: #A80036; stroke-width: 0.9828009828009828;"/><polygon fill="#A80036" points="180.8354,278.388,184.7666,269.5428,180.8354,273.474,176.9042,269.5428,180.8354,278.388" style="stroke: #A80036; stroke-width: 0.9828009828009828;"/><!--MD5=[35061ef6a56e095ee08869c48a2aa500]
link 用户选择一个指定网卡设备 to pcap_open打开并保存该设备信息--><path d="M180.8354,318.0008 C180.8354,327.1752 180.8354,338.3271 180.8354,348.1079 " fill="none" id="&#x7528;&#x6237;&#x9009;&#x62E9;&#x4E00;&#x4E2A;&#x6307;&#x5B9A;&#x7F51;&#x5361;&#x8BBE;&#x5907;-&gt;pcap_open&#x6253;&#x5F00;&#x5E76;&#x4FDD;&#x5B58;&#x8BE5;&#x8BBE;&#x5907;&#x4FE1;&#x606F;" style="stroke: #A80036; stroke-width: 0.9828009828009828;"/><polygon fill="#A80036" points="180.8354,353.0804,184.7666,344.2352,180.8354,348.1664,176.9042,344.2352,180.8354,353.0804" style="stroke: #A80036; stroke-width: 0.9828009828009828;"/><!--MD5=[f92a276fff2012eafb706b43c92f4b60]
link pcap_open打开并保存该设备信息 to *end*get_devs--><path d="M180.8354,392.8363 C180.8354,402.4256 180.8354,413.8828 180.8354,422.7056 " fill="none" id="pcap_open&#x6253;&#x5F00;&#x5E76;&#x4FDD;&#x5B58;&#x8BE5;&#x8BBE;&#x5907;&#x4FE1;&#x606F;-&gt;*end*get_devs" style="stroke: #A80036; stroke-width: 0.9828009828009828;"/><polygon fill="#A80036" points="180.8354,427.8183,184.7666,418.9731,180.8354,422.9043,176.9042,418.9731,180.8354,427.8183" style="stroke: #A80036; stroke-width: 0.9828009828009828;"/><!--MD5=[8a1fcff43715956ca40341346e8fd505]
link *start to get_devs--><path d="M194.1032,27.7504 C194.1032,38.4786 194.1032,57.8545 194.1032,81.1961 " fill="none" id="*start-&gt;get_devs" style="stroke: #A80036; stroke-width: 0.9828009828009828;"/><polygon fill="#A80036" points="194.1032,86.2349,198.0344,77.3897,194.1032,81.3209,190.172,77.3897,194.1032,86.2349" style="stroke: #A80036; stroke-width: 0.9828009828009828;"/><!--MD5=[f4c5610389b699d85a3d67569667043c]
link get_devs to *end--><path d="M194.1032,463.037 C194.1032,485.2412 194.1032,504.3148 194.1032,516.5 " fill="none" id="get_devs-&gt;*end" style="stroke: #A80036; stroke-width: 0.9828009828009828;"/><polygon fill="#A80036" points="194.1032,521.6004,198.0344,512.7552,194.1032,516.6864,190.172,512.7552,194.1032,521.6004" style="stroke: #A80036; stroke-width: 0.9828009828009828;"/><!--MD5=[aa7e94e8f3d82ebff744258ecd13f8c4]
@startuml
hide empty description
scale 400 width
[*] - -> get_devs
get_devs - -> [*]

get_devs: 主程序

state get_devs{
    [*] - -> 使用pcap_findalldevs_ex获取所有的网卡设备并显示
    使用pcap_findalldevs_ex获取所有的网卡设备并显示 - -> 用户选择一个指定网卡设备
    用户选择一个指定网卡设备 - -> pcap_open打开并保存该设备信息
    pcap_open打开并保存该设备信息 - -> [*]
}
@enduml

PlantUML version 1.2019.11(Sun Sep 22 18:02:15 CST 2019)
(MIT source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.8.0_211-b12
Operating System: Windows 10
Default Encoding: GBK
Language: zh
Country: CN
--></g></svg></p><p>&#x6B64;&#x6A21;&#x5757;&#x7684;&#x4EE3;&#x7801;&#x6587;&#x4EF6;&#x89C1;&#xFF1B; <code>get_devs.h</code> &#x4EE5;&#x53CA; <code>get_devs.cpp</code> &#xFF1A;</p>
<h3 class="mume-header" id="%E4%BB%A3%E7%A0%81">&#x4EE3;&#x7801;</h3>

<pre data-role="codeBlock" data-info="cpp" class="language-cpp"><span class="token macro property">#<span class="token directive keyword">ifndef</span> GET_DEVS</span>
<span class="token macro property">#<span class="token directive keyword">define</span> GET_DEVS</span>
<span class="token macro property">#<span class="token directive keyword">include</span><span class="token string">&quot;global.h&quot;</span></span>

<span class="token keyword">int</span> <span class="token function">get_devs</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>devs<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property">#<span class="token directive keyword">endif</span></span>
</pre><pre data-role="codeBlock" data-info="cpp" class="language-cpp"><span class="token macro property">#<span class="token directive keyword">include</span><span class="token string">&quot;get_devs.h&quot;</span></span>

<span class="token keyword">int</span> <span class="token function">get_devs</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>devs<span class="token punctuation">)</span><span class="token punctuation">{</span>
    pcap_if_t <span class="token operator">*</span>alldevs<span class="token punctuation">,</span> <span class="token operator">*</span>d<span class="token punctuation">;</span>
    <span class="token keyword">char</span> errbuf<span class="token punctuation">[</span>PCAP_ERRBUF_SIZE<span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token operator">~</span><span class="token function">pcap_findalldevs_ex</span><span class="token punctuation">(</span>PCAP_SRC_IF_STRING<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>alldevs<span class="token punctuation">,</span> errbuf<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">err_print</span><span class="token punctuation">(</span><span class="token string">&quot;Error in pcap_findalldevs_ex(): &quot;</span><span class="token punctuation">,</span> errbuf<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span>d <span class="token operator">=</span> alldevs<span class="token punctuation">;</span> d <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span> d <span class="token operator">=</span> d<span class="token operator">-&gt;</span>next<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%d. %s&quot;</span><span class="token punctuation">,</span> <span class="token operator">++</span>i<span class="token punctuation">,</span> d<span class="token operator">-&gt;</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>d<span class="token operator">-&gt;</span>description<span class="token punctuation">)</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot; (%s)\n&quot;</span><span class="token punctuation">,</span> d<span class="token operator">-&gt;</span>description<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot; (No description abailable\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>i<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;\n No interface found!, Make sure winpcap is installed. \n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Enter the interface number(1-%d): &quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> inum <span class="token operator">=</span> i<span class="token punctuation">;</span>
    <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">&quot;%d&quot;</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>inum<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>inum <span class="token operator">&lt;</span> <span class="token number">1</span> <span class="token operator">||</span> inum <span class="token operator">&gt;</span> i<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;\n Interface number out of range.\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">pcap_freealldevs</span><span class="token punctuation">(</span>alldevs<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">for</span><span class="token punctuation">(</span>d <span class="token operator">=</span> alldevs<span class="token punctuation">,</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> inum <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> d <span class="token operator">=</span> d<span class="token operator">-&gt;</span>next<span class="token punctuation">,</span> <span class="token operator">++</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">memcpy</span><span class="token punctuation">(</span>devs<span class="token punctuation">,</span> d<span class="token operator">-&gt;</span>name<span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span>d<span class="token operator">-&gt;</span>name<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    dev <span class="token operator">=</span> <span class="token punctuation">(</span>pcap_if_t<span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>pcap_if_t<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">memcpy</span><span class="token punctuation">(</span>dev<span class="token punctuation">,</span> d<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>pcap_if_t<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>dev_fp <span class="token operator">=</span> <span class="token function">pcap_open</span><span class="token punctuation">(</span>d<span class="token operator">-&gt;</span>name<span class="token punctuation">,</span>  <span class="token comment">// &#x8BBE;&#x5907;&#x540D;</span>
                             <span class="token number">65536</span><span class="token punctuation">,</span>     <span class="token comment">// &#x8981;&#x6355;&#x6349;&#x7684;&#x6570;&#x636E;&#x5305;&#x7684;&#x90E8;&#x5206; </span>
                                        <span class="token comment">// 65535&#x4FDD;&#x8BC1;&#x80FD;&#x6355;&#x83B7;&#x5230;&#x4E0D;&#x540C;&#x6570;&#x636E;&#x94FE;&#x8DEF;&#x5C42;&#x4E0A;&#x7684;&#x6BCF;&#x4E2A;&#x6570;&#x636E;&#x5305;&#x7684;&#x5168;&#x90E8;&#x5185;&#x5BB9;</span>
                             PCAP_OPENFLAG_PROMISCUOUS<span class="token punctuation">,</span>         <span class="token comment">// &#x6DF7;&#x6742;&#x6A21;&#x5F0F;</span>
                             <span class="token number">1000</span><span class="token punctuation">,</span>      <span class="token comment">// &#x8BFB;&#x53D6;&#x8D85;&#x65F6;&#x65F6;&#x95F4;</span>
                             <span class="token constant">NULL</span><span class="token punctuation">,</span>      <span class="token comment">// &#x8FDC;&#x7A0B;&#x673A;&#x5668;&#x9A8C;&#x8BC1;</span>
                             errbuf     <span class="token comment">// &#x9519;&#x8BEF;&#x7F13;&#x51B2;&#x6C60;</span>
                             <span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">err_print</span><span class="token punctuation">(</span><span class="token string">&quot;Unable to open the adapter. It is not supported by WinPcap\n&quot;</span><span class="token punctuation">,</span> errbuf<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">/* &#x91CA;&#x653E;&#x8BBE;&#x5907;&#x5217;&#x8868; */</span>
        <span class="token function">pcap_freealldevs</span><span class="token punctuation">(</span>alldevs<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">pcap_freealldevs</span><span class="token punctuation">(</span>alldevs<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</pre><h2 class="mume-header" id="42-%E6%95%B0%E6%8D%AE%E5%8C%85%E7%9A%84%E6%8D%95%E8%8E%B7%E5%B9%B6%E5%AD%98%E5%82%A8">4.2 &#x6570;&#x636E;&#x5305;&#x7684;&#x6355;&#x83B7;&#x5E76;&#x5B58;&#x50A8;</h2>

<p>winpcap&#x51FD;&#x6570;&#x5305;&#x4E2D;&#x5BF9;&#x7F51;&#x5361;&#x8BBE;&#x5907;&#x6570;&#x636E;&#x5305;&#x7684;&#x6355;&#x83B7;&#x662F;&#x901A;&#x8FC7; <code>pcap_loop</code> &#x51FD;&#x6570;&#x6765;&#x5B9E;&#x73B0;&#xFF0C;&#x5F53;&#x5176;&#x6355;&#x83B7;&#x5230;&#x4E00;&#x4E2A;&#x6570;&#x636E;&#x5305;&#x65F6;&#xFF0C;&#x5C31;&#x4F1A;&#x8C03;&#x7528;&#x4F5C;&#x4E3A;&#x53C2;&#x6570;&#x7684;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#xFF0C;&#x7531;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#x6765;&#x5904;&#x7406;&#x6570;&#x636E;&#x5305;&#xFF0C;&#x6B64;&#x5904;&#x5B9A;&#x4E49;&#x4E86;&#x4E00;&#x4E2A;&#x6570;&#x636E;&#x5305;&#x94FE;&#x8868;&#xFF0C;&#x7528;&#x4E8E;&#x5B58;&#x50A8;&#x6355;&#x83B7;&#x5230;&#x7684;&#x6240;&#x6709;&#x7684;&#x6570;&#x636E;&#x5305;&#xFF0C;&#x5E76;&#x4F5C;&#x4E3A;&#x5171;&#x4EAB;&#x6570;&#x636E;&#x7528;&#x4E8E;&#x540E;&#x7EED;&#x7684;&#x6D41;&#x91CF;&#x5206;&#x6790;&#x3002;&#x6570;&#x636E;&#x5305;&#x94FE;&#x8868;&#x8282;&#x70B9;&#x7684;&#x5927;&#x81F4;&#x7ED3;&#x6784;&#x4E3A;&#x4E00;&#x4E2A;&#x5B8C;&#x6210;&#x7684;&#x6570;&#x636E;&#x5305;&#x7ED3;&#x6784;&#x4EE5;&#x53CA;&#x6307;&#x5411;&#x4E0B;&#x4E00;&#x4E2A;&#x8282;&#x70B9;&#x7684;&#x6307;&#x9488;&#xFF0C;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#x7684;&#x5904;&#x7406;&#x4EFB;&#x52A1;&#x4EC5;&#x4E3A;&#x5C06;&#x6355;&#x83B7;&#x7684;&#x6570;&#x636E;&#x5305;&#x6DFB;&#x52A0;&#x5230;&#x6570;&#x636E;&#x5305;&#x94FE;&#x8868;&#x540E;&#x5373;&#x53EF;&#xFF1B;&#x6B64;&#x5916;&#xFF0C;&#x5728;&#x5F00;&#x59CB;&#x6570;&#x636E;&#x5305;&#x6355;&#x83B7;&#x65F6;&#xFF0C;&#x4F1A;&#x5F00;&#x542F;&#x4E00;&#x4E2A;&#x5B9A;&#x65F6;&#x8BA1;&#x6570;&#x7EBF;&#x7A0B;&#xFF0C;&#x7528;&#x4E8E;&#x5728;&#x7528;&#x6237;&#x6307;&#x5B9A;&#x7684;&#x6355;&#x83B7;&#x65F6;&#x95F4;&#x540E;&#x8FDB;&#x884C;&#x505C;&#x6B62;&#x6355;&#x83B7;&#x7684;&#x4F5C;&#x7528;&#xFF0C;&#x4F7F;&#x7528;&#x7684;&#x51FD;&#x6570;&#x662F;&#xFF1A; <code>pcap_breakloop()</code> &#x6765;&#x7ED3;&#x675F;&#x6307;&#x5B9A;&#x8BBE;&#x5907;&#x7684;&#x6355;&#x83B7;&#x3002;&#x6700;&#x540E;&#x5728;&#x6355;&#x83B7;&#x5B8C;&#x6210;&#x540E;&#x5C06;&#x6570;&#x636E;&#x5305;&#x94FE;&#x8868;&#x4FDD;&#x5B58;&#x7684;&#x6240;&#x6709;&#x6570;&#x636E;&#x5305;&#x5BFC;&#x51FA;&#x4E3A; <code>.pcap</code> &#x683C;&#x5F0F;&#x7684;&#x6587;&#x4EF6;&#xFF0C;&#x7528;&#x4E8E;&#x5176;&#x4ED6;&#x7A0B;&#x5E8F;&#x7684;&#x4F7F;&#x7528;&#x3002;&#x6B64;&#x5916;&#xFF0C;&#x5728;&#x8FDB;&#x884C;&#x6570;&#x636E;&#x5305;&#x6355;&#x83B7;&#x524D;&#xFF0C;&#x7528;&#x6237;&#x53EF;&#x4EE5;&#x6307;&#x5B9A;&#x6570;&#x636E;&#x5305;&#x6355;&#x83B7;&#x7684; <strong>&#x8FC7;&#x6EE4;&#x89C4;&#x5219;</strong> &#xFF0C;&#x5982; <code>ip</code> &#x4E3A;&#x4EC5;&#x6355;&#x83B7;&#x542B;&#x6709; ip &#x7684;&#x6570;&#x636E;&#x5305;&#xFF0C; <code>ip and tcp</code> &#x5219;&#x6355;&#x83B7;&#x6240;&#x6709; TCP &#x534F;&#x8BAE;&#x7684;&#x6570;&#x636E;&#x5305;&#xFF0C;&#x901A;&#x8FC7; <code>set_pcap_filter()</code> &#x51FD;&#x6570;&#x6765;&#x8BBE;&#x5B9A;&#x3002;</p>
<p>&#x8BE5;&#x6A21;&#x5757;&#x7684;&#x4E00;&#x4E2A;&#x4E3B;&#x8981;&#x7684;&#x6D41;&#x7A0B;&#x5982;&#x4E0B;&#xFF1A;</p>
<p code_chunk_offset="1" cmd="true" hide="true"><!--?xml version="1.0" encoding="UTF-8" standalone="no"?--><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" contentscripttype="application/ecmascript" contentstyletype="text/css" height="1091.5556px" preserveAspectRatio="none" style="width:594px;height:1091px;" version="1.1" viewBox="0 0 594 1091" width="594.6667px" zoomAndPan="magnify"><defs><filter height="300%" id="fp6gwxdxzq4ls" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="1.7777777777777777"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="3.5555555555555554" dy="3.5555555555555554" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><ellipse cx="294.6667" cy="16" fill="#000000" filter="url(#fp6gwxdxzq4ls)" rx="8.8889" ry="8.8889" style="stroke: none; stroke-width: 0.8888888888888888;"/><ellipse cx="294.6667" cy="1072.8889" fill="none" filter="url(#fp6gwxdxzq4ls)" rx="8.8889" ry="8.8889" style="stroke: #000000; stroke-width: 0.8888888888888888;"/><ellipse cx="295.1111" cy="1073.3333" fill="#000000" rx="5.3333" ry="5.3333" style="stroke: none; stroke-width: 0.8888888888888888;"/><rect fill="#FEFECE" filter="url(#fp6gwxdxzq4ls)" height="932.0078" rx="11.1111" ry="11.1111" style="stroke: #A80036; stroke-width: 1.3333333333333333;" width="578.6667" x="5.3333" y="78.2222"/><rect fill="#FFFFFF" height="881.7778" rx="11.1111" ry="11.1111" style="stroke: #FFFFFF; stroke-width: 0.8888888888888888;" width="573.3333" x="8" y="125.7856"/><line style="stroke: #A80036; stroke-width: 1.3333333333333333;" x1="5.3333" x2="584" y1="123.1189" y2="123.1189"/><line style="stroke: #A80036; stroke-width: 1.3333333333333333;" x1="5.3333" x2="584" y1="104.1068" y2="104.1068"/><text fill="#000000" font-family="sans-serif" font-size="12.4444" lengthAdjust="spacingAndGlyphs" textLength="74.6667" x="257.3333" y="96.928">catch_packet</text><text fill="#000000" font-family="sans-serif" font-size="10.6667" lengthAdjust="spacingAndGlyphs" textLength="32" x="9.7778" y="116.3307">&#x4E3B;&#x7A0B;&#x5E8F;</text><ellipse cx="152" cy="143.5634" fill="#000000" filter="url(#fp6gwxdxzq4ls)" rx="8.8889" ry="8.8889" style="stroke: none; stroke-width: 0.8888888888888888;"/><rect fill="#FEFECE" filter="url(#fp6gwxdxzq4ls)" height="35.5556" rx="11.1111" ry="11.1111" style="stroke: #A80036; stroke-width: 1.3333333333333333;" width="273.7778" x="15.1111" y="184.4523"/><text fill="#000000" font-family="sans-serif" font-size="12.4444" lengthAdjust="spacingAndGlyphs" textLength="264.8889" x="19.5556" y="207.9935">&#x4F7F;&#x7528;pcap_datalink&#x68C0;&#x67E5;&#x6570;&#x636E;&#x94FE;&#x8DEF;&#x5C42;&#x4EC5;&#x8003;&#x8651;&#x4EE5;&#x592A;&#x7F51;</text><rect fill="#FEFECE" filter="url(#fp6gwxdxzq4ls)" height="35.5556" rx="11.1111" ry="11.1111" style="stroke: #A80036; stroke-width: 1.3333333333333333;" width="120.8889" x="91.5556" y="505.3411"/><text fill="#000000" font-family="sans-serif" font-size="12.4444" lengthAdjust="spacingAndGlyphs" textLength="112" x="96" y="528.8824">&#x83B7;&#x53D6;&#x6355;&#x6349;&#x7684;&#x6301;&#x7EED;&#x65F6;&#x95F4;</text><rect fill="#FEFECE" filter="url(#fp6gwxdxzq4ls)" height="35.5556" rx="11.1111" ry="11.1111" style="stroke: #A80036; stroke-width: 1.3333333333333333;" width="207.1111" x="48.4444" y="699.5634"/><text fill="#000000" font-family="sans-serif" font-size="12.4444" lengthAdjust="spacingAndGlyphs" textLength="198.2222" x="52.8889" y="723.1046">pthread_create&#x5F00;&#x542F;&#x4E00;&#x4E2A;&#x8BA1;&#x65F6;&#x5668;&#x7EBF;&#x7A0B;</text><rect fill="#FEFECE" filter="url(#fp6gwxdxzq4ls)" height="35.5556" rx="11.1111" ry="11.1111" style="stroke: #A80036; stroke-width: 1.3333333333333333;" width="149.3333" x="77.3333" y="893.7856"/><text fill="#000000" font-family="sans-serif" font-size="12.4444" lengthAdjust="spacingAndGlyphs" textLength="140.4444" x="81.7778" y="917.3268">pcap_breakloop&#x505C;&#x6B62;&#x6355;&#x6349;</text><rect fill="#FEFECE" filter="url(#fp6gwxdxzq4ls)" height="35.5556" rx="11.1111" ry="11.1111" style="stroke: #A80036; stroke-width: 1.3333333333333333;" width="253.3333" x="25.3333" y="961.3411"/><text fill="#000000" font-family="sans-serif" font-size="12.4444" lengthAdjust="spacingAndGlyphs" textLength="244.4444" x="29.7778" y="984.8824">pkt_dump&#x5C06;&#x6355;&#x83B7;&#x5230;&#x7684;&#x6570;&#x636E;&#x5305;&#x5BFC;&#x51FA;&#x4E3A;pcap&#x6587;&#x4EF6;</text><rect fill="#FEFECE" filter="url(#fp6gwxdxzq4ls)" height="221.4401" rx="11.1111" ry="11.1111" style="stroke: #A80036; stroke-width: 1.3333333333333333;" width="237.3333" x="33.3333" y="252.0078"/><rect fill="#FFFFFF" height="190.2222" rx="11.1111" ry="11.1111" style="stroke: #FFFFFF; stroke-width: 0.8888888888888888;" width="232" x="36" y="280.559"/><line style="stroke: #A80036; stroke-width: 1.3333333333333333;" x1="33.3333" x2="270.6667" y1="277.8924" y2="277.8924"/><text fill="#000000" font-family="sans-serif" font-size="12.4444" lengthAdjust="spacingAndGlyphs" textLength="219.5556" x="42.2222" y="270.7135">set_pcap_filter&#x8BBE;&#x5B9A;&#x7528;&#x6237;&#x6307;&#x5B9A;&#x7684;&#x8FC7;&#x6EE4;&#x89C4;&#x5219;</text><rect fill="#FEFECE" filter="url(#fp6gwxdxzq4ls)" height="35.5556" rx="11.1111" ry="11.1111" style="stroke: #A80036; stroke-width: 1.3333333333333333;" width="145.7778" x="50.6667" y="289.4479"/><text fill="#000000" font-family="sans-serif" font-size="12.4444" lengthAdjust="spacingAndGlyphs" textLength="136.8889" x="55.1111" y="312.9891">&#x83B7;&#x53D6;&#x7528;&#x6237;&#x8F93;&#x5165;&#x7684;&#x8FC7;&#x6EE4;&#x89C4;&#x5219;</text><rect fill="#FEFECE" filter="url(#fp6gwxdxzq4ls)" height="35.5556" rx="11.1111" ry="11.1111" style="stroke: #A80036; stroke-width: 1.3333333333333333;" width="160.8889" x="43.1111" y="357.0035"/><text fill="#000000" font-family="sans-serif" font-size="12.4444" lengthAdjust="spacingAndGlyphs" textLength="152" x="47.5556" y="380.5447">pcap_compile&#x7F16;&#x8BD1;&#x68C0;&#x67E5;&#x89C4;&#x5219;</text><rect fill="#FEFECE" filter="url(#fp6gwxdxzq4ls)" height="35.5556" rx="11.1111" ry="11.1111" style="stroke: #A80036; stroke-width: 1.3333333333333333;" width="159.1111" x="44" y="424.559"/><text fill="#000000" font-family="sans-serif" font-size="12.4444" lengthAdjust="spacingAndGlyphs" textLength="150.2222" x="48.4444" y="448.1003">pcap_setfilter&#x8BBE;&#x7F6E;&#x8FC7;&#x6EE4;&#x89C4;&#x5219;</text><!--MD5=[15c9afd28cee64d911a927306277453d]
link 获取用户输入的过滤规则 to pcap_compile编译检查规则--><path d="M123.5556,325.0541 C123.5556,333.3519 123.5556,343.4381 123.5556,352.2844 " fill="none" id="&#x83B7;&#x53D6;&#x7528;&#x6237;&#x8F93;&#x5165;&#x7684;&#x8FC7;&#x6EE4;&#x89C4;&#x5219;-&gt;pcap_compile&#x7F16;&#x8BD1;&#x68C0;&#x67E5;&#x89C4;&#x5219;" style="stroke: #A80036; stroke-width: 0.8888888888888888;"/><polygon fill="#A80036" points="123.5556,356.7821,127.1111,348.7821,123.5556,352.3377,120,348.7821,123.5556,356.7821" style="stroke: #A80036; stroke-width: 0.8888888888888888;"/><!--MD5=[c34c26112252a11e2df8a34fc3b4f77b]
link pcap_compile编译检查规则 to pcap_setfilter设置过滤规则--><path d="M123.5556,392.6095 C123.5556,400.9078 123.5556,410.9935 123.5556,419.8401 " fill="none" id="pcap_compile&#x7F16;&#x8BD1;&#x68C0;&#x67E5;&#x89C4;&#x5219;-&gt;pcap_setfilter&#x8BBE;&#x7F6E;&#x8FC7;&#x6EE4;&#x89C4;&#x5219;" style="stroke: #A80036; stroke-width: 0.8888888888888888;"/><polygon fill="#A80036" points="123.5556,424.3373,127.1111,416.3373,123.5556,419.8928,120,416.3373,123.5556,424.3373" style="stroke: #A80036; stroke-width: 0.8888888888888888;"/><rect fill="#FEFECE" filter="url(#fp6gwxdxzq4ls)" height="288.9957" rx="11.1111" ry="11.1111" style="stroke: #A80036; stroke-width: 1.3333333333333333;" width="278.2222" x="271.5556" y="572.8967"/><rect fill="#FFFFFF" height="257.7778" rx="11.1111" ry="11.1111" style="stroke: #FFFFFF; stroke-width: 0.8888888888888888;" width="272.8889" x="274.2222" y="601.4479"/><line style="stroke: #A80036; stroke-width: 1.3333333333333333;" x1="271.5556" x2="549.7778" y1="598.7813" y2="598.7813"/><text fill="#000000" font-family="sans-serif" font-size="12.4444" lengthAdjust="spacingAndGlyphs" textLength="145.7778" x="337.7778" y="591.6024">pcap_loop&#x5F00;&#x59CB;&#x6355;&#x83B7;&#x6570;&#x636E;&#x5305;</text><rect fill="#FEFECE" filter="url(#fp6gwxdxzq4ls)" height="35.5556" rx="11.1111" ry="11.1111" style="stroke: #A80036; stroke-width: 1.3333333333333333;" width="58.6667" x="403.5556" y="610.3368"/><text fill="#000000" font-family="sans-serif" font-size="12.4444" lengthAdjust="spacingAndGlyphs" textLength="49.7778" x="408" y="633.878">&#x7B49;&#x5F85;&#x6355;&#x83B7;</text><rect fill="#FEFECE" filter="url(#fp6gwxdxzq4ls)" height="35.5556" rx="11.1111" ry="11.1111" style="stroke: #A80036; stroke-width: 1.3333333333333333;" width="108.4444" x="324.4444" y="677.8924"/><text fill="#000000" font-family="sans-serif" font-size="12.4444" lengthAdjust="spacingAndGlyphs" textLength="99.5556" x="328.8889" y="701.4336">&#x6355;&#x83B7;&#x5230;&#x4E00;&#x4E2A;&#x6570;&#x636E;&#x5305;</text><rect fill="#FEFECE" filter="url(#fp6gwxdxzq4ls)" height="35.5556" rx="11.1111" ry="11.1111" style="stroke: #A80036; stroke-width: 1.3333333333333333;" width="166.2222" x="281.3333" y="745.4479"/><text fill="#000000" font-family="sans-serif" font-size="12.4444" lengthAdjust="spacingAndGlyphs" textLength="157.3333" x="285.7778" y="768.9891">&#x8C03;&#x7528;&#x56DE;&#x8C03;&#x51FD;&#x6570;packet_handle</text><rect fill="#FEFECE" filter="url(#fp6gwxdxzq4ls)" height="35.5556" rx="11.1111" ry="11.1111" style="stroke: #A80036; stroke-width: 1.3333333333333333;" width="203.5556" x="316.8889" y="813.0035"/><text fill="#000000" font-family="sans-serif" font-size="12.4444" lengthAdjust="spacingAndGlyphs" textLength="194.6667" x="321.3333" y="836.5447">add_pkt&#x5C06;&#x6570;&#x636E;&#x5305;&#x4FDD;&#x5B58;&#x5230;&#x6570;&#x636E;&#x5305;&#x94FE;&#x8868;</text><!--MD5=[7a91dc3c7e0174a235142c4a72e13d7e]
link 等待捕获 to 捕获到一个数据包--><path d="M418.9253,645.943 C411.8338,654.5457 403.1591,665.0693 395.68,674.1421 " fill="none" id="&#x7B49;&#x5F85;&#x6355;&#x83B7;-&gt;&#x6355;&#x83B7;&#x5230;&#x4E00;&#x4E2A;&#x6570;&#x636E;&#x5305;" style="stroke: #A80036; stroke-width: 0.8888888888888888;"/><polygon fill="#A80036" points="392.7716,677.671,400.6041,673.7604,395.5989,674.2419,395.1175,669.2367,392.7716,677.671" style="stroke: #A80036; stroke-width: 0.8888888888888888;"/><!--MD5=[c3882573352baf059e23be6f4090abfa]
link 捕获到一个数据包 to 调用回调函数packet_handle--><path d="M375.0044,713.4986 C373.2098,721.7964 371.0293,731.8826 369.1164,740.7288 " fill="none" id="&#x6355;&#x83B7;&#x5230;&#x4E00;&#x4E2A;&#x6570;&#x636E;&#x5305;-&gt;&#x8C03;&#x7528;&#x56DE;&#x8C03;&#x51FD;&#x6570;packet_handle" style="stroke: #A80036; stroke-width: 0.8888888888888888;"/><polygon fill="#A80036" points="368.144,745.2266,373.3087,738.1578,369.0825,740.8824,366.3579,736.6562,368.144,745.2266" style="stroke: #A80036; stroke-width: 0.8888888888888888;"/><!--MD5=[3930ae902dab413d38ca9304568bcc08]
link 调用回调函数packet_handle to add_pkt将数据包保存到数据包链表--><path d="M378.408,781.054 C385.4996,789.6568 394.1742,800.1805 401.6533,809.2532 " fill="none" id="&#x8C03;&#x7528;&#x56DE;&#x8C03;&#x51FD;&#x6570;packet_handle-&gt;add_pkt&#x5C06;&#x6570;&#x636E;&#x5305;&#x4FDD;&#x5B58;&#x5230;&#x6570;&#x636E;&#x5305;&#x94FE;&#x8868;" style="stroke: #A80036; stroke-width: 0.8888888888888888;"/><polygon fill="#A80036" points="404.5618,812.7817,402.2171,804.347,401.7349,809.3521,396.7298,808.8699,404.5618,812.7817" style="stroke: #A80036; stroke-width: 0.8888888888888888;"/><!--MD5=[1af877d9fdf38ac970e57f7aaf53b00d]
link add_pkt将数据包保存到数据包链表 to 等待捕获--><path d="M435.5911,812.9254 C443.128,804.1736 451.1778,792.8602 455.1111,781.0035 C470.0373,736.007 453.5209,680.2132 442.0302,650.311 " fill="none" id="add_pkt&#x5C06;&#x6570;&#x636E;&#x5305;&#x4FDD;&#x5B58;&#x5230;&#x6570;&#x636E;&#x5305;&#x94FE;&#x8868;-&gt;&#x7B49;&#x5F85;&#x6355;&#x83B7;" style="stroke: #A80036; stroke-width: 0.8888888888888888;"/><polygon fill="#A80036" points="440.376,646.0915,439.9851,654.8373,441.9979,650.2294,446.6058,652.2422,440.376,646.0915" style="stroke: #A80036; stroke-width: 0.8888888888888888;"/><!--MD5=[ec3ca38eb00ef7f67edee5ce9ccaaa63]
link *start*catch_packet to 使用pcap_datalink检查数据链路层仅考虑以太网--><path d="M152,152.6034 C152,159.6789 152,170.2514 152,179.742 " fill="none" id="*start*catch_packet-&gt;&#x4F7F;&#x7528;pcap_datalink&#x68C0;&#x67E5;&#x6570;&#x636E;&#x94FE;&#x8DEF;&#x5C42;&#x4EC5;&#x8003;&#x8651;&#x4EE5;&#x592A;&#x7F51;" style="stroke: #A80036; stroke-width: 0.8888888888888888;"/><polygon fill="#A80036" points="152,184.294,155.5556,176.294,152,179.8496,148.4444,176.294,152,184.294" style="stroke: #A80036; stroke-width: 0.8888888888888888;"/><!--MD5=[6f4985a21350d1b6c0dfaf232b280c6e]
link 使用pcap_datalink检查数据链路层仅考虑以太网 to set_pcap_filter设定用户指定的过滤规则--><path d="M152,220.0994 C152,227.5136 152,236.8923 152,247.2789 " fill="none" id="&#x4F7F;&#x7528;pcap_datalink&#x68C0;&#x67E5;&#x6570;&#x636E;&#x94FE;&#x8DEF;&#x5C42;&#x4EC5;&#x8003;&#x8651;&#x4EE5;&#x592A;&#x7F51;-&gt;set_pcap_filter&#x8BBE;&#x5B9A;&#x7528;&#x6237;&#x6307;&#x5B9A;&#x7684;&#x8FC7;&#x6EE4;&#x89C4;&#x5219;" style="stroke: #A80036; stroke-width: 0.8888888888888888;"/><polygon fill="#A80036" points="152,251.7891,155.5556,243.7891,152,247.3447,148.4444,243.7891,152,251.7891" style="stroke: #A80036; stroke-width: 0.8888888888888888;"/><!--MD5=[5c75f48e02aba5b65f837fa88a9ff078]
link set_pcap_filter设定用户指定的过滤规则 to 获取捕捉的持续时间--><path d="M152,473.7625 C152,483.7474 152,492.9589 152,500.6096 " fill="none" id="set_pcap_filter&#x8BBE;&#x5B9A;&#x7528;&#x6237;&#x6307;&#x5B9A;&#x7684;&#x8FC7;&#x6EE4;&#x89C4;&#x5219;-&gt;&#x83B7;&#x53D6;&#x6355;&#x6349;&#x7684;&#x6301;&#x7EED;&#x65F6;&#x95F4;" style="stroke: #A80036; stroke-width: 0.8888888888888888;"/><polygon fill="#A80036" points="152,505.1651,155.5556,497.1651,152,500.7207,148.4444,497.1651,152,505.1651" style="stroke: #A80036; stroke-width: 0.8888888888888888;"/><!--MD5=[395ee91cc978fc40e7b321ff594c3d15]
link 获取捕捉的持续时间 to pthread_create开启一个计时器线程--><path d="M152,541.086 C152,576.1794 152,656.3358 152,694.9189 " fill="none" id="&#x83B7;&#x53D6;&#x6355;&#x6349;&#x7684;&#x6301;&#x7EED;&#x65F6;&#x95F4;-&gt;pthread_create&#x5F00;&#x542F;&#x4E00;&#x4E2A;&#x8BA1;&#x65F6;&#x5668;&#x7EBF;&#x7A0B;" style="stroke: #A80036; stroke-width: 0.8888888888888888;"/><polygon fill="#A80036" points="152,699.4123,155.5556,691.4123,152,694.9678,148.4444,691.4123,152,699.4123" style="stroke: #A80036; stroke-width: 0.8888888888888888;"/><!--MD5=[4a4a88df3d34ca510ffe566acaa5c11d]
link pthread_create开启一个计时器线程 to pcap_loop开始捕获数据包--><path d="M255.568,717.3411 C259.2596,717.3411 262.952,717.3411 266.6436,717.3411 " fill="none" id="pthread_create&#x5F00;&#x542F;&#x4E00;&#x4E2A;&#x8BA1;&#x65F6;&#x5668;&#x7EBF;&#x7A0B;-&gt;pcap_loop&#x5F00;&#x59CB;&#x6355;&#x83B7;&#x6570;&#x636E;&#x5305;" style="stroke: #A80036; stroke-width: 0.8888888888888888;"/><polygon fill="#A80036" points="271.32,717.3411,263.32,713.7856,266.8756,717.3411,263.32,720.8967,271.32,717.3411" style="stroke: #A80036; stroke-width: 0.8888888888888888;"/><!--MD5=[c8812c9c3398a374bc29fc6f21740d3e]
link pthread_create开启一个计时器线程 to pcap_breakloop停止捕捉--><path d="M152,735.3083 C152,770.4016 152,850.558 152,889.1411 " fill="none" id="pthread_create&#x5F00;&#x542F;&#x4E00;&#x4E2A;&#x8BA1;&#x65F6;&#x5668;&#x7EBF;&#x7A0B;-&gt;pcap_breakloop&#x505C;&#x6B62;&#x6355;&#x6349;" style="stroke: #A80036; stroke-width: 0.8888888888888888;"/><polygon fill="#A80036" points="152,893.6345,155.5556,885.6345,152,889.19,148.4444,885.6345,152,893.6345" style="stroke: #A80036; stroke-width: 0.8888888888888888;"/><!--MD5=[0c80bd19d042e4163f7dbcb721ad251e]
link pcap_breakloop停止捕捉 to pkt_dump将捕获到的数据包导出为pcap文件--><path d="M152,929.3916 C152,937.6899 152,947.7756 152,956.6222 " fill="none" id="pcap_breakloop&#x505C;&#x6B62;&#x6355;&#x6349;-&gt;pkt_dump&#x5C06;&#x6355;&#x83B7;&#x5230;&#x7684;&#x6570;&#x636E;&#x5305;&#x5BFC;&#x51FA;&#x4E3A;pcap&#x6587;&#x4EF6;" style="stroke: #A80036; stroke-width: 0.8888888888888888;"/><polygon fill="#A80036" points="152,961.1194,155.5556,953.1194,152,956.6749,148.4444,953.1194,152,961.1194" style="stroke: #A80036; stroke-width: 0.8888888888888888;"/><!--MD5=[9a7adb6e6b514dd6c2aac6794af47f0c]
link *start to catch_packet--><path d="M294.6667,25.1644 C294.6667,34.5511 294.6667,51.4756 294.6667,73.6444 " fill="none" id="*start-&gt;catch_packet" style="stroke: #A80036; stroke-width: 0.8888888888888888;"/><polygon fill="#A80036" points="294.6667,78.1511,298.2222,70.1511,294.6667,73.7067,291.1111,70.1511,294.6667,78.1511" style="stroke: #A80036; stroke-width: 0.8888888888888888;"/><!--MD5=[b14ab24ee74903cf761c7b70ad69b264]
link catch_packet to *end--><path d="M294.6667,1010.8123 C294.6667,1031.9199 294.6667,1048.6808 294.6667,1059.2843 " fill="none" id="catch_packet-&gt;*end" style="stroke: #A80036; stroke-width: 0.8888888888888888;"/><polygon fill="#A80036" points="294.6667,1063.9871,298.2222,1055.9871,294.6667,1059.5427,291.1111,1055.9871,294.6667,1063.9871" style="stroke: #A80036; stroke-width: 0.8888888888888888;"/><!--MD5=[b8a6e1d9a962ed48788afc68eeb7cae3]
@startuml
hide empty description
scale 600 width
[*] - -> catch_packet
catch_packet - -> [*]

catch_packet: 主程序

state catch_packet{
    [*] - -> 使用pcap_datalink检查数据链路层仅考虑以太网
    使用pcap_datalink检查数据链路层仅考虑以太网 - -> set_pcap_filter设定用户指定的过滤规则
    set_pcap_filter设定用户指定的过滤规则 - -> 获取捕捉的持续时间
    获取捕捉的持续时间 - -> pthread_create开启一个计时器线程
    pthread_create开启一个计时器线程 -> pcap_loop开始捕获数据包
    pthread_create开启一个计时器线程 - -> pcap_breakloop停止捕捉
    pcap_breakloop停止捕捉 - -> pkt_dump将捕获到的数据包导出为pcap文件

    state set_pcap_filter设定用户指定的过滤规则{
        获取用户输入的过滤规则 - -> pcap_compile编译检查规则
        pcap_compile编译检查规则 - -> pcap_setfilter设置过滤规则
    }

    state pcap_loop开始捕获数据包{
        等待捕获 - -> 捕获到一个数据包
        捕获到一个数据包 - -> 调用回调函数packet_handle
        调用回调函数packet_handle - -> add_pkt将数据包保存到数据包链表
        add_pkt将数据包保存到数据包链表 - -> 等待捕获
    }
}
@enduml

PlantUML version 1.2019.11(Sun Sep 22 18:02:15 CST 2019)
(MIT source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.8.0_211-b12
Operating System: Windows 10
Default Encoding: GBK
Language: zh
Country: CN
--></g></svg></p><p>&#x6B64;&#x6A21;&#x5757;&#x7684;&#x4EE3;&#x7801;&#x6587;&#x4EF6;&#x89C1;&#xFF1A; <code>catch_packets.h</code> &#x548C; <code>catch_packets.cpp</code> &#x3002;</p>
<h3 class="mume-header" id="%E4%BB%A3%E7%A0%81-1">&#x4EE3;&#x7801;</h3>

<pre data-role="codeBlock" data-info="cpp" class="language-cpp"><span class="token comment">// catch_packets.h</span>
<span class="token macro property">#<span class="token directive keyword">ifndef</span> CATCH_PACKETS</span>
<span class="token macro property">#<span class="token directive keyword">define</span> CATCH_PACKETS</span>

<span class="token macro property">#<span class="token directive keyword">include</span><span class="token string">&quot;global.h&quot;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span><span class="token string">&quot;analysis_struct.h&quot;</span></span>


<span class="token keyword">int</span> <span class="token function">set_pcap_filter</span><span class="token punctuation">(</span>pcap_t <span class="token operator">*</span>dev<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>packet_filter<span class="token punctuation">,</span> bpf_u_int32 mask<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// int catch_packet();</span>
<span class="token keyword">void</span> <span class="token operator">*</span><span class="token function">catch_packet</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property">#<span class="token directive keyword">endif</span></span>
</pre><pre data-role="codeBlock" data-info="cpp" class="language-cpp"><span class="token comment">// catch_packets.cpp</span>
<span class="token macro property">#<span class="token directive keyword">include</span><span class="token string">&quot;catch_packets.h&quot;</span></span>



<span class="token comment">// &#x8BBE;&#x7F6E;&#x8FC7;&#x6EE4;&#x89C4;&#x5219;</span>
<span class="token keyword">int</span> <span class="token function">set_pcap_filter</span><span class="token punctuation">(</span>pcap_t <span class="token operator">*</span>dev<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>packet_filter<span class="token punctuation">,</span> bpf_u_int32 mask<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">struct</span> bpf_program  fcode<span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token operator">~</span><span class="token function">pcap_compile</span><span class="token punctuation">(</span>dev<span class="token punctuation">,</span> <span class="token operator">&amp;</span>fcode<span class="token punctuation">,</span> packet_filter<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> mask<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">err_print</span><span class="token punctuation">(</span><span class="token string">&quot;Unable to compile the packet filter. Check the syntax.&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token operator">~</span><span class="token function">pcap_setfilter</span><span class="token punctuation">(</span>dev<span class="token punctuation">,</span> <span class="token operator">&amp;</span>fcode<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">err_print</span><span class="token punctuation">(</span><span class="token string">&quot;Error setting the filter.&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">typedef</span> <span class="token keyword">struct</span> _argument<span class="token punctuation">{</span>
    pcap_t <span class="token operator">*</span>dev<span class="token punctuation">;</span>
    <span class="token keyword">int</span> timeLen<span class="token punctuation">;</span>
<span class="token punctuation">}</span>args<span class="token punctuation">;</span>

<span class="token comment">// &#x8BBE;&#x5B9A;&#x4E00;&#x4E2A;&#x8BA1;&#x65F6;&#x7EBF;&#x7A0B;&#xFF0C;&#x5F53;&#x5230;&#x8FBE;&#x6355;&#x83B7;&#x65F6;&#x95F4;&#x65F6;&#x505C;&#x6B62;&#x6355;&#x83B7;</span>
<span class="token keyword">void</span> <span class="token operator">*</span><span class="token function">thread_clock</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span>argv<span class="token punctuation">)</span><span class="token punctuation">{</span>
    isCatchDone <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token comment">// win&#x4E0B;&#x7684;sleep&#x662F;&#x4EE5;&#x6BEB;&#x79D2;&#x8BA1;&#x65F6;&#x7684;</span>
    <span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>args<span class="token operator">*</span><span class="token punctuation">)</span>argv<span class="token punctuation">)</span><span class="token operator">-&gt;</span>timeLen<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">pcap_breakloop</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>args<span class="token operator">*</span><span class="token punctuation">)</span>argv<span class="token punctuation">)</span><span class="token operator">-&gt;</span>dev<span class="token punctuation">)</span><span class="token punctuation">;</span>
    isCatchDone <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// &#x56DE;&#x8C03;&#x51FD;&#x6570;&#xFF0C;&#x5F53;&#x6355;&#x83B7;&#x5230;&#x4E00;&#x4E2A;&#x6570;&#x636E;&#x5305;&#x65F6;&#x8C03;&#x7528;&#x8BE5;&#x51FD;&#x6570;</span>
<span class="token comment">// &#x5728;&#x672C;&#x9879;&#x76EE;&#x4E2D;&#x7684;&#x4F5C;&#x7528;&#x662F;&#x5C06;&#x6355;&#x83B7;&#x5230;&#x7684;&#x6570;&#x636E;&#x5305;&#x5B58;&#x50A8;&#x5230;&#x5185;&#x5B58;&#x4E2D;&#xFF08;&#x5373;&#x4E00;&#x4E2A;&#x6570;&#x636E;&#x5305;&#x94FE;&#x8868;&#xFF09;</span>
<span class="token keyword">void</span> <span class="token function">packet_handle</span><span class="token punctuation">(</span>u_char <span class="token operator">*</span>param<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">struct</span> pcap_pkthdr <span class="token operator">*</span>pkthdr<span class="token punctuation">,</span> <span class="token keyword">const</span> u_char <span class="token operator">*</span>packet<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// printf(&quot;\ncatch a pkt...\n&quot;);</span>
    <span class="token function">add_pkt</span><span class="token punctuation">(</span>pkt_link<span class="token punctuation">,</span> pkthdr<span class="token punctuation">,</span> packet<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// printf(&quot;insert in pkt_link...\n\n&quot;);</span>
    <span class="token comment">// Sleep(1000);</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token operator">*</span><span class="token function">catch_packet</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%s\n&quot;</span><span class="token punctuation">,</span> dev<span class="token operator">-&gt;</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// &#x68C0;&#x67E5;&#x6570;&#x636E;&#x94FE;&#x8DEF;&#x5C42;&#xFF0C;&#x4EC5;&#x8003;&#x8651;&#x4EE5;&#x592A;&#x7F51;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">pcap_datalink</span><span class="token punctuation">(</span>dev_fp<span class="token punctuation">)</span> <span class="token operator">!=</span> DLT_EN10MB<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">err_print</span><span class="token punctuation">(</span><span class="token string">&quot;\nThis program works only on Ethernet networks.\n&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">pcap_freealldevs</span><span class="token punctuation">(</span>dev<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// return -1;</span>
        <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    bpf_u_int32 mask<span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>dev<span class="token operator">-&gt;</span>addresses <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// &#x83B7;&#x5F97;&#x63A5;&#x53E3;&#x7684;&#x7B2C;&#x4E00;&#x4E2A;&#x5730;&#x5740;&#x63A9;&#x7801;</span>
        mask <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">struct</span> sockaddr_in <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>dev<span class="token operator">-&gt;</span>addresses<span class="token operator">-&gt;</span>netmask<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span>sin_addr<span class="token punctuation">.</span>S_un<span class="token punctuation">.</span>S_addr<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span><span class="token punctuation">{</span>
        <span class="token comment">// &#x6CA1;&#x4F91;&#x5730;&#x5740;&#x5047;&#x8BBE;&#x4E3A;C&#x7C7B;&#x5730;&#x5740;</span>
        mask <span class="token operator">=</span> <span class="token number">0xffffff</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">char</span> packet_filter<span class="token punctuation">[</span>BUFSIZ<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;\nInput pcap filter string: &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">&quot;%s&quot;</span><span class="token punctuation">,</span> packet_filter<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">set_pcap_filter</span><span class="token punctuation">(</span>dev_fp<span class="token punctuation">,</span> packet_filter<span class="token punctuation">,</span> mask<span class="token punctuation">)</span><span class="token punctuation">;</span>

    args a<span class="token punctuation">;</span>
    a<span class="token punctuation">.</span>dev <span class="token operator">=</span> dev_fp<span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;\nInput catch packets time: &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">&quot;%d&quot;</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>a<span class="token punctuation">.</span>timeLen<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Pcap filter string is: \&quot;%s\&quot;, catch time is \&quot;%d\&quot;. Start catching...\n&quot;</span><span class="token punctuation">,</span> packet_filter<span class="token punctuation">,</span> a<span class="token punctuation">.</span>timeLen<span class="token punctuation">)</span><span class="token punctuation">;</span>

    pkt_link <span class="token operator">=</span> <span class="token punctuation">(</span>pkt_linker_heeader<span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>pkt_linker_heeader<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">init_pkt_link</span><span class="token punctuation">(</span>pkt_link<span class="token punctuation">)</span><span class="token punctuation">;</span>

    pthread_t ptClock<span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">pthread_create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>ptClock<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> thread_clock<span class="token punctuation">,</span> <span class="token operator">&amp;</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">err_print</span><span class="token punctuation">(</span><span class="token string">&quot;pthread_create(): Error!!!\n&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// return -1;</span>
        <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// if(pthread_create(&amp;ptClock, NULL, analysis_pkt, NULL)){</span>
    <span class="token comment">//     err_print(&quot;pthread_create(): catch_packet: Error!!!\n&quot;, &quot;&quot;);</span>
    <span class="token comment">//     return -1;</span>
    <span class="token comment">// }</span>
    <span class="token function">pcap_loop</span><span class="token punctuation">(</span>dev_fp<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> packet_handle<span class="token punctuation">,</span> <span class="token punctuation">(</span>u_char<span class="token operator">*</span><span class="token punctuation">)</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;catch done!!!\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token function">pkt_dump</span><span class="token punctuation">(</span>pkt_link<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// free_pkt_link(pkt_link);</span>
    <span class="token comment">// pcap_freealldevs(dev);</span>
    <span class="token comment">// return 0;</span>
    <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</pre><h2 class="mume-header" id="43-%E6%95%B0%E6%8D%AE%E5%8C%85%E7%9A%84%E5%88%86%E6%9E%90%E4%BA%8E%E6%B5%81%E9%87%8F%E5%A4%84%E7%90%86">4.3 &#x6570;&#x636E;&#x5305;&#x7684;&#x5206;&#x6790;&#x4E8E;&#x6D41;&#x91CF;&#x5904;&#x7406;</h2>

<p>&#x8BE5;&#x6A21;&#x5757;&#x5C06;&#x4E0A;&#x4E00;&#x4E2A;&#x6A21;&#x5757;&#x4E0D;&#x65AD;&#x83B7;&#x53D6;&#x5230;&#x7684;&#x6570;&#x636E;&#x5305;&#x8FDB;&#x884C;&#x5206;&#x6790;&#x5904;&#x7406;&#xFF0C;&#x5C06;&#x6570;&#x636E;&#x94FE;&#x8DEF;&#x5C42;&#x7684;&#x6570;&#x636E;&#x5305;&#x4E0D;&#x65AD;&#x5730;&#x5206;&#x6790;&#x83B7;&#x53D6;&#x5230;&#x94FE;&#x8DEF;&#x5C42;&#x6570;&#x636E;&#x5305;&#x3001;IP&#x6570;&#x636E;&#x5305;&#x3001;TCP/UDP&#x6570;&#x636E;&#x5305;<sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup>&#x7B49;&#x7B49;&#xFF0C;&#x5E76;&#x901A;&#x8FC7;&#x8BBF;&#x95EE;&#x7684;&#x7AEF;&#x53E3;&#x7B49;&#x4FE1;&#x606F;&#x4E00;&#x5B9A;&#x7A0B;&#x5EA6;&#x4E0A;&#x7684;&#x5206;&#x6790;&#x51FA;&#x4E0A;&#x5C42;&#x5E94;&#x7528;&#x5C42;&#x7684;&#x534F;&#x8BAE;&#x5982;DNS<sup class="footnote-ref"><a href="#fn2" id="fnref2">[2]</a></sup><sup class="footnote-ref"><a href="#fn3" id="fnref3">[3]</a></sup>&#x3001;HTTP&#x3001;STMP&#x7B49;&#x7B49;&#x3002;&#x6B64;&#x5916;&#xFF0C;&#x901A;&#x8FC7;&#x5EFA;&#x7ACB;&#x4E00;&#x4E2A;&#x4E09;&#x4E2A;&#x94FE;&#x8868;&#xFF0C;&#x5176;&#x4E2D;&#x4E24;&#x4E2A;&#x7528;&#x4E8E;&#x4FDD;&#x5B58;&#x6240;&#x6709;&#x7684;TCP/UDP&#x6D41;&#x91CF;&#xFF0C;&#x53E6;&#x4E00;&#x4E2A;&#x7528;&#x4E8E;&#x4FDD;&#x5B58;&#x5EFA;&#x7ACB;&#x7684;&#x94FE;&#x63A5;&#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x4F7F;&#x7528;Hash&#x8868;&#x6765;&#x5EFA;&#x7ACB;&#xFF0C;&#x5176;&#x4E2D;&#x4F7F;&#x7528; &#x6E90;&#x5730;&#x5740;&#x3001;&#x76EE;&#x7684;&#x5730;&#x5740;&#x4EE5;&#x53CA;&#x534F;&#x8BAE;<sup class="footnote-ref"><a href="#fn4" id="fnref4">[4]</a></sup>&#x4E94;&#x5143;&#x7EC4;&#x4F5C;&#x4E3A;hash&#x7684;&#x952E;&#x503C;&#xFF0C;&#x5C06;&#x5176;&#x6620;&#x5C04;&#x4E3A;&#x4E00;&#x4E2A;&#x6574;&#x6570;&#xFF0C;&#x5373;&#x4E3A;&#x5176;&#x5E94;&#x5728;hash&#x8868;&#x4E2D;&#x7684;&#x4F4D;&#x7F6E;&#xFF0C;&#x56E0;&#x4E3A;&#x53EF;&#x80FD;&#x51FA;&#x73B0;&#x51B2;&#x7A81;&#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x6240;&#x6709;&#x6BCF;&#x4E2A;&#x4F4D;&#x7F6E;&#x7684;&#x94FE;&#x63A5;&#x8282;&#x70B9;&#x5E76;&#x4E0D;&#x662F;&#x4E00;&#x4E2A;&#xFF0C;&#x4E5F;&#x662F;&#x4E00;&#x4E2A;&#x94FE;&#x8868;&#xFF0C;&#x901A;&#x8FC7;&#x5BF9;&#x8BE5;&#x94FE;&#x8868;&#x7684;&#x904D;&#x5386;&#x6765;&#x6BD4;&#x8F83;&#x83B7;&#x53D6;&#x76F8;&#x540C;&#x7684;&#x94FE;&#x63A5;&#xFF0C;&#x6216;&#x8005;&#x6DFB;&#x52A0;&#x65B0;&#x7684;&#x94FE;&#x63A5;&#xFF0C;&#x5F53;&#x4E00;&#x4E2A;&#x5DF2;&#x7ECF;&#x5EFA;&#x7ACB;&#x7684;&#x94FE;&#x63A5;&#x5173;&#x95ED;&#x65F6;&#x5C06;&#x5176;&#x52A0;&#x5165;&#x5230;TCP&#x7684;&#x94FE;&#x8868;&#x4E2D;&#xFF0C;&#x5728;&#x6574;&#x4E2A;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x540C;&#x65F6;&#x7EDF;&#x8BA1;&#x6570;&#x636E;&#x5305;&#x4E2A;&#x6570;&#x3001;&#x6D41;&#x91CF;&#x7B49;&#x60C5;&#x51B5;&#x4FE1;&#x606F;&#x3002;c</p>
<p>&#x8BE5;&#x6A21;&#x5757;&#x7684;&#x5927;&#x81F4;&#x6267;&#x884C;&#x6D41;&#x7A0B;&#x5982;&#x4E0B;&#xFF1A;</p>
<p code_chunk_offset="2" cmd="true" hide="true"><!--?xml version="1.0" encoding="UTF-8" standalone="no"?--><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" contentscripttype="application/ecmascript" contentstyletype="text/css" height="1099.0315px" preserveAspectRatio="none" style="width:595px;height:1099px;" version="1.1" viewBox="0 0 595 1099" width="595.6416px" zoomAndPan="magnify"><defs><filter height="300%" id="f1uacpc8fbky3s" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="1.4527845036319613"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="2.9055690072639226" dy="2.9055690072639226" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><ellipse cx="295.6416" cy="13.0751" fill="#000000" filter="url(#f1uacpc8fbky3s)" rx="7.2639" ry="7.2639" style="stroke: none; stroke-width: 0.7263922518159807;"/><ellipse cx="295.6416" cy="1083.7772" fill="none" filter="url(#f1uacpc8fbky3s)" rx="7.2639" ry="7.2639" style="stroke: #000000; stroke-width: 0.7263922518159807;"/><ellipse cx="296.0048" cy="1084.1404" fill="#000000" rx="4.3584" ry="4.3584" style="stroke: none; stroke-width: 0.7263922518159807;"/><rect fill="#FEFECE" filter="url(#f1uacpc8fbky3s)" height="968.6505" rx="9.0799" ry="9.0799" style="stroke: #A80036; stroke-width: 1.089588377723971;" width="582.5666" x="4.3584" y="63.9225"/><rect fill="#FFFFFF" height="927.6029" rx="9.0799" ry="9.0799" style="stroke: #FFFFFF; stroke-width: 0.7263922518159807;" width="578.2082" x="6.5375" y="102.7909"/><line style="stroke: #A80036; stroke-width: 1.089588377723971;" x1="4.3584" x2="586.9249" y1="100.6117" y2="100.6117"/><line style="stroke: #A80036; stroke-width: 1.089588377723971;" x1="4.3584" x2="586.9249" y1="85.0751" y2="85.0751"/><text fill="#000000" font-family="sans-serif" font-size="10.1695" lengthAdjust="spacingAndGlyphs" textLength="68.2809" x="261.5012" y="79.2087">analysis_struct</text><text fill="#000000" font-family="sans-serif" font-size="8.7167" lengthAdjust="spacingAndGlyphs" textLength="26.1501" x="7.9903" y="95.0645">&#x4E3B;&#x7A0B;&#x5E8F;</text><rect fill="#FEFECE" filter="url(#f1uacpc8fbky3s)" height="911.7095" rx="9.0799" ry="9.0799" style="stroke: #A80036; stroke-width: 1.089588377723971;" width="546.9734" x="12.3487" y="110.0548"/><rect fill="#FFFFFF" height="886.1985" rx="9.0799" ry="9.0799" style="stroke: #FFFFFF; stroke-width: 0.7263922518159807;" width="542.615" x="14.5278" y="133.3866"/><line style="stroke: #A80036; stroke-width: 1.089588377723971;" x1="12.3487" x2="559.322" y1="131.2074" y2="131.2074"/><text fill="#000000" font-family="sans-serif" font-size="10.1695" lengthAdjust="spacingAndGlyphs" textLength="56.6586" x="257.5061" y="125.341">analysis_pkt</text><ellipse cx="27.6029" cy="155.1784" fill="#000000" filter="url(#f1uacpc8fbky3s)" rx="7.2639" ry="7.2639" style="stroke: none; stroke-width: 0.7263922518159807;"/><rect fill="#FEFECE" filter="url(#f1uacpc8fbky3s)" height="29.0557" rx="9.0799" ry="9.0799" style="stroke: #A80036; stroke-width: 1.089588377723971;" width="73.3656" x="48.3051" y="140.6505"/><text fill="#000000" font-family="sans-serif" font-size="10.1695" lengthAdjust="spacingAndGlyphs" textLength="66.1017" x="51.937" y="159.8882">&#x6253;&#x5F00;result&#x6587;&#x4EF6;</text><rect fill="#FEFECE" filter="url(#f1uacpc8fbky3s)" height="29.0557" rx="9.0799" ry="9.0799" style="stroke: #A80036; stroke-width: 1.089588377723971;" width="78.4504" x="135.109" y="140.6505"/><text fill="#000000" font-family="sans-serif" font-size="10.1695" lengthAdjust="spacingAndGlyphs" textLength="71.1864" x="138.7409" y="159.8882">&#x521D;&#x59CB;&#x5316;&#x4E09;&#x4E2A;&#x94FE;&#x8868;</text><rect fill="#FEFECE" filter="url(#f1uacpc8fbky3s)" height="29.0557" rx="9.0799" ry="9.0799" style="stroke: #A80036; stroke-width: 1.089588377723971;" width="129.2978" x="226.6344" y="140.6505"/><text fill="#000000" font-family="sans-serif" font-size="10.1695" lengthAdjust="spacingAndGlyphs" textLength="122.0339" x="230.2663" y="159.8882">&#x83B7;&#x53D6;&#x6570;&#x636E;&#x5305;&#x94FE;&#x8868;&#x7684;&#x6BCF;&#x4E00;&#x4E2A;&#x5305;</text><rect fill="#FEFECE" filter="url(#f1uacpc8fbky3s)" height="29.0557" rx="9.0799" ry="9.0799" style="stroke: #A80036; stroke-width: 1.089588377723971;" width="88.6199" x="246.9734" y="195.8563"/><text fill="#000000" font-family="sans-serif" font-size="10.1695" lengthAdjust="spacingAndGlyphs" textLength="81.3559" x="250.6053" y="215.094">&#x83B7;&#x53D6;&#x6BCF;&#x4E2A;&#x5305;&#x7684;&#x65F6;&#x95F4;</text><rect fill="#FEFECE" filter="url(#f1uacpc8fbky3s)" height="29.0557" rx="9.0799" ry="9.0799" style="stroke: #A80036; stroke-width: 1.089588377723971;" width="108.9588" x="236.8039" y="251.0622"/><text fill="#000000" font-family="sans-serif" font-size="10.1695" lengthAdjust="spacingAndGlyphs" textLength="101.6949" x="240.4358" y="270.2998">&#x5224;&#x65AD;&#x662F;&#x5426;&#x7ECF;&#x8FC7;&#x4E00;&#x4E2A;&#x5468;&#x671F;</text><rect fill="#FEFECE" filter="url(#f1uacpc8fbky3s)" height="29.0557" rx="9.0799" ry="9.0799" style="stroke: #A80036; stroke-width: 1.089588377723971;" width="108.9588" x="199.7579" y="306.268"/><text fill="#000000" font-family="sans-serif" font-size="10.1695" lengthAdjust="spacingAndGlyphs" textLength="101.6949" x="203.3898" y="325.5057">&#x8F93;&#x51FA;&#x7EDF;&#x8BA1;&#x4FE1;&#x606F;&#x5E76;&#x521D;&#x59CB;&#x5316;</text><rect fill="#FEFECE" filter="url(#f1uacpc8fbky3s)" height="29.0557" rx="9.0799" ry="9.0799" style="stroke: #A80036; stroke-width: 1.089588377723971;" width="129.2978" x="226.6344" y="361.4738"/><text fill="#000000" font-family="sans-serif" font-size="10.1695" lengthAdjust="spacingAndGlyphs" textLength="122.0339" x="230.2663" y="380.7115">&#x83B7;&#x53D6;&#x6570;&#x636E;&#x94FE;&#x8DEF;&#x5C42;&#x4EE5;&#x592A;&#x7F51;&#x62A5;&#x5934;</text><rect fill="#FEFECE" filter="url(#f1uacpc8fbky3s)" height="29.0557" rx="9.0799" ry="9.0799" style="stroke: #A80036; stroke-width: 1.089588377723971;" width="107.5061" x="237.5303" y="416.6796"/><text fill="#000000" font-family="sans-serif" font-size="10.1695" lengthAdjust="spacingAndGlyphs" textLength="100.2421" x="241.1622" y="435.9173">&#x83B7;&#x53D6;IP&#x6570;&#x636E;&#x62A5;&#x62A5;&#x5934;&#x4FE1;&#x606F;</text><rect fill="#FEFECE" filter="url(#f1uacpc8fbky3s)" height="29.0557" rx="9.0799" ry="9.0799" style="stroke: #A80036; stroke-width: 1.089588377723971;" width="94.431" x="244.0678" y="471.8854"/><text fill="#000000" font-family="sans-serif" font-size="10.1695" lengthAdjust="spacingAndGlyphs" textLength="87.1671" x="247.6998" y="491.1231">&#x5224;&#x65AD;&#x83B7;&#x53D6;5&#x5143;&#x7EC4;&#x4FE1;&#x606F;</text><rect fill="#FEFECE" filter="url(#f1uacpc8fbky3s)" height="29.0557" rx="9.0799" ry="9.0799" style="stroke: #A80036; stroke-width: 1.089588377723971;" width="271.6707" x="155.4479" y="926.607"/><text fill="#000000" font-family="sans-serif" font-size="10.1695" lengthAdjust="spacingAndGlyphs" textLength="264.4068" x="159.0799" y="945.8446">&#x5F53;&#x672A;&#x6355;&#x83B7;&#x5B8C;&#x4EE5;&#x53CA;&#x6CA1;&#x6709;&#x8BFB;&#x5230;&#x6570;&#x636E;&#x5305;&#x94FE;&#x8868;&#x672B;&#x65F6;&#x8BFB;&#x53D6;&#x4E0B;&#x4E00;&#x4E2A;&#x6570;&#x636E;&#x5305;</text><rect fill="#FEFECE" filter="url(#f1uacpc8fbky3s)" height="29.0557" rx="9.0799" ry="9.0799" style="stroke: #A80036; stroke-width: 1.089588377723971;" width="47.9419" x="267.3123" y="981.8128"/><text fill="#000000" font-family="sans-serif" font-size="10.1695" lengthAdjust="spacingAndGlyphs" textLength="40.678" x="270.9443" y="1001.0505">&#x91CA;&#x653E;&#x8D44;&#x6E90;</text><rect fill="#FEFECE" filter="url(#f1uacpc8fbky3s)" height="373.4529" rx="9.0799" ry="9.0799" style="stroke: #A80036; stroke-width: 1.089588377723971;" width="488.1356" x="47.2155" y="527.0912"/><rect fill="#FFFFFF" height="347.9419" rx="9.0799" ry="9.0799" style="stroke: #FFFFFF; stroke-width: 0.7263922518159807;" width="483.7772" x="49.3947" y="550.423"/><line style="stroke: #A80036; stroke-width: 1.089588377723971;" x1="47.2155" x2="535.3511" y1="548.2438" y2="548.2438"/><text fill="#000000" font-family="sans-serif" font-size="10.1695" lengthAdjust="spacingAndGlyphs" textLength="213.5593" x="184.5036" y="542.3774">&#x5BF9;&#x4E8E;TCPUDP&#x5206;&#x522B;&#x8FDB;&#x884C;&#x5224;&#x65AD;&#x7AEF;&#x53E3;&#x4EE5;&#x5206;&#x6790;&#x4E0A;&#x5C42;&#x534F;&#x8BAE;</text><ellipse cx="231.7191" cy="564.9509" fill="#000000" filter="url(#f1uacpc8fbky3s)" rx="7.2639" ry="7.2639" style="stroke: none; stroke-width: 0.7263922518159807;"/><rect fill="#FEFECE" filter="url(#f1uacpc8fbky3s)" height="29.0557" rx="9.0799" ry="9.0799" style="stroke: #A80036; stroke-width: 1.089588377723971;" width="119.1283" x="55.2058" y="729.4787"/><text fill="#000000" font-family="sans-serif" font-size="10.1695" lengthAdjust="spacingAndGlyphs" textLength="111.8644" x="58.8378" y="748.7164">UDP&#x5C06;&#x5176;&#x52A0;&#x5165;&#x5230;UDP&#x94FE;&#x8868;</text><rect fill="#FEFECE" filter="url(#f1uacpc8fbky3s)" height="291.3705" rx="9.0799" ry="9.0799" style="stroke: #A80036; stroke-width: 1.089588377723971;" width="323.9709" x="187.4092" y="598.3649"/><rect fill="#FFFFFF" height="265.8596" rx="9.0799" ry="9.0799" style="stroke: #FFFFFF; stroke-width: 0.7263922518159807;" width="319.6126" x="189.5884" y="621.6967"/><line style="stroke: #A80036; stroke-width: 1.089588377723971;" x1="187.4092" x2="511.3801" y1="619.5175" y2="619.5175"/><text fill="#000000" font-family="sans-serif" font-size="10.1695" lengthAdjust="spacingAndGlyphs" textLength="20.339" x="339.2252" y="613.6511">TCP</text><rect fill="#FEFECE" filter="url(#f1uacpc8fbky3s)" height="29.0557" rx="9.0799" ry="9.0799" style="stroke: #A80036; stroke-width: 1.089588377723971;" width="114.77" x="284.0194" y="628.9606"/><text fill="#000000" font-family="sans-serif" font-size="10.1695" lengthAdjust="spacingAndGlyphs" textLength="107.5061" x="287.6513" y="648.1983">&#x83B7;&#x53D6;5&#x5143;&#x7EC4;&#x5BF9;&#x5E94;&#x7684;&#x54C8;&#x5E0C;&#x503C;</text><rect fill="#FEFECE" filter="url(#f1uacpc8fbky3s)" height="29.0557" rx="9.0799" ry="9.0799" style="stroke: #A80036; stroke-width: 1.089588377723971;" width="98.7893" x="292.0097" y="684.1664"/><text fill="#000000" font-family="sans-serif" font-size="10.1695" lengthAdjust="spacingAndGlyphs" textLength="91.5254" x="295.6416" y="703.4041">&#x83B7;&#x53D6;&#x54C8;&#x5E0C;&#x8868;&#x4E2D;&#x7684;&#x4F4D;&#x7F6E;</text><rect fill="#FEFECE" filter="url(#f1uacpc8fbky3s)" height="29.0557" rx="9.0799" ry="9.0799" style="stroke: #A80036; stroke-width: 1.089588377723971;" width="151.816" x="265.4964" y="739.3723"/><text fill="#000000" font-family="sans-serif" font-size="10.1695" lengthAdjust="spacingAndGlyphs" textLength="144.5521" x="269.1283" y="758.6099">&#x83B7;&#x53D6;&#x6BCF;&#x4E00;&#x4E2A;hash&#x76F8;&#x540C;&#x7684;&#x94FE;&#x63A5;&#x5143;&#x7D20;</text><rect fill="#FEFECE" filter="url(#f1uacpc8fbky3s)" height="29.0557" rx="9.0799" ry="9.0799" style="stroke: #A80036; stroke-width: 1.089588377723971;" width="94.431" x="294.1889" y="794.5781"/><text fill="#000000" font-family="sans-serif" font-size="10.1695" lengthAdjust="spacingAndGlyphs" textLength="87.1671" x="297.8208" y="813.8158">&#x5224;&#x65AD;5&#x5143;&#x7EC4;&#x662F;&#x5426;&#x76F8;&#x540C;</text><rect fill="#FEFECE" filter="url(#f1uacpc8fbky3s)" height="29.0557" rx="9.0799" ry="9.0799" style="stroke: #A80036; stroke-width: 1.089588377723971;" width="292.0097" x="195.3995" y="849.7839"/><text fill="#000000" font-family="sans-serif" font-size="10.1695" lengthAdjust="spacingAndGlyphs" textLength="284.7458" x="199.0315" y="869.0216">&#x6839;&#x636E;&#x4E4B;&#x524D;&#x94FE;&#x63A5;&#x548C;&#x5F53;&#x524D;&#x72B6;&#x6001;&#x8FDB;&#x884C;&#x5904;&#x7406;&#x5173;&#x95ED;&#x7684;&#x94FE;&#x63A5;&#x52A0;&#x5165;&#x5230;TCP&#x94FE;&#x8868;&#x4E2D;</text><!--MD5=[4260a21f1e318a31bb365a45913c6fcd]
link 获取5元组对应的哈希值 to 获取哈希表中的位置--><path d="M341.4044,658.0577 C341.4044,664.8386 341.4044,673.081 341.4044,680.31 " fill="none" id="&#x83B7;&#x53D6;5&#x5143;&#x7EC4;&#x5BF9;&#x5E94;&#x7684;&#x54C8;&#x5E0C;&#x503C;-&gt;&#x83B7;&#x53D6;&#x54C8;&#x5E0C;&#x8868;&#x4E2D;&#x7684;&#x4F4D;&#x7F6E;" style="stroke: #A80036; stroke-width: 0.7263922518159807;"/><polygon fill="#A80036" points="341.4044,683.9856,344.3099,677.448,341.4044,680.3536,338.4988,677.448,341.4044,683.9856" style="stroke: #A80036; stroke-width: 0.7263922518159807;"/><!--MD5=[f20ad3dc0ff19707525ccc3e1f3a1f82]
link 获取哈希表中的位置 to 获取每一个hash相同的链接元素--><path d="M341.4044,713.2635 C341.4044,720.0444 341.4044,728.2868 341.4044,735.5158 " fill="none" id="&#x83B7;&#x53D6;&#x54C8;&#x5E0C;&#x8868;&#x4E2D;&#x7684;&#x4F4D;&#x7F6E;-&gt;&#x83B7;&#x53D6;&#x6BCF;&#x4E00;&#x4E2A;hash&#x76F8;&#x540C;&#x7684;&#x94FE;&#x63A5;&#x5143;&#x7D20;" style="stroke: #A80036; stroke-width: 0.7263922518159807;"/><polygon fill="#A80036" points="341.4044,739.1914,344.3099,732.6539,341.4044,735.5594,338.4988,732.6539,341.4044,739.1914" style="stroke: #A80036; stroke-width: 0.7263922518159807;"/><!--MD5=[7d776e60311c8ec3c95d1a7415e2e711]
link 获取每一个hash相同的链接元素 to 判断5元组是否相同--><path d="M341.4044,768.4694 C341.4044,775.2502 341.4044,783.4926 341.4044,790.7217 " fill="none" id="&#x83B7;&#x53D6;&#x6BCF;&#x4E00;&#x4E2A;hash&#x76F8;&#x540C;&#x7684;&#x94FE;&#x63A5;&#x5143;&#x7D20;-&gt;&#x5224;&#x65AD;5&#x5143;&#x7EC4;&#x662F;&#x5426;&#x76F8;&#x540C;" style="stroke: #A80036; stroke-width: 0.7263922518159807;"/><polygon fill="#A80036" points="341.4044,794.3972,344.3099,787.8597,341.4044,790.7652,338.4988,787.8597,341.4044,794.3972" style="stroke: #A80036; stroke-width: 0.7263922518159807;"/><!--MD5=[b80f57a465c072deee097013fb16cf15]
link 判断5元组是否相同 to 根据之前链接和当前状态进行处理关闭的链接加入到TCP链表中--><path d="M341.4044,823.675 C341.4044,830.4563 341.4044,838.6983 341.4044,845.9276 " fill="none" id="&#x5224;&#x65AD;5&#x5143;&#x7EC4;&#x662F;&#x5426;&#x76F8;&#x540C;-&gt;&#x6839;&#x636E;&#x4E4B;&#x524D;&#x94FE;&#x63A5;&#x548C;&#x5F53;&#x524D;&#x72B6;&#x6001;&#x8FDB;&#x884C;&#x5904;&#x7406;&#x5173;&#x95ED;&#x7684;&#x94FE;&#x63A5;&#x52A0;&#x5165;&#x5230;TCP&#x94FE;&#x8868;&#x4E2D;" style="stroke: #A80036; stroke-width: 0.7263922518159807;"/><polygon fill="#A80036" points="341.4044,849.6026,344.3099,843.0651,341.4044,845.9707,338.4988,843.0651,341.4044,849.6026" style="stroke: #A80036; stroke-width: 0.7263922518159807;"/><!--MD5=[021a4b9e07a265c394fd3c36345ef338]
link *start*对于TCPUDP分别进行判断端口以分析上层协议 to UDP将其加入到UDP链表--><path d="M225.2593,568.3627 C214.7019,573.04 193.6496,583.609 180.8717,598.3649 C147.0886,637.3758 127.4324,696.5216 119.2596,725.7138 " fill="none" id="*start*&#x5BF9;&#x4E8E;TCPUDP&#x5206;&#x522B;&#x8FDB;&#x884C;&#x5224;&#x65AD;&#x7AEF;&#x53E3;&#x4EE5;&#x5206;&#x6790;&#x4E0A;&#x5C42;&#x534F;&#x8BAE;-&gt;UDP&#x5C06;&#x5176;&#x52A0;&#x5165;&#x5230;UDP&#x94FE;&#x8868;" style="stroke: #A80036; stroke-width: 0.7263922518159807;"/><polygon fill="#A80036" points="118.228,729.4605,122.7646,723.9288,119.192,725.9589,117.1619,722.3863,118.228,729.4605" style="stroke: #A80036; stroke-width: 0.7263922518159807;"/><!--MD5=[67e10592a73fe1ac8bed741132056f7e]
link *start*对于TCPUDP分别进行判断端口以分析上层协议 to TCP--><path d="M235.5015,571.3852 C238.9061,576.5237 244.4136,584.8366 251.2169,595.1041 " fill="none" id="*start*&#x5BF9;&#x4E8E;TCPUDP&#x5206;&#x522B;&#x8FDB;&#x884C;&#x5224;&#x65AD;&#x7AEF;&#x53E3;&#x4EE5;&#x5206;&#x6790;&#x4E0A;&#x5C42;&#x534F;&#x8BAE;-&gt;TCP" style="stroke: #A80036; stroke-width: 0.7263922518159807;"/><polygon fill="#A80036" points="253.3685,598.3518,252.1793,591.2972,251.3623,595.3243,247.3352,594.5072,253.3685,598.3518" style="stroke: #A80036; stroke-width: 0.7263922518159807;"/><!--MD5=[4d4cb9a76bdf34c38a0e7b58355ac604]
link *start*analysis_pkt to 打开result文件--><path d="M35.0002,155.1784 C38.1814,155.1784 41.3626,155.1784 44.5438,155.1784 " fill="none" id="*start*analysis_pkt-&gt;&#x6253;&#x5F00;result&#x6587;&#x4EF6;" style="stroke: #A80036; stroke-width: 0.7263922518159807;"/><polygon fill="#A80036" points="48.2782,155.1784,41.7407,152.2728,44.6462,155.1784,41.7407,158.084,48.2782,155.1784" style="stroke: #A80036; stroke-width: 0.7263922518159807;"/><!--MD5=[227e9d81fa6f6f3ffed9c08d48997c30]
link 打开result文件 to 初始化三个链表--><path d="M121.9831,155.1784 C125.1182,155.1784 128.254,155.1784 131.3898,155.1784 " fill="none" id="&#x6253;&#x5F00;result&#x6587;&#x4EF6;-&gt;&#x521D;&#x59CB;&#x5316;&#x4E09;&#x4E2A;&#x94FE;&#x8868;" style="stroke: #A80036; stroke-width: 0.7263922518159807;"/><polygon fill="#A80036" points="135.0705,155.1784,128.5329,152.2728,131.4385,155.1784,128.5329,158.084,135.0705,155.1784" style="stroke: #A80036; stroke-width: 0.7263922518159807;"/><!--MD5=[3c8d6263d753f4226d6f537c060d8fb3]
link 初始化三个链表 to 获取数据包链表的每一个包--><path d="M213.6218,155.1784 C216.608,155.1784 219.5942,155.1784 222.5804,155.1784 " fill="none" id="&#x521D;&#x59CB;&#x5316;&#x4E09;&#x4E2A;&#x94FE;&#x8868;-&gt;&#x83B7;&#x53D6;&#x6570;&#x636E;&#x5305;&#x94FE;&#x8868;&#x7684;&#x6BCF;&#x4E00;&#x4E2A;&#x5305;" style="stroke: #A80036; stroke-width: 0.7263922518159807;"/><polygon fill="#A80036" points="226.3634,155.1784,219.8259,152.2728,222.7315,155.1784,219.8259,158.084,226.3634,155.1784" style="stroke: #A80036; stroke-width: 0.7263922518159807;"/><!--MD5=[03322c5b370723abd1b8edd7c8e84b3a]
link 获取数据包链表的每一个包 to 获取每个包的时间--><path d="M291.2833,169.7498 C291.2833,176.5271 291.2833,184.7716 291.2833,191.9992 " fill="none" id="&#x83B7;&#x53D6;&#x6570;&#x636E;&#x5305;&#x94FE;&#x8868;&#x7684;&#x6BCF;&#x4E00;&#x4E2A;&#x5305;-&gt;&#x83B7;&#x53D6;&#x6BCF;&#x4E2A;&#x5305;&#x7684;&#x65F6;&#x95F4;" style="stroke: #A80036; stroke-width: 0.7263922518159807;"/><polygon fill="#A80036" points="291.2833,195.6748,294.1889,189.1372,291.2833,192.0428,288.3777,189.1372,291.2833,195.6748" style="stroke: #A80036; stroke-width: 0.7263922518159807;"/><!--MD5=[5a96bffa0f933c04bddbcaa64c341c0c]
link 获取每个包的时间 to 判断是否经过一个周期--><path d="M291.2833,224.9556 C291.2833,231.7329 291.2833,239.9774 291.2833,247.205 " fill="none" id="&#x83B7;&#x53D6;&#x6BCF;&#x4E2A;&#x5305;&#x7684;&#x65F6;&#x95F4;-&gt;&#x5224;&#x65AD;&#x662F;&#x5426;&#x7ECF;&#x8FC7;&#x4E00;&#x4E2A;&#x5468;&#x671F;" style="stroke: #A80036; stroke-width: 0.7263922518159807;"/><polygon fill="#A80036" points="291.2833,250.8806,294.1889,244.343,291.2833,247.2486,288.3777,244.343,291.2833,250.8806" style="stroke: #A80036; stroke-width: 0.7263922518159807;"/><!--MD5=[c49c41de9f89e7f7c69bebc0584bdf0a]
link 判断是否经过一个周期 to 输出统计信息并初始化--><path d="M281.7429,280.1614 C276.9407,287.1268 271.0758,295.6372 265.9969,303.0065 " fill="none" id="&#x5224;&#x65AD;&#x662F;&#x5426;&#x7ECF;&#x8FC7;&#x4E00;&#x4E2A;&#x5468;&#x671F;-&gt;&#x8F93;&#x51FA;&#x7EDF;&#x8BA1;&#x4FE1;&#x606F;&#x5E76;&#x521D;&#x59CB;&#x5316;" style="stroke: #A80036; stroke-width: 0.7263922518159807;"/><polygon fill="#A80036" points="263.8743,306.0871,269.9773,302.3541,265.9359,303.0969,265.193,299.0556,263.8743,306.0871" style="stroke: #A80036; stroke-width: 0.7263922518159807;"/><!--MD5=[2e66fc10e0bce34ddc1a4b6ca50ddfba]
link 输出统计信息并初始化 to 获取数据链路层以太网报头--><path d="M263.7777,335.3651 C268.5799,342.3326 274.4448,350.843 279.5237,358.2123 " fill="none" id="&#x8F93;&#x51FA;&#x7EDF;&#x8BA1;&#x4FE1;&#x606F;&#x5E76;&#x521D;&#x59CB;&#x5316;-&gt;&#x83B7;&#x53D6;&#x6570;&#x636E;&#x94FE;&#x8DEF;&#x5C42;&#x4EE5;&#x592A;&#x7F51;&#x62A5;&#x5934;" style="stroke: #A80036; stroke-width: 0.7263922518159807;"/><polygon fill="#A80036" points="281.6462,361.2929,280.3275,354.2614,279.5847,358.3027,275.5433,357.5599,281.6462,361.2929" style="stroke: #A80036; stroke-width: 0.7263922518159807;"/><!--MD5=[0fe4f7b4745cff5b452855d978ba22a5]
link 判断是否经过一个周期 to 获取数据链路层以太网报头--><path d="M302.1973,280.2413 C307.2341,287.5503 312.6632,296.9135 315.2542,306.268 C318.701,318.7132 318.701,322.8784 315.2542,335.3237 C313.0278,343.3626 308.7051,351.4082 304.3366,358.1498 " fill="none" id="&#x5224;&#x65AD;&#x662F;&#x5426;&#x7ECF;&#x8FC7;&#x4E00;&#x4E2A;&#x5468;&#x671F;-&gt;&#x83B7;&#x53D6;&#x6570;&#x636E;&#x94FE;&#x8DEF;&#x5C42;&#x4EE5;&#x592A;&#x7F51;&#x62A5;&#x5934;" style="stroke: #A80036; stroke-width: 0.7263922518159807;"/><polygon fill="#A80036" points="302.1973,361.3496,308.2467,357.5304,304.2163,358.3305,303.4162,354.3,302.1973,361.3496" style="stroke: #A80036; stroke-width: 0.7263922518159807;"/><!--MD5=[dab409dce1befa2878130aca4e7efc7c]
link 获取数据链路层以太网报头 to 获取IP数据报报头信息--><path d="M291.2833,390.5709 C291.2833,397.3517 291.2833,405.5941 291.2833,412.8232 " fill="none" id="&#x83B7;&#x53D6;&#x6570;&#x636E;&#x94FE;&#x8DEF;&#x5C42;&#x4EE5;&#x592A;&#x7F51;&#x62A5;&#x5934;-&gt;&#x83B7;&#x53D6;IP&#x6570;&#x636E;&#x62A5;&#x62A5;&#x5934;&#x4FE1;&#x606F;" style="stroke: #A80036; stroke-width: 0.7263922518159807;"/><polygon fill="#A80036" points="291.2833,416.4987,294.1889,409.9612,291.2833,412.8668,288.3777,409.9612,291.2833,416.4987" style="stroke: #A80036; stroke-width: 0.7263922518159807;"/><!--MD5=[78456f4dd8416c8745fa6a807fe26d8a]
link 获取IP数据报报头信息 to 判断获取5元组信息--><path d="M291.2833,445.7767 C291.2833,452.5576 291.2833,460.7999 291.2833,468.029 " fill="none" id="&#x83B7;&#x53D6;IP&#x6570;&#x636E;&#x62A5;&#x62A5;&#x5934;&#x4FE1;&#x606F;-&gt;&#x5224;&#x65AD;&#x83B7;&#x53D6;5&#x5143;&#x7EC4;&#x4FE1;&#x606F;" style="stroke: #A80036; stroke-width: 0.7263922518159807;"/><polygon fill="#A80036" points="291.2833,471.7045,294.1889,465.167,291.2833,468.0726,288.3777,465.167,291.2833,471.7045" style="stroke: #A80036; stroke-width: 0.7263922518159807;"/><!--MD5=[b3982d3ca1e42fd0841feb4a8614de0e]
link 判断获取5元组信息 to 对于TCPUDP分别进行判断端口以分析上层协议--><path d="M291.2833,501.2709 C291.2833,507.1452 291.2833,514.6118 291.2833,523.2094 " fill="none" id="&#x5224;&#x65AD;&#x83B7;&#x53D6;5&#x5143;&#x7EC4;&#x4FE1;&#x606F;-&gt;&#x5BF9;&#x4E8E;TCPUDP&#x5206;&#x522B;&#x8FDB;&#x884C;&#x5224;&#x65AD;&#x7AEF;&#x53E3;&#x4EE5;&#x5206;&#x6790;&#x4E0A;&#x5C42;&#x534F;&#x8BAE;" style="stroke: #A80036; stroke-width: 0.7263922518159807;"/><polygon fill="#A80036" points="291.2833,526.9619,294.1889,520.4244,291.2833,523.33,288.3777,520.4244,291.2833,526.9619" style="stroke: #A80036; stroke-width: 0.7263922518159807;"/><!--MD5=[fe56afbab9d125f3ed032086c4f34a69]
link 对于TCPUDP分别进行判断端口以分析上层协议 to 当未捕获完以及没有读到数据包链表末时读取下一个数据包--><path d="M291.2833,900.5404 C291.2833,909.1249 291.2833,916.7222 291.2833,922.9205 " fill="none" id="&#x5BF9;&#x4E8E;TCPUDP&#x5206;&#x522B;&#x8FDB;&#x884C;&#x5224;&#x65AD;&#x7AEF;&#x53E3;&#x4EE5;&#x5206;&#x6790;&#x4E0A;&#x5C42;&#x534F;&#x8BAE;-&gt;&#x5F53;&#x672A;&#x6355;&#x83B7;&#x5B8C;&#x4EE5;&#x53CA;&#x6CA1;&#x6709;&#x8BFB;&#x5230;&#x6570;&#x636E;&#x5305;&#x94FE;&#x8868;&#x672B;&#x65F6;&#x8BFB;&#x53D6;&#x4E0B;&#x4E00;&#x4E2A;&#x6570;&#x636E;&#x5305;" style="stroke: #A80036; stroke-width: 0.7263922518159807;"/><polygon fill="#A80036" points="291.2833,926.5961,294.1889,920.0585,291.2833,922.9641,288.3777,920.0585,291.2833,926.5961" style="stroke: #A80036; stroke-width: 0.7263922518159807;"/><!--MD5=[7ffad03a8f3e941a377d165f6a904f29]
link 当未捕获完以及没有读到数据包链表末时读取下一个数据包 to 释放资源--><path d="M291.2833,955.7039 C291.2833,962.4852 291.2833,970.7271 291.2833,977.9565 " fill="none" id="&#x5F53;&#x672A;&#x6355;&#x83B7;&#x5B8C;&#x4EE5;&#x53CA;&#x6CA1;&#x6709;&#x8BFB;&#x5230;&#x6570;&#x636E;&#x5305;&#x94FE;&#x8868;&#x672B;&#x65F6;&#x8BFB;&#x53D6;&#x4E0B;&#x4E00;&#x4E2A;&#x6570;&#x636E;&#x5305;-&gt;&#x91CA;&#x653E;&#x8D44;&#x6E90;" style="stroke: #A80036; stroke-width: 0.7263922518159807;"/><polygon fill="#A80036" points="291.2833,981.6315,294.1889,975.094,291.2833,977.9996,288.3777,975.094,291.2833,981.6315" style="stroke: #A80036; stroke-width: 0.7263922518159807;"/><!--MD5=[676a8dc627c651bb6f90e9162fae8fed]
link *start to analysis_struct--><path d="M295.6416,20.3608 C295.6416,27.9298 295.6416,41.7385 295.6416,60.1162 " fill="none" id="*start-&gt;analysis_struct" style="stroke: #A80036; stroke-width: 0.7263922518159807;"/><polygon fill="#A80036" points="295.6416,63.8571,298.5472,57.3196,295.6416,60.2252,292.7361,57.3196,295.6416,63.8571" style="stroke: #A80036; stroke-width: 0.7263922518159807;"/><!--MD5=[0e2c7e8e0c7ae1ae9c996f0be91544da]
link analysis_struct to *end--><path d="M295.6416,1033.0629 C295.6416,1050.2951 295.6416,1063.8447 295.6416,1072.4648 " fill="none" id="analysis_struct-&gt;*end" style="stroke: #A80036; stroke-width: 0.7263922518159807;"/><polygon fill="#A80036" points="295.6416,1076.2951,298.5472,1069.7576,295.6416,1072.6631,292.7361,1069.7576,295.6416,1076.2951" style="stroke: #A80036; stroke-width: 0.7263922518159807;"/><!--MD5=[149cd4f57e611d627f0ed39ed7f461c7]
@startuml
hide empty description
scale 600 width
[*] - -> analysis_struct
analysis_struct - -> [*]

analysis_struct: 主程序

state analysis_struct{
    state analysis_pkt{
        [*] -> 打开result文件
        打开result文件 -> 初始化三个链表
        初始化三个链表 -> 获取数据包链表的每一个包
        获取数据包链表的每一个包 - -> 获取每个包的时间
        获取每个包的时间 - -> 判断是否经过一个周期
        判断是否经过一个周期 - -> 输出统计信息并初始化
        输出统计信息并初始化 - -> 获取数据链路层以太网报头
        判断是否经过一个周期 - -> 获取数据链路层以太网报头
        获取数据链路层以太网报头 - -> 获取IP数据报报头信息
        获取IP数据报报头信息 - -> 判断获取5元组信息
        判断获取5元组信息 - -> 对于TCPUDP分别进行判断端口以分析上层协议
        对于TCPUDP分别进行判断端口以分析上层协议 - -> 当未捕获完以及没有读到数据包链表末时读取下一个数据包
        当未捕获完以及没有读到数据包链表末时读取下一个数据包 - -> 释放资源

       state 对于TCPUDP分别进行判断端口以分析上层协议{
           [*] - -> UDP将其加入到UDP链表
           [*] - -> TCP

           state TCP{
               获取5元组对应的哈希值 - -> 获取哈希表中的位置
               获取哈希表中的位置 - -> 获取每一个hash相同的链接元素
               获取每一个hash相同的链接元素 - -> 判断5元组是否相同
               判断5元组是否相同 - -> 根据之前链接和当前状态进行处理关闭的链接加入到TCP链表中
           }
       }
    }
}
@enduml

PlantUML version 1.2019.11(Sun Sep 22 18:02:15 CST 2019)
(MIT source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.8.0_211-b12
Operating System: Windows 10
Default Encoding: GBK
Language: zh
Country: CN
--></g></svg></p><p>&#x8BE5;&#x6A21;&#x5757;&#x7684;&#x4EE3;&#x7801;&#x89C1; <code>analysis_struct.h</code> &#x548C; <code>analysis_struct.cpp</code></p>
<h3 class="mume-header" id="%E4%BB%A3%E7%A0%81-2">&#x4EE3;&#x7801;</h3>

<pre data-role="codeBlock" data-info="cpp" class="language-cpp"><span class="token comment">// analysis_struct.h</span>

<span class="token macro property">#<span class="token directive keyword">ifndef</span> ANALYSIS_STRUCT_H</span>
<span class="token macro property">#<span class="token directive keyword">define</span> ANALYSIS_STRUCT_H</span>

<span class="token macro property">#<span class="token directive keyword">include</span><span class="token string">&quot;global.h&quot;</span></span>

<span class="token comment">// timeval &#x7ED3;&#x6784;</span>
<span class="token keyword">typedef</span> <span class="token keyword">struct</span> _shh_timeval<span class="token punctuation">{</span>
    <span class="token keyword">int</span> tv_sec<span class="token punctuation">;</span>     
    <span class="token keyword">int</span> tv_usec<span class="token punctuation">;</span>
<span class="token punctuation">}</span>ssh_timeval<span class="token punctuation">;</span>

<span class="token comment">// pcap_next() &#x8C03;&#x7528;&#x540E;&#x7684;&#x6570;&#x636E;&#x5305;&#x7684;&#x5934;&#x90E8;&#x4FE1;&#x606F;</span>
<span class="token keyword">typedef</span> <span class="token keyword">struct</span> _shh_pkthdr<span class="token punctuation">{</span>
    ssh_timeval ts<span class="token punctuation">;</span>
    bpf_u_int32 caplen<span class="token punctuation">;</span> <span class="token comment">// &#x5305;&#x7684;&#x5B9E;&#x9645;&#x6355;&#x6349;&#x5230;&#x7684;&#x957F;&#x5EA6;</span>
    bpf_u_int32 len<span class="token punctuation">;</span>    <span class="token comment">// &#x5305;&#x5E94;&#x8BE5;&#x6709;&#x957F;&#x5EA6;</span>
<span class="token punctuation">}</span>shh_pkthdr<span class="token punctuation">;</span>

<span class="token comment">// &#x7F51;&#x7EDC;&#x4FE1;&#x606F;&#x4E94;&#x5143;&#x7EC4;</span>
<span class="token keyword">typedef</span> <span class="token keyword">struct</span> _net5net<span class="token punctuation">{</span>
    u_int       sip<span class="token punctuation">;</span>
    u_short     sport<span class="token punctuation">;</span>
    u_int       dip<span class="token punctuation">;</span>
    u_short     dport<span class="token punctuation">;</span>
    u_char      protocol<span class="token punctuation">;</span>
<span class="token punctuation">}</span>net5set<span class="token punctuation">;</span>

<span class="token comment">// &#x94FE;&#x8868;&#x8282;&#x70B9;</span>
<span class="token keyword">typedef</span> <span class="token keyword">struct</span> _net_link_node<span class="token punctuation">{</span>
    net5set nln_5set<span class="token punctuation">;</span>       <span class="token comment">// &#x4E94;&#x5143;&#x7EC4;</span>
    <span class="token keyword">int</span>     nln_upl_size<span class="token punctuation">;</span>   <span class="token comment">// &#x4E0A;&#x884C;&#x6570;&#x636E;&#x5305;&#x5927;&#x5C0F;</span>
    <span class="token keyword">int</span>     nln_downl_size<span class="token punctuation">;</span> <span class="token comment">// &#x4E0B;&#x884C;&#x6570;&#x636E;&#x5305;&#x5927;&#x5C0F;</span>
    <span class="token keyword">int</span>     nln_upl_pkt<span class="token punctuation">;</span>    <span class="token comment">// &#x4E0A;&#x884C;&#x4E2A;&#x6570;</span>
    <span class="token keyword">int</span>     nln_downl_pkt<span class="token punctuation">;</span>  <span class="token comment">// &#x4E0B;&#x884C;&#x4E2A;&#x6570;</span>
    u_char  nln_status<span class="token punctuation">;</span>     <span class="token comment">// &#x8BE5;&#x94FE;&#x63A5;&#x7684;&#x72B6;&#x6001;</span>
    <span class="token macro property">#<span class="token directive keyword">define</span> CLOSED      0x00</span>
    <span class="token macro property">#<span class="token directive keyword">define</span> SYN_SENT    0x01    </span><span class="token comment">// client sent SYN</span>
    <span class="token macro property">#<span class="token directive keyword">define</span> SYN_RECVD   0x02    </span><span class="token comment">// recieve SYN, and send SYN ACK</span>
    <span class="token macro property">#<span class="token directive keyword">define</span> ESTABLISHED 0x03    </span><span class="token comment">// client get SYN &amp; ACK, server get ACK</span>

    <span class="token macro property">#<span class="token directive keyword">define</span> FIN_WAIT_1  0x04    </span><span class="token comment">// client send FIN</span>
    <span class="token macro property">#<span class="token directive keyword">define</span> CLOSE_WAIT  0x05    </span><span class="token comment">// server recv FIN, and send ACK</span>
    <span class="token macro property">#<span class="token directive keyword">define</span> FIN_WAIT_2  0x06    </span><span class="token comment">// client recv ACK</span>
    <span class="token macro property">#<span class="token directive keyword">define</span> LAST_ACK    0x07    </span><span class="token comment">// server send FIN</span>
    <span class="token macro property">#<span class="token directive keyword">define</span> TIME_WAIT   0x08    </span><span class="token comment">// client recv FIN</span>
    <span class="token comment">// CLOSED: client send ACK, server recv ACK</span>
    <span class="token macro property">#<span class="token directive keyword">define</span> UNDEFINED   0xff</span>
    <span class="token keyword">struct</span>  _net_link_node <span class="token operator">*</span>next<span class="token punctuation">;</span>
<span class="token punctuation">}</span>net_link_node<span class="token punctuation">,</span> <span class="token operator">*</span>p_net_link<span class="token punctuation">;</span>

<span class="token comment">// &#x94FE;&#x8868;&#x5934;&#x7ED3;&#x6784;</span>
<span class="token keyword">typedef</span> <span class="token keyword">struct</span> _net_link_header<span class="token punctuation">{</span>
    <span class="token keyword">int</span> count_conn<span class="token punctuation">;</span>
    <span class="token keyword">int</span> count_upl_pkt<span class="token punctuation">;</span>
    <span class="token keyword">int</span> count_downl_pkt<span class="token punctuation">;</span>
    <span class="token keyword">int</span> count_upl<span class="token punctuation">;</span>
    <span class="token keyword">int</span> count_downl<span class="token punctuation">;</span>
    p_net_link link<span class="token punctuation">;</span>
<span class="token punctuation">}</span>net_link_header<span class="token punctuation">;</span>



<span class="token comment">// &#x9700;&#x8981;&#x4E09;&#x4E2A;&#x94FE;&#x8868;&#xFF0C;&#x4E00;&#x4E2A;&#x54C8;&#x5E0C;&#x94FE;&#x8868;&#xFF0C;&#x4FDD;&#x5B58;&#x5904;&#x4E8E;&#x8FDE;&#x63A5;&#x72B6;&#x6001;&#x7684;&#x5305;</span>
<span class="token comment">// &#x53E6;&#x4E24;&#x4E2A;&#x94FE;&#x8868;&#x5206;&#x522B;&#x4FDD;&#x5B58;tcp&#x548C;udp&#x7684;&#x6D41;&#x91CF;</span>
<span class="token keyword">extern</span> net_link_header <span class="token operator">*</span>FLowLink_TCP<span class="token punctuation">;</span>
<span class="token keyword">extern</span> net_link_header <span class="token operator">*</span>FLowLink_UDP<span class="token punctuation">;</span>

<span class="token comment">/* ========== hash table ============= */</span>
<span class="token macro property">#<span class="token directive keyword">define</span> HASH_TABLE_SIZE 0xffff</span>
<span class="token keyword">extern</span> p_net_link HashTable<span class="token punctuation">[</span>HASH_TABLE_SIZE<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">init_flowLink</span><span class="token punctuation">(</span>net_link_header <span class="token operator">*</span>head<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">add_to_flowLink</span><span class="token punctuation">(</span>net_link_header <span class="token operator">*</span>head<span class="token punctuation">,</span> <span class="token keyword">const</span> net_link_node <span class="token operator">*</span>theNode<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">clear_flowLink</span><span class="token punctuation">(</span>net_link_header <span class="token operator">*</span>head<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">parse_flowLink_TCP</span><span class="token punctuation">(</span>FILE <span class="token operator">*</span>fOutput<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">parse_flowLink_UDP</span><span class="token punctuation">(</span>FILE <span class="token operator">*</span>fOutput<span class="token punctuation">)</span><span class="token punctuation">;</span>

u_short <span class="token function">get_hash</span><span class="token punctuation">(</span><span class="token keyword">const</span> net5set <span class="token operator">*</span>theSet<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">add_to_hashTable</span><span class="token punctuation">(</span>u_short hash<span class="token punctuation">,</span> <span class="token keyword">const</span> net_link_node <span class="token operator">*</span>theNode<span class="token punctuation">,</span> u_char flags<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">clear_hashTable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token operator">*</span><span class="token function">analysis_pkt</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span>argv<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property">#<span class="token directive keyword">endif</span></span>
</pre><pre data-role="codeBlock" data-info="cpp" class="language-cpp"><span class="token comment">// analysis_struct.cpp</span>
<span class="token macro property">#<span class="token directive keyword">include</span><span class="token string">&quot;analysis_struct.h&quot;</span></span>

<span class="token comment">// &#x9700;&#x8981;&#x4E09;&#x4E2A;&#x94FE;&#x8868;&#xFF0C;&#x4E00;&#x4E2A;&#x54C8;&#x5E0C;&#x94FE;&#x8868;&#xFF0C;&#x4FDD;&#x5B58;&#x5904;&#x4E8E;&#x8FDE;&#x63A5;&#x72B6;&#x6001;&#x7684;&#x5305;</span>
<span class="token comment">// &#x53E6;&#x4E24;&#x4E2A;&#x94FE;&#x8868;&#x5206;&#x522B;&#x4FDD;&#x5B58;tcp&#x548C;udp&#x7684;&#x6D41;&#x91CF;</span>
net_link_header <span class="token operator">*</span>FLowLink_TCP<span class="token punctuation">;</span>
net_link_header <span class="token operator">*</span>FLowLink_UDP<span class="token punctuation">;</span>

p_net_link HashTable<span class="token punctuation">[</span>HASH_TABLE_SIZE<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">// &#x5C06;&#x6574;&#x5F62;&#x7684;ip&#x8F6C;&#x4E3A;&#x5B57;&#x7B26;&#x578B;</span>
<span class="token macro property">#<span class="token directive keyword">define</span> IPTOSBUFFERS    12</span>
<span class="token keyword">static</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token function">iptos</span><span class="token punctuation">(</span>bpf_u_int32 in<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token keyword">char</span> output<span class="token punctuation">[</span>IPTOSBUFFERS<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token operator">*</span><span class="token number">4</span><span class="token operator">+</span><span class="token number">3</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token keyword">short</span> which<span class="token punctuation">;</span>
    u_char <span class="token operator">*</span>p<span class="token punctuation">;</span>

    p <span class="token operator">=</span> <span class="token punctuation">(</span>u_char <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>in<span class="token punctuation">;</span>
    which <span class="token operator">=</span> <span class="token punctuation">(</span>which <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">==</span> IPTOSBUFFERS <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> which <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">sprintf</span><span class="token punctuation">(</span>output<span class="token punctuation">[</span>which<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">&quot;%d.%d.%d.%d&quot;</span><span class="token punctuation">,</span> p<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> p<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> p<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> p<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> output<span class="token punctuation">[</span>which<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token comment">// &#x65F6;&#x95F4;&#x8F6C;&#x6362;</span>
<span class="token keyword">char</span> <span class="token operator">*</span><span class="token function">long2time</span><span class="token punctuation">(</span><span class="token keyword">long</span> ltime<span class="token punctuation">)</span><span class="token punctuation">{</span>
    time_t t<span class="token punctuation">;</span>
    <span class="token keyword">struct</span> tm <span class="token operator">*</span>p<span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token keyword">char</span> s<span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    t <span class="token operator">=</span> ltime<span class="token punctuation">;</span>
    p <span class="token operator">=</span> <span class="token function">gmtime</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">strftime</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;%Y-%m-%d %H:%M:%S&quot;</span><span class="token punctuation">,</span> p<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> s<span class="token punctuation">;</span>
<span class="token punctuation">}</span>



<span class="token keyword">void</span> <span class="token function">init_flowLink</span><span class="token punctuation">(</span>net_link_header <span class="token operator">*</span>head<span class="token punctuation">)</span><span class="token punctuation">{</span>
    head<span class="token operator">-&gt;</span>count_conn        <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    head<span class="token operator">-&gt;</span>count_upl_pkt     <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    head<span class="token operator">-&gt;</span>count_downl_pkt   <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    head<span class="token operator">-&gt;</span>count_upl         <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    head<span class="token operator">-&gt;</span>count_downl       <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    head<span class="token operator">-&gt;</span>link              <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">add_to_flowLink</span><span class="token punctuation">(</span>net_link_header <span class="token operator">*</span>head<span class="token punctuation">,</span> <span class="token keyword">const</span> net_link_node <span class="token operator">*</span>theNode<span class="token punctuation">)</span><span class="token punctuation">{</span>
    net_link_node <span class="token operator">*</span>newNode <span class="token operator">=</span> <span class="token punctuation">(</span>net_link_node <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>net_link_node<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">memcpy</span><span class="token punctuation">(</span>newNode<span class="token punctuation">,</span> theNode<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>net_link_node<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    head<span class="token operator">-&gt;</span>count_conn <span class="token operator">++</span><span class="token punctuation">;</span>
    head<span class="token operator">-&gt;</span>count_upl_pkt     <span class="token operator">+=</span> newNode<span class="token operator">-&gt;</span>nln_upl_pkt<span class="token punctuation">;</span>
    head<span class="token operator">-&gt;</span>count_downl_pkt   <span class="token operator">+=</span> newNode<span class="token operator">-&gt;</span>nln_downl_pkt<span class="token punctuation">;</span>
    head<span class="token operator">-&gt;</span>count_upl         <span class="token operator">+=</span> newNode<span class="token operator">-&gt;</span>nln_upl_size<span class="token punctuation">;</span>
    head<span class="token operator">-&gt;</span>count_downl       <span class="token operator">+=</span> newNode<span class="token operator">-&gt;</span>nln_downl_size<span class="token punctuation">;</span>

    newNode<span class="token operator">-&gt;</span>next <span class="token operator">=</span> head<span class="token operator">-&gt;</span>link<span class="token punctuation">;</span>
    head<span class="token operator">-&gt;</span>link <span class="token operator">=</span> newNode<span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token keyword">void</span> <span class="token function">clear_flowLink</span><span class="token punctuation">(</span>net_link_header <span class="token operator">*</span>head<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span> head<span class="token operator">-&gt;</span>link <span class="token operator">==</span> <span class="token constant">NULL</span> <span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span><span class="token punctuation">;</span><span class="token punctuation">}</span>

    net_link_node <span class="token operator">*</span>pTemp1 <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
    net_link_node <span class="token operator">*</span>pTemp2 <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>

    pTemp1 <span class="token operator">=</span> head<span class="token operator">-&gt;</span>link<span class="token punctuation">;</span>
    pTemp2 <span class="token operator">=</span> pTemp1<span class="token operator">-&gt;</span>next<span class="token punctuation">;</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span> pTemp2 <span class="token operator">!=</span> <span class="token constant">NULL</span> <span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">free</span><span class="token punctuation">(</span>pTemp1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        pTemp1 <span class="token operator">=</span> pTemp2<span class="token punctuation">;</span>
        pTemp2 <span class="token operator">=</span> pTemp1<span class="token operator">-&gt;</span>next<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">free</span><span class="token punctuation">(</span>pTemp1<span class="token punctuation">)</span><span class="token punctuation">;</span>

    head<span class="token operator">-&gt;</span>link <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">parse_flowLink_TCP</span><span class="token punctuation">(</span>FILE <span class="token operator">*</span>fOutput<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">fprintf</span><span class="token punctuation">(</span>fOutput<span class="token punctuation">,</span> <span class="token string">&quot;TCP&#x8FDE;&#x63A5;&#x4E2A;&#x6570;&#xFF1A;\t%d\n&quot;</span><span class="token punctuation">,</span> FLowLink_TCP<span class="token operator">-&gt;</span>count_conn<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">fprintf</span><span class="token punctuation">(</span>fOutput<span class="token punctuation">,</span> <span class="token string">&quot;TCP&#x6570;&#x636E;&#x5305;&#x4E2A;&#x6570;&#xFF1A;\t%d\n&quot;</span><span class="token punctuation">,</span> FLowLink_TCP<span class="token operator">-&gt;</span>count_upl_pkt <span class="token operator">+</span> FLowLink_TCP<span class="token operator">-&gt;</span>count_upl_pkt<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">fprintf</span><span class="token punctuation">(</span>fOutput<span class="token punctuation">,</span> <span class="token string">&quot;TCP&#x6570;&#x636E;&#x603B;&#x6D41;&#x91CF;&#xFF1A;\t%d bytes\n&quot;</span><span class="token punctuation">,</span> FLowLink_TCP<span class="token operator">-&gt;</span>count_upl <span class="token operator">+</span> FLowLink_TCP<span class="token operator">-&gt;</span>count_downl<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">fprintf</span><span class="token punctuation">(</span>fOutput<span class="token punctuation">,</span> <span class="token string">&quot;TCP&#x6570;&#x636E;&#x4E0A;&#x4F20;&#x91CF;&#xFF1A;\t%d bytes\n&quot;</span><span class="token punctuation">,</span> FLowLink_TCP<span class="token operator">-&gt;</span>count_upl<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">fprintf</span><span class="token punctuation">(</span>fOutput<span class="token punctuation">,</span> <span class="token string">&quot;TCP&#x6570;&#x636E;&#x4E0B;&#x8F7D;&#x91CF;&#xFF1A;\t%d bytes\n&quot;</span><span class="token punctuation">,</span> FLowLink_TCP<span class="token operator">-&gt;</span>count_downl<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">fprintf</span><span class="token punctuation">(</span>fOutput<span class="token punctuation">,</span> <span class="token string">&quot;-----------------------\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    net_link_node <span class="token operator">*</span>pTemp <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
    pTemp <span class="token operator">=</span> FLowLink_TCP<span class="token operator">-&gt;</span>link<span class="token punctuation">;</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span> pTemp <span class="token operator">!=</span> <span class="token constant">NULL</span> <span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">fprintf</span><span class="token punctuation">(</span>fOutput<span class="token punctuation">,</span> <span class="token string">&quot;%s\t%u\t&quot;</span><span class="token punctuation">,</span> <span class="token function">iptos</span><span class="token punctuation">(</span>pTemp<span class="token operator">-&gt;</span>nln_5set<span class="token punctuation">.</span>sip<span class="token punctuation">)</span><span class="token punctuation">,</span> pTemp<span class="token operator">-&gt;</span>nln_5set<span class="token punctuation">.</span>sport<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">fprintf</span><span class="token punctuation">(</span>fOutput<span class="token punctuation">,</span> <span class="token string">&quot;==&gt;\t%s\t%u\t&quot;</span><span class="token punctuation">,</span> <span class="token function">iptos</span><span class="token punctuation">(</span>pTemp<span class="token operator">-&gt;</span>nln_5set<span class="token punctuation">.</span>dip<span class="token punctuation">)</span><span class="token punctuation">,</span> pTemp<span class="token operator">-&gt;</span>nln_5set<span class="token punctuation">.</span>dport<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">fprintf</span><span class="token punctuation">(</span>fOutput<span class="token punctuation">,</span> <span class="token string">&quot;&#x4E0A;&#x4F20;&#x5305;&#x6570;&#x91CF;&#xFF1A;%d\t&quot;</span><span class="token punctuation">,</span> pTemp<span class="token operator">-&gt;</span>nln_upl_pkt<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">fprintf</span><span class="token punctuation">(</span>fOutput<span class="token punctuation">,</span> <span class="token string">&quot;&#x4E0B;&#x8F7D;&#x5305;&#x6570;&#x91CF;&#xFF1A;%d\t&quot;</span><span class="token punctuation">,</span> pTemp<span class="token operator">-&gt;</span>nln_downl_pkt<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">fprintf</span><span class="token punctuation">(</span>fOutput<span class="token punctuation">,</span> <span class="token string">&quot;upload&#xFF1A;%d bytes\t&quot;</span><span class="token punctuation">,</span> pTemp<span class="token operator">-&gt;</span>nln_upl_size<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">fprintf</span><span class="token punctuation">(</span>fOutput<span class="token punctuation">,</span> <span class="token string">&quot;download&#xFF1A;%d bytes\t&quot;</span><span class="token punctuation">,</span> pTemp<span class="token operator">-&gt;</span>nln_downl_size<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">fprintf</span><span class="token punctuation">(</span>fOutput<span class="token punctuation">,</span> <span class="token string">&quot;\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        pTemp <span class="token operator">=</span> pTemp<span class="token operator">-&gt;</span>next<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">clear_flowLink</span><span class="token punctuation">(</span>FLowLink_TCP<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">parse_flowLink_UDP</span><span class="token punctuation">(</span>FILE <span class="token operator">*</span>fOutput<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">fprintf</span><span class="token punctuation">(</span>fOutput<span class="token punctuation">,</span> <span class="token string">&quot;UDP&#x6570;&#x636E;&#x5305;&#x4E2A;&#x6570;&#xFF1A;\t%d\n&quot;</span><span class="token punctuation">,</span> FLowLink_UDP<span class="token operator">-&gt;</span>count_upl_pkt <span class="token operator">+</span> FLowLink_UDP<span class="token operator">-&gt;</span>count_upl_pkt<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">fprintf</span><span class="token punctuation">(</span>fOutput<span class="token punctuation">,</span> <span class="token string">&quot;UDP&#x6570;&#x636E;&#x6D41;&#x91CF;&#xFF1A;\t%d bytes\n&quot;</span><span class="token punctuation">,</span> FLowLink_UDP<span class="token operator">-&gt;</span>count_upl <span class="token operator">+</span> FLowLink_UDP<span class="token operator">-&gt;</span>count_downl<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">clear_flowLink</span><span class="token punctuation">(</span>FLowLink_UDP<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


u_short <span class="token function">get_ushort_net</span><span class="token punctuation">(</span>u_short virtu<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>u_short<span class="token punctuation">)</span><span class="token punctuation">(</span>virtu <span class="token operator">&gt;&gt;</span> <span class="token number">8</span> <span class="token operator">|</span> virtu <span class="token operator">&lt;&lt;</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


u_short <span class="token function">get_hash</span><span class="token punctuation">(</span><span class="token keyword">const</span> net5set <span class="token operator">*</span>theSet<span class="token punctuation">)</span><span class="token punctuation">{</span>
    u_int srcIP <span class="token operator">=</span> theSet<span class="token operator">-&gt;</span>sip<span class="token punctuation">;</span>
    u_int desIP <span class="token operator">=</span> theSet<span class="token operator">-&gt;</span>dip<span class="token punctuation">;</span>
    u_int port  <span class="token operator">=</span> <span class="token punctuation">(</span>u_int<span class="token punctuation">)</span><span class="token punctuation">(</span>theSet<span class="token operator">-&gt;</span>sport <span class="token operator">*</span> theSet<span class="token operator">-&gt;</span>dport<span class="token punctuation">)</span><span class="token punctuation">;</span>
    u_int res   <span class="token operator">=</span> <span class="token punctuation">(</span>srcIP<span class="token operator">^</span>desIP<span class="token punctuation">)</span><span class="token operator">^</span>port<span class="token punctuation">;</span>
    u_short hash<span class="token operator">=</span> <span class="token punctuation">(</span>u_short<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span>res <span class="token operator">&amp;</span> <span class="token number">0x00ff</span><span class="token punctuation">)</span><span class="token operator">^</span><span class="token punctuation">(</span>res <span class="token operator">&gt;&gt;</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> hash<span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token keyword">void</span> <span class="token function">add_to_hashTable</span><span class="token punctuation">(</span>u_short hash<span class="token punctuation">,</span> <span class="token keyword">const</span> net_link_node <span class="token operator">*</span>theNode<span class="token punctuation">,</span> u_char flags<span class="token punctuation">)</span><span class="token punctuation">{</span>
    net_link_node <span class="token operator">*</span>HashNode <span class="token operator">=</span> <span class="token punctuation">(</span>net_link_node <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>net_link_node<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">memcpy</span><span class="token punctuation">(</span>HashNode<span class="token punctuation">,</span> theNode<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>net_link_node<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>HashTable<span class="token punctuation">[</span>hash<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>
        HashTable<span class="token punctuation">[</span>hash<span class="token punctuation">]</span> <span class="token operator">=</span> HashNode<span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    net_link_node <span class="token operator">*</span>pTemp <span class="token operator">=</span> HashTable<span class="token punctuation">[</span>hash<span class="token punctuation">]</span><span class="token punctuation">;</span>
    net_link_node <span class="token operator">*</span>pBack <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> isSame_up <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> isSame_down <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span>pTemp <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>
        isSame_up <span class="token operator">=</span> <span class="token punctuation">(</span>pTemp<span class="token operator">-&gt;</span>nln_5set<span class="token punctuation">.</span>sip <span class="token operator">==</span> HashNode<span class="token operator">-&gt;</span>nln_5set<span class="token punctuation">.</span>sip<span class="token punctuation">)</span>
                <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>pTemp<span class="token operator">-&gt;</span>nln_5set<span class="token punctuation">.</span>dip <span class="token operator">==</span> HashNode<span class="token operator">-&gt;</span>nln_5set<span class="token punctuation">.</span>dip<span class="token punctuation">)</span>
                <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>pTemp<span class="token operator">-&gt;</span>nln_5set<span class="token punctuation">.</span>sport <span class="token operator">==</span> HashNode<span class="token operator">-&gt;</span>nln_5set<span class="token punctuation">.</span>sport<span class="token punctuation">)</span>
                <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>pTemp<span class="token operator">-&gt;</span>nln_5set<span class="token punctuation">.</span>dport <span class="token operator">==</span> HashNode<span class="token operator">-&gt;</span>nln_5set<span class="token punctuation">.</span>dport<span class="token punctuation">)</span><span class="token punctuation">;</span>

        isSame_down <span class="token operator">=</span> <span class="token punctuation">(</span>pTemp<span class="token operator">-&gt;</span>nln_5set<span class="token punctuation">.</span>dip <span class="token operator">==</span> HashNode<span class="token operator">-&gt;</span>nln_5set<span class="token punctuation">.</span>sip<span class="token punctuation">)</span>
                <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>pTemp<span class="token operator">-&gt;</span>nln_5set<span class="token punctuation">.</span>sip <span class="token operator">==</span> HashNode<span class="token operator">-&gt;</span>nln_5set<span class="token punctuation">.</span>dip<span class="token punctuation">)</span>
                <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>pTemp<span class="token operator">-&gt;</span>nln_5set<span class="token punctuation">.</span>dport <span class="token operator">==</span> HashNode<span class="token operator">-&gt;</span>nln_5set<span class="token punctuation">.</span>sport<span class="token punctuation">)</span>
                <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>pTemp<span class="token operator">-&gt;</span>nln_5set<span class="token punctuation">.</span>sport <span class="token operator">==</span> HashNode<span class="token operator">-&gt;</span>nln_5set<span class="token punctuation">.</span>dport<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span> isSame_up <span class="token punctuation">)</span>        <span class="token punctuation">{</span>
            pTemp<span class="token operator">-&gt;</span>nln_upl_size <span class="token operator">+=</span> HashNode<span class="token operator">-&gt;</span>nln_upl_size<span class="token punctuation">;</span>
            pTemp<span class="token operator">-&gt;</span>nln_upl_pkt <span class="token operator">++</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>pTemp<span class="token operator">-&gt;</span>nln_status <span class="token operator">==</span> ESTABLISHED <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>flags <span class="token operator">&amp;</span> TH_FIN<span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token comment">// &#x5EFA;&#x7ACB;&#x8FDE;&#x63A5;&#x5E76;&#x5B8C;&#x6210;&#x6570;&#x636E;&#x7684;&#x53D1;&#x9001;</span>
                pTemp<span class="token operator">-&gt;</span>nln_status <span class="token operator">=</span> FIN_WAIT_1<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>pTemp<span class="token operator">-&gt;</span>nln_status <span class="token operator">==</span> TIME_WAIT <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>flags <span class="token operator">&amp;</span> TH_ACK<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                pTemp<span class="token operator">-&gt;</span>nln_status <span class="token operator">=</span> CLOSED<span class="token punctuation">;</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>pBack <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
                <span class="token punctuation">{</span>
                    HashTable<span class="token punctuation">[</span>hash<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">else</span>
                <span class="token punctuation">{</span>
                    pBack<span class="token operator">-&gt;</span>next <span class="token operator">=</span> pTemp<span class="token operator">-&gt;</span>next<span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token function">add_to_flowLink</span><span class="token punctuation">(</span>FLowLink_TCP<span class="token punctuation">,</span> pTemp<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">free</span><span class="token punctuation">(</span>pTemp<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>pTemp<span class="token operator">-&gt;</span>nln_status <span class="token operator">==</span> CLOSE_WAIT <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>flags <span class="token operator">&amp;</span> TH_FIN<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                pTemp<span class="token operator">-&gt;</span>nln_status <span class="token operator">=</span> LAST_ACK<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token function">free</span><span class="token punctuation">(</span>HashNode<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span> isSame_down <span class="token punctuation">)</span>        <span class="token punctuation">{</span>
            pTemp<span class="token operator">-&gt;</span>nln_downl_size <span class="token operator">+=</span> HashNode<span class="token operator">-&gt;</span>nln_upl_size<span class="token punctuation">;</span>
            pTemp<span class="token operator">-&gt;</span>nln_downl_pkt <span class="token operator">++</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>pTemp<span class="token operator">-&gt;</span>nln_status <span class="token operator">==</span> ESTABLISHED <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>flags <span class="token operator">&amp;</span> TH_FIN<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                pTemp<span class="token operator">-&gt;</span>nln_status <span class="token operator">=</span> CLOSE_WAIT<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>pTemp<span class="token operator">-&gt;</span>nln_status <span class="token operator">==</span> LAST_ACK <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>flags <span class="token operator">&amp;</span> TH_ACK<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                pTemp<span class="token operator">-&gt;</span>nln_status <span class="token operator">=</span> CLOSED<span class="token punctuation">;</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>pBack <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                    HashTable<span class="token punctuation">[</span>hash<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">else</span><span class="token punctuation">{</span>
                    pBack<span class="token operator">-&gt;</span>next <span class="token operator">=</span> pTemp<span class="token operator">-&gt;</span>next<span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token function">add_to_flowLink</span><span class="token punctuation">(</span>FLowLink_TCP<span class="token punctuation">,</span> pTemp<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">free</span><span class="token punctuation">(</span>pTemp<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>pTemp<span class="token operator">-&gt;</span>nln_status <span class="token operator">==</span> FIN_WAIT_1 <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>flags <span class="token operator">&amp;</span> TH_ACK<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                pTemp<span class="token operator">-&gt;</span>nln_status <span class="token operator">=</span> FIN_WAIT_2<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>pTemp<span class="token operator">-&gt;</span>nln_status <span class="token operator">==</span> FIN_WAIT_2 <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>flags <span class="token operator">&amp;</span> TH_FIN<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                pTemp<span class="token operator">-&gt;</span>nln_status <span class="token operator">=</span> TIME_WAIT<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token function">free</span><span class="token punctuation">(</span>HashNode<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        pBack <span class="token operator">=</span> pTemp<span class="token punctuation">;</span>
        pTemp <span class="token operator">=</span> pTemp<span class="token operator">-&gt;</span>next<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>pTemp <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        pBack<span class="token operator">-&gt;</span>next <span class="token operator">=</span> HashNode<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">clear_hashTable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    net_link_node <span class="token operator">*</span>pTemp1 <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
    net_link_node <span class="token operator">*</span>pTemp2 <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> HASH_TABLE_SIZE<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>HashTable<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">continue</span><span class="token punctuation">;</span><span class="token punctuation">}</span>

        pTemp1 <span class="token operator">=</span> HashTable<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span><span class="token punctuation">(</span>pTemp1 <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            pTemp2 <span class="token operator">=</span> pTemp1<span class="token operator">-&gt;</span>next<span class="token punctuation">;</span>
            <span class="token function">add_to_flowLink</span><span class="token punctuation">(</span>FLowLink_TCP<span class="token punctuation">,</span> pTemp1<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">free</span><span class="token punctuation">(</span>pTemp1<span class="token punctuation">)</span><span class="token punctuation">;</span>
            pTemp1 <span class="token operator">=</span> pTemp2<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        HashTable<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>TCP_FLAG<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;FIN&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;SYN&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;RST&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;PSH&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ACK&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;URG&quot;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token operator">*</span><span class="token function">analysis_pkt</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span>argv<span class="token punctuation">)</span><span class="token punctuation">{</span>
    isAnalysisDone <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;analysis.......\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>file_output <span class="token operator">=</span> <span class="token string">&quot;result.data&quot;</span><span class="token punctuation">;</span>
    FILE <span class="token operator">*</span>fOutput <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span>file_output<span class="token punctuation">,</span> <span class="token string">&quot;w&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">fclose</span><span class="token punctuation">(</span>fOutput<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// clear file</span>
    fOutput <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span>file_output<span class="token punctuation">,</span> <span class="token string">&quot;a+&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>filename <span class="token operator">=</span> <span class="token string">&quot;traffic.data&quot;</span><span class="token punctuation">;</span>
    <span class="token function">fprintf</span><span class="token punctuation">(</span>fOutput<span class="token punctuation">,</span> <span class="token string">&quot;&#x6570;&#x636E;&#x6587;&#x4EF6;&#xFF1A;%s\n&quot;</span><span class="token punctuation">,</span> filename<span class="token punctuation">)</span><span class="token punctuation">;</span>

    shh_pkthdr      <span class="token operator">*</span>pkthdr     <span class="token operator">=</span> <span class="token punctuation">(</span>shh_pkthdr <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>shh_pkthdr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ether_header    <span class="token operator">*</span>segEther   <span class="token operator">=</span> <span class="token punctuation">(</span>ether_header<span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>ether_header<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ip_header       <span class="token operator">*</span>segIP      <span class="token operator">=</span> <span class="token punctuation">(</span>ip_header<span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>ip_header<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    tcp_header      <span class="token operator">*</span>segTCP     <span class="token operator">=</span> <span class="token punctuation">(</span>tcp_header<span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>tcp_header<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    udp_header      <span class="token operator">*</span>segUDP     <span class="token operator">=</span> <span class="token punctuation">(</span>udp_header<span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>udp_header<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    net5set         <span class="token operator">*</span>Cur5Set    <span class="token operator">=</span> <span class="token punctuation">(</span>net5set <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>net5set<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    net_link_node   <span class="token operator">*</span>LinkNode   <span class="token operator">=</span> <span class="token punctuation">(</span>net_link_node <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>net_link_node<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    FLowLink_TCP <span class="token operator">=</span> <span class="token punctuation">(</span>net_link_header <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>net_link_header<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">init_flowLink</span><span class="token punctuation">(</span>FLowLink_TCP<span class="token punctuation">)</span><span class="token punctuation">;</span>
    FLowLink_UDP <span class="token operator">=</span> <span class="token punctuation">(</span>net_link_header <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>net_link_header<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">init_flowLink</span><span class="token punctuation">(</span>FLowLink_UDP<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">long</span>    fileLen     <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span>     pktLen      <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token comment">// pktLen = Ether + IP</span>
    <span class="token keyword">int</span>     trailerLen  <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    u_short ipLen_real  <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    u_short ipLen_total <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    u_short tcpLen_real <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    u_short dataLen     <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> pkt_num <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    pkt_link_node <span class="token operator">*</span>ptmp <span class="token operator">=</span> pkt_link<span class="token operator">-&gt;</span>link<span class="token punctuation">;</span>
    
    <span class="token keyword">int</span> tstamp_start    <span class="token operator">=</span> ptmp<span class="token operator">-&gt;</span>pkt_node<span class="token operator">-&gt;</span>header<span class="token punctuation">.</span>ts<span class="token punctuation">.</span>tv_sec<span class="token punctuation">;</span>
    <span class="token keyword">int</span> tstamp_offset   <span class="token operator">=</span> tstamp_start<span class="token punctuation">;</span>
    <span class="token keyword">int</span> tstamp_now      <span class="token operator">=</span> tstamp_start<span class="token punctuation">;</span>
    <span class="token keyword">int</span> cycle           <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
    cycle <span class="token operator">=</span> <span class="token punctuation">(</span>cycle <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">?</span> cycle <span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">;</span>
    <span class="token function">fprintf</span><span class="token punctuation">(</span>fOutput<span class="token punctuation">,</span> <span class="token string">&quot;&#x5206;&#x6790;&#x5468;&#x671F;&#xFF1A;%d s\n&quot;</span><span class="token punctuation">,</span> cycle<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// &#x5BF9;&#x6570;&#x636E;&#x5305;&#x94FE;&#x8868;&#x8FDB;&#x884C;&#x5904;&#x7406;</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span>ptmp <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        pktLen <span class="token operator">=</span> ptmp<span class="token operator">-&gt;</span>pkt_node<span class="token operator">-&gt;</span>header<span class="token punctuation">.</span>caplen<span class="token punctuation">;</span>
        tstamp_now <span class="token operator">=</span> ptmp<span class="token operator">-&gt;</span>pkt_node<span class="token operator">-&gt;</span>header<span class="token punctuation">.</span>ts<span class="token punctuation">.</span>tv_sec<span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>tstamp_now <span class="token operator">-</span> tstamp_offset <span class="token operator">&gt;=</span> cycle<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token function">fprintf</span><span class="token punctuation">(</span>fOutput<span class="token punctuation">,</span> <span class="token string">&quot;\n\n&gt;&gt;&gt;&gt;&gt; &#x65F6;&#x95F4;&#x6BB5;&#xFF1A;%s&quot;</span><span class="token punctuation">,</span> <span class="token function">long2time</span><span class="token punctuation">(</span>tstamp_offset<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">fprintf</span><span class="token punctuation">(</span>fOutput<span class="token punctuation">,</span> <span class="token string">&quot; --&gt; %s\n&quot;</span><span class="token punctuation">,</span> <span class="token function">long2time</span><span class="token punctuation">(</span>tstamp_offset <span class="token operator">+</span> cycle<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token function">fprintf</span><span class="token punctuation">(</span>fOutput<span class="token punctuation">,</span> <span class="token string">&quot;----------------------\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">clear_hashTable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">parse_flowLink_UDP</span><span class="token punctuation">(</span>fOutput<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">init_flowLink</span><span class="token punctuation">(</span>FLowLink_UDP<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token function">fprintf</span><span class="token punctuation">(</span>fOutput<span class="token punctuation">,</span> <span class="token string">&quot;----------------------\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">parse_flowLink_TCP</span><span class="token punctuation">(</span>fOutput<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">init_flowLink</span><span class="token punctuation">(</span>FLowLink_TCP<span class="token punctuation">)</span><span class="token punctuation">;</span>
            tstamp_offset <span class="token operator">=</span> tstamp_now<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// &#x83B7;&#x53D6;&#x4EE5;&#x592A;&#x7F51;&#x7684;&#x62A5;&#x5934;</span>
        <span class="token function">memcpy</span><span class="token punctuation">(</span>segEther<span class="token punctuation">,</span> ptmp<span class="token operator">-&gt;</span>pkt_node<span class="token operator">-&gt;</span>pkt_data<span class="token punctuation">,</span> ETHER_LEN<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">get_ushort_net</span><span class="token punctuation">(</span>segEther<span class="token operator">-&gt;</span>type<span class="token punctuation">)</span> <span class="token operator">!=</span> ETHER_TYPE_IP<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">// &#x4E0D;&#x662F;&#x6570;&#x636E;&#x94FE;&#x8DEF;&#x5C42;&#x7684;&#x6570;&#x636E;&#x5305;&#x8DF3;&#x8FC7;</span>
            ptmp <span class="token operator">=</span> ptmp<span class="token operator">-&gt;</span>next<span class="token punctuation">;</span>
            <span class="token keyword">continue</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// &#x83B7;&#x53D6;IP&#x6570;&#x636E;&#x5305;&#x7684;&#x62A5;&#x5934;</span>
        <span class="token comment">// &#x5148;&#x83B7;&#x53D6;&#x6700;&#x5C0F;&#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x4E5F;&#x5373;&#x662F;20&#x4E2A;&#x5B57;&#x8282;</span>
        <span class="token function">memcpy</span><span class="token punctuation">(</span>segIP<span class="token punctuation">,</span> ptmp<span class="token operator">-&gt;</span>pkt_node<span class="token operator">-&gt;</span>pkt_data <span class="token operator">+</span> ETHER_LEN<span class="token punctuation">,</span> IP_LEN_MIN<span class="token punctuation">)</span><span class="token punctuation">;</span>
        ipLen_real <span class="token operator">=</span> <span class="token punctuation">(</span>segIP<span class="token operator">-&gt;</span>ver_ihl <span class="token operator">&amp;</span> <span class="token number">0x0f</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">4</span><span class="token punctuation">;</span>   <span class="token comment">// IP&#x6570;&#x636E;&#x62A5;&#x7684;&#x62A5;&#x5934;&#x957F;&#x5EA6;&#x5355;&#x4F4D;&#x662F;4&#x5B57;&#x8282;&#xFF0C;&#x6240;&#x4EE5;&#x53D6;&#x503C;&#x540E;&#x4E58;&#x56DB;</span>
        ipLen_total <span class="token operator">=</span> <span class="token function">get_ushort_net</span><span class="token punctuation">(</span>segIP<span class="token operator">-&gt;</span>tlen<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// IP&#x6570;&#x636E;&#x62A5;&#x7684;&#x603B;&#x957F;&#x5EA6;</span>
        trailerLen <span class="token operator">=</span> pktLen <span class="token operator">-</span> ETHER_LEN <span class="token operator">-</span> ipLen_total<span class="token punctuation">;</span> <span class="token comment">// &#x56E0;&#x4E3A;&#x94FE;&#x8DEF;&#x5C42;&#x7684;&#x6570;&#x636E;&#x5E27;&#x53EF;&#x80FD;&#x4F1A;&#x5C3E;&#x90E8;&#x8865;&#x9F50;&#xFF0C;&#x6240;&#x4EE5;&#x4E00;&#x4E2A;&#x6570;&#x636E;&#x5305;&#x7684;&#x540E;&#x9762;&#x6709;&#x4E00;&#x4E9B;&#x65E0;&#x7528;&#x6570;&#x636E;&#xFF0C;&#x4E0D;&#x5C5E;&#x4E8E;IP&#x6570;&#x636E;&#x62A5;</span>

        <span class="token comment">// printf(&quot;analysis starting...\n&quot;);</span>
        <span class="token comment">// if(segIP-&gt;proto != IP_TCP &amp;&amp; segIP-&gt;proto != IP_UDP){</span>
        <span class="token comment">//     // &#x975E;TCP&#x3001;UDP&#x6570;&#x636E;&#x62A5;&#xFF0C;&#x820D;&#x5F03;</span>
        <span class="token comment">//     continue;</span>
        <span class="token comment">// }</span>

        <span class="token comment">// &#x8BBE;&#x7F6E;&#x4E94;&#x5143;&#x7EC4;</span>
        Cur5Set<span class="token operator">-&gt;</span>sip <span class="token operator">=</span> segIP<span class="token operator">-&gt;</span>saddr<span class="token punctuation">;</span>
        Cur5Set<span class="token operator">-&gt;</span>dip <span class="token operator">=</span> segIP<span class="token operator">-&gt;</span>daddr<span class="token punctuation">;</span>
        Cur5Set<span class="token operator">-&gt;</span>protocol <span class="token operator">=</span> segIP<span class="token operator">-&gt;</span>proto<span class="token punctuation">;</span>

        <span class="token keyword">if</span><span class="token punctuation">(</span>segIP<span class="token operator">-&gt;</span>proto <span class="token operator">==</span> IP_TCP<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token function">memcpy</span><span class="token punctuation">(</span>segTCP<span class="token punctuation">,</span> ptmp<span class="token operator">-&gt;</span>pkt_node<span class="token operator">-&gt;</span>pkt_data <span class="token operator">+</span> ETHER_LEN <span class="token operator">+</span> ipLen_real<span class="token punctuation">,</span> TCP_LEN_MIN<span class="token punctuation">)</span><span class="token punctuation">;</span>
            tcpLen_real <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>segTCP<span class="token operator">-&gt;</span>th_len<span class="token punctuation">)</span> <span class="token operator">&gt;&gt;</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0x0f</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">4</span><span class="token punctuation">;</span>
            dataLen <span class="token operator">=</span> ipLen_total <span class="token operator">-</span> ipLen_real <span class="token operator">-</span> tcpLen_real<span class="token punctuation">;</span>

            Cur5Set<span class="token operator">-&gt;</span>sport <span class="token operator">=</span> <span class="token function">get_ushort_net</span><span class="token punctuation">(</span>segTCP<span class="token operator">-&gt;</span>th_sport<span class="token punctuation">)</span><span class="token punctuation">;</span>
            Cur5Set<span class="token operator">-&gt;</span>dport <span class="token operator">=</span> <span class="token function">get_ushort_net</span><span class="token punctuation">(</span>segTCP<span class="token operator">-&gt;</span>th_dport<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// parse high lavel proto in here</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>segIP<span class="token operator">-&gt;</span>proto <span class="token operator">==</span> IP_UDP<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token function">memcpy</span><span class="token punctuation">(</span>segUDP<span class="token punctuation">,</span> ptmp<span class="token operator">-&gt;</span>pkt_node<span class="token operator">-&gt;</span>pkt_data <span class="token operator">+</span> ETHER_LEN <span class="token operator">+</span> ipLen_real<span class="token punctuation">,</span> UDP_LEN<span class="token punctuation">)</span><span class="token punctuation">;</span>
            dataLen <span class="token operator">=</span> ipLen_total <span class="token operator">-</span> ipLen_real <span class="token operator">-</span> UDP_LEN<span class="token punctuation">;</span>

            Cur5Set<span class="token operator">-&gt;</span>sport <span class="token operator">=</span> <span class="token function">get_ushort_net</span><span class="token punctuation">(</span>segUDP<span class="token operator">-&gt;</span>uh_sport<span class="token punctuation">)</span><span class="token punctuation">;</span>
            Cur5Set<span class="token operator">-&gt;</span>dport <span class="token operator">=</span> <span class="token function">get_ushort_net</span><span class="token punctuation">(</span>segUDP<span class="token operator">-&gt;</span>uh_dport<span class="token punctuation">)</span><span class="token punctuation">;</span>


        <span class="token punctuation">}</span>

        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;\n---------------------- %d -----------------------\n&quot;</span><span class="token punctuation">,</span> <span class="token operator">++</span>pkt_num<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%s -- len: %d\n&quot;</span><span class="token punctuation">,</span> <span class="token function">long2time</span><span class="token punctuation">(</span>tstamp_now<span class="token punctuation">)</span><span class="token punctuation">,</span> ptmp<span class="token operator">-&gt;</span>pkt_node<span class="token operator">-&gt;</span>header<span class="token punctuation">.</span>len<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%s:%d -&gt; %s:%d\n&quot;</span><span class="token punctuation">,</span> <span class="token function">iptos</span><span class="token punctuation">(</span>Cur5Set<span class="token operator">-&gt;</span>sip<span class="token punctuation">)</span><span class="token punctuation">,</span> Cur5Set<span class="token operator">-&gt;</span>sport<span class="token punctuation">,</span> <span class="token function">iptos</span><span class="token punctuation">(</span>Cur5Set<span class="token operator">-&gt;</span>dip<span class="token punctuation">)</span><span class="token punctuation">,</span> Cur5Set<span class="token operator">-&gt;</span>dport<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;protocol: &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> proto <span class="token operator">=</span> segIP<span class="token operator">-&gt;</span>proto<span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>proto <span class="token operator">==</span> IP_ICMP<span class="token punctuation">)</span><span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">&quot;ICMP&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>proto <span class="token operator">==</span> IP_IGMP<span class="token punctuation">)</span><span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">&quot;IGMP&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>proto <span class="token operator">==</span> IP_TCP<span class="token punctuation">)</span><span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">&quot;TCP&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>proto <span class="token operator">==</span> IP_UDP<span class="token punctuation">)</span><span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">&quot;UDP&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>proto <span class="token operator">==</span> IP_IGRP<span class="token punctuation">)</span><span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">&quot;IGRP&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>proto <span class="token operator">==</span> IP_OSPF<span class="token punctuation">)</span><span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">&quot;OSPF&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span><span class="token punctuation">{</span><span class="token punctuation">}</span>

        <span class="token keyword">if</span><span class="token punctuation">(</span>proto <span class="token operator">==</span> IP_TCP<span class="token punctuation">)</span><span class="token punctuation">{</span>
            u_char flag <span class="token operator">=</span> segTCP<span class="token operator">-&gt;</span>th_flags<span class="token punctuation">;</span>
            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;[&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> <span class="token number">8</span><span class="token punctuation">;</span> <span class="token operator">++</span>j<span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>flag <span class="token operator">&gt;&gt;</span> j<span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%s &quot;</span><span class="token punctuation">,</span> TCP_FLAG<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;], &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Seq = %d, Win = %d, Len = %d\n&quot;</span><span class="token punctuation">,</span> segTCP<span class="token operator">-&gt;</span>th_seq<span class="token punctuation">,</span> segTCP<span class="token operator">-&gt;</span>th_win<span class="token punctuation">,</span> segTCP<span class="token operator">-&gt;</span>th_len<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// &#x6839;&#x636E;&#x7AEF;&#x53E3;&#x6765;&#x5224;&#x65AD;&#x4E0A;&#x5C42;&#x534F;&#x8BAE;DNS&#x3001;web&#x7B49;&#x7B49;</span>
            <span class="token comment">// DNS&#x8FD0;&#x884C;&#x4E8E;53&#x7AEF;&#x53E3;</span>
            <span class="token comment">// web&#x4E00;&#x822C;&#x8FD0;&#x884C;&#x4E8E;80&#x3001;8080&#x3001;443&#x7B49;&#x7B49;&#x7AEF;&#x53E3;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>Cur5Set<span class="token operator">-&gt;</span>sport <span class="token operator">==</span> <span class="token punctuation">(</span>u_short<span class="token punctuation">)</span><span class="token number">53</span> <span class="token operator">||</span> Cur5Set<span class="token operator">-&gt;</span>dport <span class="token operator">==</span> <span class="token punctuation">(</span>u_short<span class="token punctuation">)</span><span class="token number">53</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;protocol: DNS\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>Cur5Set<span class="token operator">-&gt;</span>sport <span class="token operator">==</span> <span class="token punctuation">(</span>u_short<span class="token punctuation">)</span><span class="token number">80</span> <span class="token operator">||</span> Cur5Set<span class="token operator">-&gt;</span>dport <span class="token operator">==</span> <span class="token punctuation">(</span>u_short<span class="token punctuation">)</span><span class="token number">80</span> <span class="token operator">||</span> 
                    Cur5Set<span class="token operator">-&gt;</span>sport <span class="token operator">==</span> <span class="token punctuation">(</span>u_short<span class="token punctuation">)</span><span class="token number">443</span> <span class="token operator">||</span> Cur5Set<span class="token operator">-&gt;</span>dport <span class="token operator">==</span> <span class="token punctuation">(</span>u_short<span class="token punctuation">)</span><span class="token number">443</span> <span class="token operator">||</span> 
                    Cur5Set<span class="token operator">-&gt;</span>sport <span class="token operator">==</span> <span class="token punctuation">(</span>u_short<span class="token punctuation">)</span><span class="token number">8080</span> <span class="token operator">||</span> Cur5Set<span class="token operator">-&gt;</span>dport <span class="token operator">==</span> <span class="token punctuation">(</span>u_short<span class="token punctuation">)</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;protocol: HTTP\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
            <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>Cur5Set<span class="token operator">-&gt;</span>sport <span class="token operator">==</span> <span class="token punctuation">(</span>u_short<span class="token punctuation">)</span><span class="token number">23</span> <span class="token operator">||</span> Cur5Set<span class="token operator">-&gt;</span>dport <span class="token operator">==</span> <span class="token punctuation">(</span>u_short<span class="token punctuation">)</span><span class="token number">23</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;protocol: Telnet\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>Cur5Set<span class="token operator">-&gt;</span>sport <span class="token operator">==</span> <span class="token punctuation">(</span>u_short<span class="token punctuation">)</span><span class="token number">21</span> <span class="token operator">||</span> Cur5Set<span class="token operator">-&gt;</span>dport <span class="token operator">==</span> <span class="token punctuation">(</span>u_short<span class="token punctuation">)</span><span class="token number">21</span> <span class="token operator">||</span> 
                    Cur5Set<span class="token operator">-&gt;</span>sport <span class="token operator">==</span> <span class="token punctuation">(</span>u_short<span class="token punctuation">)</span><span class="token number">20</span> <span class="token operator">||</span> Cur5Set<span class="token operator">-&gt;</span>dport <span class="token operator">==</span> <span class="token punctuation">(</span>u_short<span class="token punctuation">)</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;protocol: FTP\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
            <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>Cur5Set<span class="token operator">-&gt;</span>sport <span class="token operator">==</span> <span class="token punctuation">(</span>u_short<span class="token punctuation">)</span><span class="token number">25</span> <span class="token operator">||</span> Cur5Set<span class="token operator">-&gt;</span>dport <span class="token operator">==</span> <span class="token punctuation">(</span>u_short<span class="token punctuation">)</span><span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;protocol: SMTP\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>proto <span class="token operator">==</span> IP_UDP<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>Cur5Set<span class="token operator">-&gt;</span>sport <span class="token operator">==</span> <span class="token punctuation">(</span>u_short<span class="token punctuation">)</span><span class="token number">53</span> <span class="token operator">||</span> Cur5Set<span class="token operator">-&gt;</span>dport <span class="token operator">==</span> <span class="token punctuation">(</span>u_short<span class="token punctuation">)</span><span class="token number">53</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;protocol: DNS\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>Cur5Set<span class="token operator">-&gt;</span>sport <span class="token operator">==</span> <span class="token punctuation">(</span>u_short<span class="token punctuation">)</span><span class="token number">161</span> <span class="token operator">||</span> Cur5Set<span class="token operator">-&gt;</span>dport <span class="token operator">==</span> <span class="token punctuation">(</span>u_short<span class="token punctuation">)</span><span class="token number">161</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;protocol: SNMP\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">&quot;---------------------------------------------\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        LinkNode<span class="token operator">-&gt;</span>nln_5set <span class="token operator">=</span> <span class="token operator">*</span>Cur5Set<span class="token punctuation">;</span>
        LinkNode<span class="token operator">-&gt;</span>nln_upl_size <span class="token operator">=</span> dataLen<span class="token punctuation">;</span>
        LinkNode<span class="token operator">-&gt;</span>nln_downl_size <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        LinkNode<span class="token operator">-&gt;</span>nln_upl_pkt <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        LinkNode<span class="token operator">-&gt;</span>nln_downl_pkt <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        LinkNode<span class="token operator">-&gt;</span>nln_status <span class="token operator">=</span> ESTABLISHED<span class="token punctuation">;</span>
        LinkNode<span class="token operator">-&gt;</span>next <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span><span class="token punctuation">(</span>segIP<span class="token operator">-&gt;</span>proto <span class="token operator">==</span> IP_TCP<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token function">add_to_hashTable</span><span class="token punctuation">(</span><span class="token function">get_hash</span><span class="token punctuation">(</span>Cur5Set<span class="token punctuation">)</span><span class="token punctuation">,</span> LinkNode<span class="token punctuation">,</span> segTCP<span class="token operator">-&gt;</span>th_flags<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span><span class="token punctuation">{</span>
            <span class="token function">add_to_flowLink</span><span class="token punctuation">(</span>FLowLink_UDP<span class="token punctuation">,</span> LinkNode<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        
        <span class="token comment">// Sleep(2000);</span>
        <span class="token keyword">while</span><span class="token punctuation">(</span>ptmp<span class="token operator">-&gt;</span>next <span class="token operator">==</span> <span class="token constant">NULL</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>isCatchDone<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token function">Sleep</span><span class="token punctuation">(</span>cycle <span class="token operator">*</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        ptmp <span class="token operator">=</span> ptmp<span class="token operator">-&gt;</span>next<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">fprintf</span><span class="token punctuation">(</span>fOutput<span class="token punctuation">,</span> <span class="token string">&quot;\n\n&gt;&gt;&gt;&gt;&gt; &#x65F6;&#x95F4;&#x6BB5;&#xFF1A;%s&quot;</span><span class="token punctuation">,</span> <span class="token function">long2time</span><span class="token punctuation">(</span>tstamp_offset<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">fprintf</span><span class="token punctuation">(</span>fOutput<span class="token punctuation">,</span> <span class="token string">&quot; --&gt; %s\n&quot;</span><span class="token punctuation">,</span> <span class="token function">long2time</span><span class="token punctuation">(</span>tstamp_offset <span class="token operator">+</span> cycle<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">fprintf</span><span class="token punctuation">(</span>fOutput<span class="token punctuation">,</span> <span class="token string">&quot;#----------------------#\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">parse_flowLink_UDP</span><span class="token punctuation">(</span>fOutput<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">fprintf</span><span class="token punctuation">(</span>fOutput<span class="token punctuation">,</span> <span class="token string">&quot;#----------------------#\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">parse_flowLink_TCP</span><span class="token punctuation">(</span>fOutput<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;over\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">fprintf</span><span class="token punctuation">(</span>fOutput<span class="token punctuation">,</span> <span class="token string">&quot;\nover...\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">free</span><span class="token punctuation">(</span>pkthdr<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">free</span><span class="token punctuation">(</span>segEther<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">free</span><span class="token punctuation">(</span>segIP<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">free</span><span class="token punctuation">(</span>segTCP<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">free</span><span class="token punctuation">(</span>segUDP<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">free</span><span class="token punctuation">(</span>Cur5Set<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">free</span><span class="token punctuation">(</span>LinkNode<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">free</span><span class="token punctuation">(</span>FLowLink_TCP<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">free</span><span class="token punctuation">(</span>FLowLink_UDP<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">fclose</span><span class="token punctuation">(</span>fOutput<span class="token punctuation">)</span><span class="token punctuation">;</span>

    
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Done!\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    isAnalysisDone <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</pre><h2 class="mume-header" id="44-%E7%A8%8B%E5%BA%8F%E5%85%A5%E5%8F%A3">4.4 &#x7A0B;&#x5E8F;&#x5165;&#x53E3;</h2>

<p>&#x4E3A;&#x4E86;&#x5C06;&#x5404;&#x6A21;&#x5757;&#x6574;&#x5408;&#xFF0C;&#x8BBE;&#x7ACB;&#x5165;&#x53E3;&#x7A0B;&#x5E8F;&#xFF0C;&#x5148;&#x8C03;&#x7528;&#x83B7;&#x53D6;&#x8BBE;&#x5907;&#x6A21;&#x5757;&#xFF0C;&#x7136;&#x540E;&#x5EFA;&#x7ACB;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#xFF0C;&#x8C03;&#x7528;&#x6570;&#x636E;&#x5305;&#x7684;&#x6355;&#x83B7;&#x6A21;&#x5757;&#xFF0C;&#x6700;&#x540E;&#x5EFA;&#x7ACB;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x8C03;&#x7528;&#x6D41;&#x91CF;&#x5206;&#x6790;&#x6A21;&#x5757;&#x3002;</p>
<h3 class="mume-header" id="%E4%BB%A3%E7%A0%81-3">&#x4EE3;&#x7801;</h3>

<pre data-role="codeBlock" data-info="cpp" class="language-cpp"><span class="token comment">// main.cpp</span>
<span class="token macro property">#<span class="token directive keyword">include</span><span class="token string">&quot;get_devs.h&quot;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span><span class="token string">&quot;catch_packets.h&quot;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">char</span> devs<span class="token punctuation">[</span>PCAP_BUF_SIZE<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token function">get_devs</span><span class="token punctuation">(</span>devs<span class="token punctuation">)</span><span class="token punctuation">;</span>
    pthread_t ptClock<span class="token punctuation">;</span>
    isCatchDone <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">pthread_create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>ptClock<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> catch_packet<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">err_print</span><span class="token punctuation">(</span><span class="token string">&quot;pthread_create(): catch_packet: Error!!!\n&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span>isCatchDone<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">pthread_create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>ptClock<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> analysis_pkt<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">err_print</span><span class="token punctuation">(</span><span class="token string">&quot;pthread_create(): catch_packet: Error!!!\n&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span>isAnalysisDone<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">pcap_freealldevs</span><span class="token punctuation">(</span>dev<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">free_pkt_link</span><span class="token punctuation">(</span>pkt_link<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// catch_packet(NULL);</span>
    <span class="token comment">// analysis_pkt(NULL);</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</pre><h1 class="mume-header" id="5-%E8%BF%90%E8%A1%8C%E7%BB%93%E6%9E%9C%E7%A4%BA%E6%84%8F">5. &#x8FD0;&#x884C;&#x7ED3;&#x679C;&#x793A;&#x610F;</h1>

<p>&#x5C06;&#x9879;&#x76EE;&#x4E2D;&#x7684;&#x6E90;&#x6587;&#x4EF6;&#x7F16;&#x8BD1;&#x540E;&#x751F;&#x6210;&#x4E00;&#x4E2A;&#x53EF;&#x6267;&#x884C;&#x6587;&#x4EF6; <code>main.exe</code> &#xFF0C;&#x7F16;&#x8BD1;&#x7684;&#x6307;&#x4EE4;&#x5982;&#x4E0B;&#xFF1A;</p>
<pre data-role="codeBlock" data-info class="language-"><code>D:\mingw64\bin\g++.exe -g -std=c++17 -LG:\&#x5B9E;&#x9A8C;&#x62A5;&#x544A;\&#x5B9E;&#x8BAD;\WpdPack_4_1_2\WpdPack\Lib\x64 -IG:\&#x5B9E;&#x9A8C;&#x62A5;&#x544A;\&#x5B9E;&#x8BAD;\WpdPack_4_1_2\WpdPack\Include -finput-charset=UTF-8 -fexec-charset=GBK g:\&#x5B9E;&#x9A8C;&#x62A5;&#x544A;\&#x5B9E;&#x8BAD;\program\final\global.cpp g:\&#x5B9E;&#x9A8C;&#x62A5;&#x544A;\&#x5B9E;&#x8BAD;\program\final\get_devs.cpp g:\&#x5B9E;&#x9A8C;&#x62A5;&#x544A;\&#x5B9E;&#x8BAD;\program\final\catch_packets.cpp g:\&#x5B9E;&#x9A8C;&#x62A5;&#x544A;\&#x5B9E;&#x8BAD;\program\final\analysis_struct.cpp g:\&#x5B9E;&#x9A8C;&#x62A5;&#x544A;\&#x5B9E;&#x8BAD;\program\final\main.cpp -o g:\&#x5B9E;&#x9A8C;&#x62A5;&#x544A;\&#x5B9E;&#x8BAD;\program\final\main.exe -lwsock32 -lwpcap -lws2_32 -lpthread
</code></pre><p>&#x8FD0;&#x884C;&#x7A0B;&#x5E8F;&#xFF0C;&#x4E00;&#x4E2A;&#x8F93;&#x51FA;&#x5982;&#x4E0B;&#xFF08;&#x6B64;&#x5904;&#x9009;&#x62E9;&#x7B2C;&#x4E09;&#x4E2A;&#x7F51;&#x5361;&#xFF0C;&#x5373;&#x8BE5;&#x672C;&#x673A;&#x4E0B;&#x7684;&#x65E0;&#x7EBF;&#x7F51;&#x5361;&#xFF0C;&#x8FC7;&#x6EE4;&#x89C4;&#x5219;&#x4E3A;&#x6240;&#x6709;ip&#xFF0C;&#x6355;&#x83B7;&#x65F6;&#x95F4;5s&#xFF09;&#xFF1A;</p>
<pre data-role="codeBlock" data-info class="language-"><code>PS G:\&#x5B9E;&#x9A8C;&#x62A5;&#x544A;\&#x5B9E;&#x8BAD;\program\final&gt; .\main.exe
1. rpcap://\Device\NPF_{5E3C391D-E871-4FE4-AE6D-F01E77749DA4} (Network adapter &apos;Realtek PCIe GBE Family Controller&apos; on local host)
2. rpcap://\Device\NPF_{8F3B52EB-9CB1-4249-949D-AF020CB0827B} (Network adapter &apos;Microsoft&apos; on local host)
3. rpcap://\Device\NPF_{54584F28-ABCC-40AA-A1FA-0436E989D5A6} (Network adapter &apos;Microsoft&apos; on local host)
Enter the interface number(1-3): 3
rpcap://\Device\NPF_{54584F28-ABCC-40AA-A1FA-0436E989D5A6}

Input pcap filter string: ip

Input catch packets time: 5
Pcap filter string is: &quot;ip&quot;, catch time is &quot;5&quot;. Start catching...
A pkt add success!!
A pkt add success!!
A pkt add success!!
A pkt add success!!
A pkt add success!!
A pkt add success!!
A pkt add success!!
A pkt add success!!
A pkt add success!!
A pkt add success!!
A pkt add success!!
A pkt add success!!
A pkt add success!!
A pkt add success!!
A pkt add success!!
A pkt add success!!
analysis.......

---------------------- 1 -----------------------
2020-07-09 03:39:20 -- len: 66
192.168.0.185:13975 -&gt; 31.13.73.17:443
protocol: TCP
[SYN ], Seq = -1657115098, Win = 61690, Len = 0
protocol: HTTP
---------------------------------------------


---------------------- 2 -----------------------
2020-07-09 03:39:20 -- len: 54
31.13.73.17:443 -&gt; 192.168.0.185:13975
protocol: TCP
[RST ACK ], Seq = 0, Win = 11281, Len = 0
protocol: HTTP
---------------------------------------------


---------------------- 3 -----------------------
2020-07-09 03:39:20 -- len: 66
192.168.0.185:13974 -&gt; 31.13.73.17:443
protocol: TCP
[SYN ], Seq = -1003432054, Win = 61690, Len = 0
protocol: HTTP
---------------------------------------------


---------------------- 4 -----------------------
2020-07-09 03:39:20 -- len: 54
31.13.73.17:443 -&gt; 192.168.0.185:13974
protocol: TCP
[RST ACK ], Seq = 0, Win = 12561, Len = 0
protocol: HTTP
---------------------------------------------


---------------------- 5 -----------------------
2020-07-09 03:39:20 -- len: 80
192.168.0.185:59008 -&gt; 223.5.5.5:53
protocol: UDP
protocol: DNS
---------------------------------------------


---------------------- 6 -----------------------
2020-07-09 03:39:20 -- len: 66
192.168.0.185:13977 -&gt; 31.13.73.17:443
protocol: TCP
[SYN ], Seq = 709455654, Win = 61690, Len = 0
protocol: HTTP
---------------------------------------------


---------------------- 7 -----------------------
2020-07-09 03:39:20 -- len: 54
31.13.73.17:443 -&gt; 192.168.0.185:13977
protocol: TCP
[RST ACK ], Seq = 0, Win = 12817, Len = 0
protocol: HTTP
---------------------------------------------


---------------------- 8 -----------------------
2020-07-09 03:39:21 -- len: 126
223.5.5.5:53 -&gt; 192.168.0.185:59008
protocol: UDP
protocol: DNS
---------------------------------------------


---------------------- 9 -----------------------
2020-07-09 03:39:21 -- len: 1392
192.168.0.185:59009 -&gt; 203.208.43.98:443
protocol: UDP
---------------------------------------------


---------------------- 10 -----------------------
2020-07-09 03:39:21 -- len: 66
192.168.0.185:13975 -&gt; 31.13.73.17:443
protocol: TCP
[SYN ], Seq = -1657115098, Win = 61690, Len = 0
protocol: HTTP
---------------------------------------------


---------------------- 11 -----------------------
2020-07-09 03:39:21 -- len: 84
203.208.43.98:443 -&gt; 192.168.0.185:59009
protocol: UDP
---------------------------------------------


---------------------- 12 -----------------------
2020-07-09 03:39:21 -- len: 1392
203.208.43.98:443 -&gt; 192.168.0.185:59009
protocol: UDP
---------------------------------------------


---------------------- 13 -----------------------
2020-07-09 03:39:21 -- len: 75
A pkt add success!!
A pkt add success!!
A pkt add success!!
A pkt add success!!
A pkt add success!!
A pkt add success!!
192.168.0.185:59009 -&gt; 203.208.43.98:443
protocol: UDP
---------------------------------------------


---------------------- 14 -----------------------
2020-07-09 03:39:21 -- len: 569
192.168.0.185:59009 -&gt; 203.208.43.98:443
protocol: UDP
---------------------------------------------


over
Done!
catch done!!!

Pcap File dump done!!!
</code></pre><p>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x5728;&#x6355;&#x83B7;&#x6570;&#x636E;&#x5305;&#x7684;&#x540C;&#x65F6;&#x8FDB;&#x884C;&#x5206;&#x6790;&#x7684;&#x7ED3;&#x679C;&#xFF0C;&#x6700;&#x540E;&#x7A0B;&#x5E8F;&#x5C06;&#x6355;&#x83B7;&#x7684;&#x6570;&#x636E;&#x5305;&#x5BFC;&#x51FA;&#x4E3A; pcap&#x6587;&#x4EF6;&#xFF0C;&#x7528;wireshark&#x6253;&#x5F00;&#x4E0E;&#x7A0B;&#x5E8F;&#x8F93;&#x51FA;&#x6BD4;&#x5BF9;&#xFF0C;&#x53EF;&#x4EE5;&#x53D1;&#x73B0;&#x7ED3;&#x679C;&#x7C7B;&#x4F3C;&#xFF1A;</p>
<p><img src="./wireshark.JPG" alt></p>
<p>&#x5BF9;&#x4E8E;&#x7A0B;&#x5E8F;&#x7684;&#x5206;&#x6790;&#x7ED3;&#x679C;&#xFF0C;&#x4FDD;&#x5B58;&#x5728; <code>result.data</code> &#x6587;&#x4EF6;&#x4E2D;&#xFF0C;&#x7528;&#x6587;&#x672C;&#x7F16;&#x8F91;&#x5668;&#x6253;&#x5F00;&#x53EF;&#x4EE5;&#x5F97;&#x5230;&#x7ED3;&#x679C;&#x5982;&#x4E0B;&#xFF1A;</p>
<pre data-role="codeBlock" data-info class="language-"><code>&#x6570;&#x636E;&#x6587;&#x4EF6;&#xFF1A;traffic.data
&#x5206;&#x6790;&#x5468;&#x671F;&#xFF1A;5 s


&gt;&gt;&gt;&gt;&gt; &#x65F6;&#x95F4;&#x6BB5;&#xFF1A;2020-07-09 03:39:20 --&gt; 2020-07-09 03:39:25
----------------------
UDP&#x6570;&#x636E;&#x5305;&#x4E2A;&#x6570;&#xFF1A;	52
UDP&#x6570;&#x636E;&#x6D41;&#x91CF;&#xFF1A;	8115 bytes
----------------------
TCP&#x8FDE;&#x63A5;&#x4E2A;&#x6570;&#xFF1A;	5
TCP&#x6570;&#x636E;&#x5305;&#x4E2A;&#x6570;&#xFF1A;	30
TCP&#x6570;&#x636E;&#x603B;&#x6D41;&#x91CF;&#xFF1A;	5105 bytes
TCP&#x6570;&#x636E;&#x4E0A;&#x4F20;&#x91CF;&#xFF1A;	748 bytes
TCP&#x6570;&#x636E;&#x4E0B;&#x8F7D;&#x91CF;&#xFF1A;	4357 bytes
-----------------------
192.168.0.185	13979	==&gt;	40.122.160.14	443	&#x4E0A;&#x4F20;&#x5305;&#x6570;&#x91CF;&#xFF1A;5	&#x4E0B;&#x8F7D;&#x5305;&#x6570;&#x91CF;&#xFF1A;4	upload&#xFF1A;413 bytes	download&#xFF1A;4122 bytes	
192.168.0.185	13975	==&gt;	31.13.73.17	443	&#x4E0A;&#x4F20;&#x5305;&#x6570;&#x91CF;&#xFF1A;2	&#x4E0B;&#x8F7D;&#x5305;&#x6570;&#x91CF;&#xFF1A;2	upload&#xFF1A;64 bytes	download&#xFF1A;40 bytes	
192.168.0.185	13974	==&gt;	31.13.73.17	443	&#x4E0A;&#x4F20;&#x5305;&#x6570;&#x91CF;&#xFF1A;1	&#x4E0B;&#x8F7D;&#x5305;&#x6570;&#x91CF;&#xFF1A;1	upload&#xFF1A;32 bytes	download&#xFF1A;20 bytes	
192.168.0.185	13977	==&gt;	31.13.73.17	443	&#x4E0A;&#x4F20;&#x5305;&#x6570;&#x91CF;&#xFF1A;5	&#x4E0B;&#x8F7D;&#x5305;&#x6570;&#x91CF;&#xFF1A;5	upload&#xFF1A;160 bytes	download&#xFF1A;100 bytes	
192.168.0.185	13818	==&gt;	52.12.194.218	443	&#x4E0A;&#x4F20;&#x5305;&#x6570;&#x91CF;&#xFF1A;2	&#x4E0B;&#x8F7D;&#x5305;&#x6570;&#x91CF;&#xFF1A;2	upload&#xFF1A;79 bytes	download&#xFF1A;75 bytes	


&gt;&gt;&gt;&gt;&gt; &#x65F6;&#x95F4;&#x6BB5;&#xFF1A;2020-07-09 03:39:25 --&gt; 2020-07-09 03:39:30
#----------------------#
UDP&#x6570;&#x636E;&#x5305;&#x4E2A;&#x6570;&#xFF1A;	20
UDP&#x6570;&#x636E;&#x6D41;&#x91CF;&#xFF1A;	1830 bytes
#----------------------#
TCP&#x8FDE;&#x63A5;&#x4E2A;&#x6570;&#xFF1A;	1
TCP&#x6570;&#x636E;&#x5305;&#x4E2A;&#x6570;&#xFF1A;	22
TCP&#x6570;&#x636E;&#x603B;&#x6D41;&#x91CF;&#xFF1A;	14852 bytes
TCP&#x6570;&#x636E;&#x4E0A;&#x4F20;&#x91CF;&#xFF1A;	1714 bytes
TCP&#x6570;&#x636E;&#x4E0B;&#x8F7D;&#x91CF;&#xFF1A;	13138 bytes
-----------------------
40.122.160.14	443	==&gt;	192.168.0.185	13979	&#x4E0A;&#x4F20;&#x5305;&#x6570;&#x91CF;&#xFF1A;11	&#x4E0B;&#x8F7D;&#x5305;&#x6570;&#x91CF;&#xFF1A;15	upload&#xFF1A;1714 bytes	download&#xFF1A;13138 bytes	

over...
</code></pre><p>&#x5BF9;&#x4E8E;&#x4E0A;&#x5C42;&#x534F;&#x8BAE;&#x7684;&#x5206;&#x6790;&#xFF1A;</p>
<p>&#x8BC6;&#x522B;DNS&#xFF1A;</p>
<pre data-role="codeBlock" data-info class="language-"><code>---------------------- 5 -----------------------
2020-07-09 03:39:20 -- len: 80
192.168.0.185:59008 -&gt; 223.5.5.5:53
protocol: UDP
protocol: DNS
---------------------------------------------
</code></pre><p>&#x8BC6;&#x522B;HTTP&#xFF1A;</p>
<pre data-role="codeBlock" data-info class="language-"><code>---------------------- 10 -----------------------
2020-07-09 03:39:21 -- len: 66
192.168.0.185:13975 -&gt; 31.13.73.17:443
protocol: TCP
[SYN ], Seq = -1657115098, Win = 61690, Len = 0
protocol: HTTP
---------------------------------------------
</code></pre><h1 class="mume-header" id="5%E7%BB%93%E8%AE%BA%E4%B8%8E%E6%9C%AA%E6%9D%A5%E5%B1%95%E6%9C%9B">5.&#x7ED3;&#x8BBA;&#x4E0E;&#x672A;&#x6765;&#x5C55;&#x671B;</h1>

<p>&#x672C;&#x8BFE;&#x9898;&#x5728;&#x5B9E;&#x9A8C;&#x6307;&#x5BFC;&#x4E66;&#x3001;winpcap&#x5B98;&#x65B9;&#x6587;&#x6863;&#x4EE5;&#x53CA;&#x4F17;&#x591A;&#x535A;&#x5BA2;&#x8D44;&#x6599;&#x7684;&#x5E2E;&#x52A9;&#x4E0B;&#x5B8C;&#x6210;&#xFF0C;&#x57FA;&#x672C;&#x4E0A;&#x5B9E;&#x73B0;&#x8BFE;&#x9898;&#x4EFB;&#x52A1;&#xFF0C;&#x540C;&#x65F6;&#x5B66;&#x4E60;&#x4E86;&#x89E3;&#x4F7F;&#x7528;&#x7B2C;&#x4E09;&#x65B9;&#x51FD;&#x6570;&#x5305;&#x7F16;&#x7A0B;&#x7684;&#x65B9;&#x5F0F;&#xFF0C;&#x518D;&#x4E00;&#x6B21;&#x4ECE;&#x5B9E;&#x9645;&#x60C5;&#x51B5;&#x4E2D;&#x5206;&#x6790;&#x5B66;&#x4E60;&#x8BA1;&#x7B97;&#x673A;&#x7F51;&#x7EDC;&#x7684;&#x77E5;&#x8BC6;&#xFF0C;&#x5C24;&#x5176;&#x662F;&#x5404;&#x5C42;&#x7F51;&#x7EDC;&#x534F;&#x8BAE;&#x7684;&#x683C;&#x5F0F;&#x4EE5;&#x53CA;&#x8BC6;&#x522B;&#x8BFB;&#x53D6;&#x7B49;&#x7B49;&#xFF0C;&#x540C;&#x65F6;&#x901A;&#x8FC7;&#x589E;&#x52A0;&#x591A;&#x7EBF;&#x7A0B;&#x7684;&#x65B9;&#x5F0F;&#x6765;&#x5B9E;&#x73B0;&#x6D41;&#x91CF;&#x6355;&#x83B7;&#x4EE5;&#x53CA;&#x5206;&#x6790;&#x7684;&#x5E76;&#x884C;&#x5904;&#x7406;&#xFF0C;&#x4F7F;&#x5F97;&#x7A0B;&#x5E8F;&#x7684;&#x6548;&#x7387;&#x5F97;&#x4EE5;&#x63D0;&#x5347;&#x3002;</p>
<p>&#x5BF9;&#x4E8E;&#x672C;&#x9879;&#x76EE;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x8FDB;&#x4E00;&#x6B65;&#x7684;&#x6A21;&#x4EFF;wireshark&#x7B49;&#x7F51;&#x7EDC;&#x6D41;&#x91CF;&#x5206;&#x6790;&#x8F6F;&#x4EF6;&#x6765;&#x5B8C;&#x5584;&#x6574;&#x4E2A;&#x9879;&#x76EE;&#xFF0C;&#x4F8B;&#x5982;&#xFF0C;&#x5BF9;&#x4E8E;&#x5404;&#x79CD;&#x975E;&#x5E38;&#x89C1;&#x534F;&#x8BAE;&#x7684;&#x89E3;&#x6790;&#x3001;&#x53EF;&#x89C6;&#x5316;&#x754C;&#x9762;&#x7B49;&#x7B49;&#x5185;&#x5BB9;&#x3002;</p>
<hr class="footnotes-sep">
<section class="footnotes">
<ol class="footnotes-list">
<li id="fn1" class="footnote-item"><p>TCP&#x62A5;&#x6587;&#x683C;&#x5F0F;&#x8BE6;&#x89E3;https://blog.csdn.net/paincupid/article/details/79726795 <a href="#fnref1" class="footnote-backref">&#x21A9;&#xFE0E;</a></p>
</li>
<li id="fn2" class="footnote-item"><p>DNS&#x4F7F;&#x7528;&#x7684;&#x662F;TCP&#x534F;&#x8BAE;&#x8FD8;&#x662F;UDP&#x534F;&#x8BAE;https://www.iteye.com/blog/benbenxiongyuan-1088085 <a href="#fnref2" class="footnote-backref">&#x21A9;&#xFE0E;</a></p>
</li>
<li id="fn3" class="footnote-item"><p>dns&#x534F;&#x8BAE;&#x53CA;&#x5E27;&#x683C;&#x5F0F;https://blog.csdn.net/marywang56/article/details/77932414 <a href="#fnref3" class="footnote-backref">&#x21A9;&#xFE0E;</a></p>
</li>
<li id="fn4" class="footnote-item"><p>TCP&#x62A5;&#x5934;&#x6807;&#x5FD7;&#x4F4D;URG/PSH/SYN/ACK/FIN/RSThttps://blog.csdn.net/sinat_36118270/article/details/73927628 <a href="#fnref4" class="footnote-backref">&#x21A9;&#xFE0E;</a></p>
</li>
</ol>
</section>

      </div>
      <div class="md-sidebar-toc"><ul>
<li><a href="#%E6%91%98%E8%A6%81">&#x6458;&#x8981;</a></li>
<li><a href="#%E5%85%B3%E9%94%AE%E5%AD%97">&#x5173;&#x952E;&#x5B57;</a></li>
<li><a href="#1%E7%BB%AA%E8%AE%BA">1.&#x7EEA;&#x8BBA;</a>
<ul>
<li><a href="#11-%E8%AF%BE%E9%A2%98%E7%A0%94%E7%A9%B6%E8%83%8C%E6%99%AF">1.1 &#x8BFE;&#x9898;&#x7814;&#x7A76;&#x80CC;&#x666F;</a></li>
<li><a href="#12-%E8%AF%BE%E9%A2%98%E7%A0%94%E7%A9%B6%E7%9A%84%E7%9B%AE%E7%9A%84%E5%92%8C%E6%84%8F%E4%B9%89">1.2 &#x8BFE;&#x9898;&#x7814;&#x7A76;&#x7684;&#x76EE;&#x7684;&#x548C;&#x610F;&#x4E49;</a></li>
</ul>
</li>
<li><a href="#2-%E4%B8%BB%E8%A6%81%E4%BB%AA%E5%99%A8%E5%8F%8A%E8%AF%95%E6%9D%90">2. &#x4E3B;&#x8981;&#x4EEA;&#x5668;&#x53CA;&#x8BD5;&#x6750;</a></li>
<li><a href="#3-%E8%AF%BE%E9%A2%98%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE">3. &#x8BFE;&#x9898;&#x73AF;&#x5883;&#x914D;&#x7F6E;</a></li>
<li><a href="#4%E7%B3%BB%E7%BB%9F%E4%B8%BB%E8%A6%81%E6%B5%81%E7%A8%8B%E8%AE%BE%E8%AE%A1%E5%88%86%E6%9E%90">4.&#x7CFB;&#x7EDF;&#x4E3B;&#x8981;&#x6D41;&#x7A0B;&#x8BBE;&#x8BA1;&#x5206;&#x6790;</a>
<ul>
<li><a href="#41-%E8%8E%B7%E5%8F%96%E6%9C%AC%E6%9C%BA%E8%AE%BE%E5%A4%87%E6%89%80%E6%9C%89%E7%9A%84%E7%BD%91%E7%BB%9C%E6%8E%A5%E5%8F%A3%E8%AE%BE%E5%A4%87">4.1 &#x83B7;&#x53D6;&#x672C;&#x673A;&#x8BBE;&#x5907;&#x6240;&#x6709;&#x7684;&#x7F51;&#x7EDC;&#x63A5;&#x53E3;&#x8BBE;&#x5907;</a>
<ul>
<li><a href="#%E4%BB%A3%E7%A0%81">&#x4EE3;&#x7801;</a></li>
</ul>
</li>
<li><a href="#42-%E6%95%B0%E6%8D%AE%E5%8C%85%E7%9A%84%E6%8D%95%E8%8E%B7%E5%B9%B6%E5%AD%98%E5%82%A8">4.2 &#x6570;&#x636E;&#x5305;&#x7684;&#x6355;&#x83B7;&#x5E76;&#x5B58;&#x50A8;</a>
<ul>
<li><a href="#%E4%BB%A3%E7%A0%81-1">&#x4EE3;&#x7801;</a></li>
</ul>
</li>
<li><a href="#43-%E6%95%B0%E6%8D%AE%E5%8C%85%E7%9A%84%E5%88%86%E6%9E%90%E4%BA%8E%E6%B5%81%E9%87%8F%E5%A4%84%E7%90%86">4.3 &#x6570;&#x636E;&#x5305;&#x7684;&#x5206;&#x6790;&#x4E8E;&#x6D41;&#x91CF;&#x5904;&#x7406;</a>
<ul>
<li><a href="#%E4%BB%A3%E7%A0%81-2">&#x4EE3;&#x7801;</a></li>
</ul>
</li>
<li><a href="#44-%E7%A8%8B%E5%BA%8F%E5%85%A5%E5%8F%A3">4.4 &#x7A0B;&#x5E8F;&#x5165;&#x53E3;</a>
<ul>
<li><a href="#%E4%BB%A3%E7%A0%81-3">&#x4EE3;&#x7801;</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#5-%E8%BF%90%E8%A1%8C%E7%BB%93%E6%9E%9C%E7%A4%BA%E6%84%8F">5. &#x8FD0;&#x884C;&#x7ED3;&#x679C;&#x793A;&#x610F;</a></li>
<li><a href="#5%E7%BB%93%E8%AE%BA%E4%B8%8E%E6%9C%AA%E6%9D%A5%E5%B1%95%E6%9C%9B">5.&#x7ED3;&#x8BBA;&#x4E0E;&#x672A;&#x6765;&#x5C55;&#x671B;</a></li>
</ul>
</div>
      <a id="sidebar-toc-btn">&#x2261;</a>
    
    
    
    
    
    
    
    
<script>

var sidebarTOCBtn = document.getElementById('sidebar-toc-btn')
sidebarTOCBtn.addEventListener('click', function(event) {
  event.stopPropagation()
  if (document.body.hasAttribute('html-show-sidebar-toc')) {
    document.body.removeAttribute('html-show-sidebar-toc')
  } else {
    document.body.setAttribute('html-show-sidebar-toc', true)
  }
})
</script>
      
  
    </body></html>