UHF超高频RFID通信协议实验

# 实验目的

+ 掌握UHF超高频通讯原理、通讯协议以及读卡器操作流程

# 实验设备

+ 硬件： 7号超高频节点、卡片、电脑等开发设备
+ 软件：keil、串口助手等

# 实验原理 

超高频UHF（Ultra-High Frequency）RFID系统由一个读卡器和若干的电子标签组成。读卡器不断的发送高频电磁波，电子标签根据此来获得所需要的能量，解调接收到的电磁波信号等数据完成一定的工作。不同数据的产生过程利用了反向散射技术，它是一种无源RFID电子标签将数据发回读写器时所采用的通信方式。根据要发送的数据的不同，通过控制电子标签的天线阻抗，使得反射的载波幅度产生微小的变化，这样反射的回波就携带了所需的传送数据。

电子标签内部设计了很多的分区用于存储不同类型的数据，如密码、EPC、用户存储器以及TID等等，其中EPC实现对物品的唯一标识功能,TID用于实现标签的唯一化。

# 实验步骤

## 设置读卡器的工作环境

在实验开始前,要首先设置UHF读写器的波特率等参数，如设置波特率为38400：发送：``73 00 01 00 00 00 02 00 04 00 E0 2C 00 96 00 00`` ，其中：73 00 是命令头；01 00表示写入模块波特率；00 00是读写器地址，全0表示广播；02 00是波特率设置命令；04 00指PLAYLOAD 数据长度（低位在前，高位在后）；E0 2C是PLAYLOAD数据的CRC校验码；00 96 00 00是波特率38400转十六进制数字（低位在前）。

对于CRC校验码的设置，可以使用相关的软件产生，在设置好命令的头部参数以及携带的数据后，可以给出对应的包含正确的CRC校验码的命令，之后直接通过串口发送即可。

## 盘存操作

盘存操作即为读取电子标签的过程，在串口调试助手上发送盘存指令 ``“73 00 01 00 00 00 20 00 02 00 01 90 01 00”`` ，首先返回命令成功数据 ``“73 00 03 00 01 00 20 00 04 00 00 00 00 00 00 00”`` 。

此时将超高频标签置于读写器天线上方，将返回盘存指令标签，数据中包含EPC码“E2 00 41 27 88 14 01 04 04 80 E1 9C”，对于同时放置多张卡片时，将会同时显示这几张卡片的信息。

## 停止盘存

读写器处于盘存状态后，读写器将一直进行盘存，此时会不断的显示出读取到的卡片的信息，如要停止需要发送停止盘存指令 ``“73 00 01 00 00 00 20 00 02 00 00 00 00 00”`` ，成功返回 ``“73 00 03 00 01 00 20 00 04 00 00 00 00 00 00 00 73 00 00 00 01 00 20 00 04 00 00 00 00 00 00 00 ”`` ，此时将不在读取电子标签。


## 标签扇区读取操作 

电子标签中包含多个分区的信息，可以选择性的读取不同的分区的信息，当发送扇区读取命令0x22时可读取标签4个分区数据。

### 读取EPC码

EPC码长度是96bit共6个word，EPC码从0x02地址开始。在串口调试助手上发送数据“73 00 01 00 00 00 22 00 0C 00 03 C9 00 00 00 00 00 00 01 00 02 00 06 00”，则返回的数据最后6word是EPC码，

### 读TID码

TID码长度96bit共6个word，从TID码从0x00地址开始。在串口调试助手上发送数据“73 00 01 00 00 00 22 00 0C 00 02 42 00 00 00 00 00 00 02 00 00 00 06 00”，则返回的数据最后6个word是TID码。

## 标签扇区写操作

对于电子标签，除了TID作为标识标签的唯一编号的信息外，其他的分区可以进行写操作，例如对于EPC分区，可以根据实际需要进行一定的修改：

将上述读取的EPC码“E2 00 41 27 88 14 01 04 04 80 E1 9C”改成“E2 00 41 27 88 14 01 04 04 80 E1 6E”。在串口调试助手上十六进制发送数据“73 00 01 00 00 00 30 00 18 00 25 F0 00 00 00 00 00 00 01 00 02 00 06 00 E2 00 41 27 88 14 01 04 04 80 E1 6E”，此时返回的数据最后4个字节全是0表示执行成功。

此时进行前面的读取EPC码的操作：在串口调试助手上发送扇区读指令“73 00 01 00 00 00 22 00 0C 00 03 C9 00 00 00 00 00 00 01 00 02 00 06 00”，读取EPC码。返回的EPC码可以看到变成新修改的EPC码，表明EPC码写入成功。


# 实验体会

UHF超高频RFID作为一种普遍使用的物联网技术，它的使用上很简单，只需要在使用前根据一定的标准配置好对应的设备间的参数，然后根据实际需求为每一个物品分配一个RFID，以达到管理事物的功能，其中的EPC码即可看成实际需求中的为每一个物品分配的编码序号，而TID则是标签自身的一个编码序号。因为RFID的一系列优点，可以实现多个物品标签在中等距离上的同时识别操作，在图书馆等有着很大的作用。